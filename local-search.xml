<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>在 vscode 为 leetcode 开启 rust 代码提示</title>
    <link href="/2024/08/23/write-rust-in-vscode-leetcode/"/>
    <url>/2024/08/23/write-rust-in-vscode-leetcode/</url>
    
    <content type="html"><![CDATA[<p>最近突然又想刷一些 leetcode 题目了，顺便再练一练 rust，好久不写代码已经手生了。之前在 vscode 的 leetcode 插件刷 rust 题目时，基本没有代码提示与补全，很难受。今天搜到一篇解决这个问题的<a href="https://juejin.cn/post/7311343161185189939">帖子</a>，感觉很有用，虽然没能完全解决我的问题，但是为我打开了思路。</p><h2 id="早期的处理办法">早期的处理办法</h2><p>早期我是通过 <code>automod</code> 这个库，将所有 leetcode 代码文件都加入一个项目中，好处是确实有补全了，但是一个文件有问题就可能会破坏补全体验，一片飘红。</p><p>我先新建了一个本地仓库，用来存放 rust 代码。放置于</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~/Documents/Repository/leetcode/<br>cargo new rust<br>cargo add automod<br></code></pre></td></tr></table></figure><p>然后我们进入到项目文件夹下，在 <code>src</code> 目录下新建一个目录<code>leetcode</code>， 再创建一个 <code>lib.rs</code> 并加入如下内容:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">mod</span> leetcode &#123;<br>    automod::dir!(<span class="hljs-string">&quot;src/leetcode/&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>最后将 leetcode 插件的 <code>leetcode.workspaceFolder</code> 指定为 <code>~/Documents/Repository/leetcode/rust/src/leetcode</code> 即可。</p><h2 id="目前的解决办法">目前的解决办法</h2><p>在参考了掘金的帖子之后才发现还可以直接去修改插件的代码。因此我也打算直接去改插件代码，动态生成一个 <code>lib.rs</code> 并引用对应题目的代码。顺便给模板加上一个空的 <code>struct Solution</code> 以减少 rust-analyzer 的警告。最终我的 patch 为</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-comment">--- a/leetCodeExecutor.js</span><br><span class="hljs-comment">+++ b/leetCodeExecutor.js</span><br><span class="hljs-meta">@@ -109,6 +109,12 @@</span> class LeetCodeExecutor &#123;<br>         &#125;);<br>     &#125;<br>     showProblem(problemNode, language, filePath, showDescriptionInComment = false, needTranslation) &#123;<br><span class="hljs-addition">+        let cargocfg = path.join(path.dirname(filePath), &quot;../lib.rs&quot;)</span><br><span class="hljs-addition">+        let name = path.parse(filePath).name</span><br><span class="hljs-addition">+        const leetcodeRustConfig = `mod leetcode &#123;</span><br><span class="hljs-addition">+    mod $&#123;name&#125;;</span><br><span class="hljs-addition">+&#125;`;</span><br><span class="hljs-addition">+        fse.writeFile(cargocfg, leetcodeRustConfig);</span><br>         return __awaiter(this, void 0, void 0, function* () &#123;<br>             const templateType = showDescriptionInComment ? &quot;-cx&quot; : &quot;-c&quot;;<br>             const cmd = [yield this.getLeetCodeBinaryPath(), &quot;show&quot;, problemNode.id, templateType, &quot;-l&quot;, language];<br><span class="hljs-meta">@@ -119,6 +125,7 @@</span> class LeetCodeExecutor &#123;<br>                 yield fse.createFile(filePath);<br>                 const codeTemplate = yield this.executeCommandWithProgressEx(&quot;Fetching problem data...&quot;, this.nodeExecutable, cmd);<br>                 yield fse.writeFile(filePath, codeTemplate);<br><span class="hljs-addition">+                yield fse.appendFile(filePath, &quot;#[allow(unused)]\nstruct Solution;&quot;)</span><br>             &#125;<br>         &#125;);<br>     &#125;<br></code></pre></td></tr></table></figure><p>现在终于可以愉快地刷题啦（虽然我只能对简单题重拳出击）。</p><h2 id="参考资料">参考资料</h2><ol><li><a href="https://juejin.cn/post/7311343161185189939">解决 vscode-leetcode 插件创建的 Rust 文件无代码提示问题</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rust</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PKGBUILD 中鲜为人知的变量</title>
    <link href="/2024/08/15/extra-varaibles-in-PKGBUILD/"/>
    <url>/2024/08/15/extra-varaibles-in-PKGBUILD/</url>
    
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>最近在打一个软件包 <code>yade</code>, 由于软件包东西比较多，打算按照 split package 的方式去写 PKGBUILD。 计划 <code>pkgbase=yade</code>, <code>pkgname=(yade yade-cuda yade-doc)</code>。在官方仓库中这是很常见的，只要先构建本体，然后构建文档就可以了。但是这个软件包比较坑的点在于：构建文档需要先安装本体，因为它需要用本体去处理一些文件。</p><p>但是，在通过 split package 的方式打包的时候，由于它们的 <code>pkgname</code> 不一致，导致我们没法通过下面的方式去调整 <code>PATH</code> 和 <code>LD_LIBRARY_PATH</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$&#123;PATH&#125;</span>:<span class="hljs-variable">$&#123;pkgdir&#125;</span>/usr/bin<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$&#123;LD_LIBRARY_PATH&#125;</span>:<span class="hljs-variable">$&#123;pkgdir&#125;</span>/usr/lib<br></code></pre></td></tr></table></figure><h2 id="一种解决方案">一种解决方案</h2><p>一种临时的办法是在 <code>build()</code> 过程中先将本体安装到一个临时的目录，比如 <code>$srcdir/tmproot</code>, 然后用这个目录来调整 <code>PATH</code> 和 <code>LD_LIBRARY_PATH</code>。（我最终是这样做的）。</p><h2 id="另一种解决方案">另一种解决方案</h2><p>不过还有另一种解决方案，可以使用 <code>pkgdirbase</code> 这个变量。在 <code>/usr/bin/makepkg</code> 中，它的定义是这样的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pkgdirbase=<span class="hljs-string">&quot;<span class="hljs-variable">$BUILDDIR</span>/<span class="hljs-variable">$pkgbase</span>/pkg&quot;</span><br></code></pre></td></tr></table></figure><p>因此我们可以通过 <code>$&#123;pkgdirbase&#125;/yade-cuda</code> 访问到 <code>yade-cuda</code> 在 <code>package()</code> 完成之后的内容，对于 <code>yade</code> 也是一样，即可以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$&#123;PATH&#125;</span>:<span class="hljs-variable">$&#123;pkgdirbase&#125;</span>/yade/usr/bin<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$&#123;LD_LIBRARY_PATH&#125;</span>:<span class="hljs-variable">$&#123;pkgdirbase&#125;</span>/yade/usr/lib<br></code></pre></td></tr></table></figure><h2 id="结语">结语</h2><p>我最终还是选择了先将它安装到 <code>$&#123;srcdir&#125;</code> 下面的一个临时文件夹，而不是去用 <code>$&#123;pkgdirbase&#125;</code>（后者感觉技巧性太强，有点利用未定义行为的感觉）。<br>不过这提醒了我，后续可以去看看 <code>makepkg</code> 的源码，看看还有哪些有意思的变量可以在打包阶段用。</p>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PKGBUILD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>制作自定义的 archlinux initramfs 与 rootfs</title>
    <link href="/2024/03/30/custom-archlinux-initramfs-and-rootfs/"/>
    <url>/2024/03/30/custom-archlinux-initramfs-and-rootfs/</url>
    
    <content type="html"><![CDATA[<p>最近想做一个自定义的 archlinux pxe 启动环境，由于 pxe 走的 tftp, 因此希望 initramfs 尽量小，官方 iso 里面的 initramfs 带了一些 glibc 的动态链接库，因此体积还是比较大的。我打算基于 busybox 去做一个 initramfs, 尽量只包含 busybox 以及网卡驱动，其他一概不加，都放在 rootfs 里面。</p><p>最后所有脚本放在 <a href="https://github.com/sukanka/custom-arch-initramfs">Github 仓库</a></p><h2 id="制作-initramfs">制作 initramfs</h2><p>我并不打算从头写 init 脚本，而是尽量抄 mkinitcpio 的代码。首先我们尝试通过自制的 initramfs 引导 archiso 带的 rootfs.<br>先新建一个文件夹，将 archiso 的 initramfs 复制进去解压</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">lsinitcpio -<span class="hljs-attribute">x</span> initramfs-linux<span class="hljs-selector-class">.img</span><br></code></pre></td></tr></table></figure><p>看一下目录结构</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs tcl">➜  initramfs tree -L <span class="hljs-number">2</span><br>.<br>├── bin -&gt; usr/bin<br>├── buildconfig<br>├── codesign.crt<br>├── config<br>├── dev<br>├── etc<br>│   ├── ca-certificates<br>│   ├── fstab<br>│   ├── initrd-release -&gt; ../usr/lib/os-release<br>│   ├── ld.so.cache<br>│   ├── ld.so.conf<br>│   ├── modprobe.d<br>│   ├── mtab -&gt; ../<span class="hljs-keyword">proc</span>/self/mounts<br>│   ├──<span class="hljs-title"> nsswitch.conf</span><br>│   ├──<span class="hljs-title"> os-release</span> -&gt; ../usr/lib/os-release<br>│   └──<span class="hljs-title"> ssl</span><br>├──<span class="hljs-title"> hooks</span><br>│   ├──<span class="hljs-title"> archiso</span><br>│   ├──<span class="hljs-title"> archiso_loop_mnt</span><br>│   ├──<span class="hljs-title"> archiso_pxe_common</span><br>│   ├──<span class="hljs-title"> archiso_pxe_http</span><br>│   ├──<span class="hljs-title"> archiso_pxe_nbd</span><br>│   ├──<span class="hljs-title"> archiso_pxe_nfs</span><br>│   ├──<span class="hljs-title"> memdisk</span><br>│   └──<span class="hljs-title"> udev</span><br>├──<span class="hljs-title"> init</span><br>├──<span class="hljs-title"> init_functions</span><br>├──<span class="hljs-title"> lib</span> -&gt;<span class="hljs-title"> usr/lib</span><br>├──<span class="hljs-title"> lib64</span> -&gt;<span class="hljs-title"> usr/lib</span><br>├──<span class="hljs-title"> new_root</span><br>├──<span class="hljs-title"> proc</span><br>├──<span class="hljs-title"> run</span><br>├──<span class="hljs-title"> sbin</span> -&gt;<span class="hljs-title"> usr/bin</span><br>├──<span class="hljs-title"> sys</span><br>├──<span class="hljs-title"> tmp</span><br>├──<span class="hljs-title"> usr</span><br>│   ├──<span class="hljs-title"> bin</span><br>│   ├──<span class="hljs-title"> lib</span><br>│   ├──<span class="hljs-title"> lib64</span> -&gt;<span class="hljs-title"> lib</span><br>│   ├──<span class="hljs-title"> local</span><br>│   └──<span class="hljs-title"> sbin</span> -&gt;<span class="hljs-title"> bin</span><br>├──<span class="hljs-title"> var</span><br>│   └──<span class="hljs-title"> run</span> -&gt; /run<br>└──<span class="hljs-title"> VERSION</span><br></code></pre></td></tr></table></figure><p>这几乎就是一个正常根目录的结构，其中 <code>init</code> 就是启动脚本，内核在解压 initramfs 后会执行 <code>init</code>. <code>hooks/</code> 文件夹是 archiso 的各种 hook, 通过 <code>config</code> 配置，自己写的变更就可以放在 <code>hook</code> 里面。</p><p>主要的命令和库都放在 <code>usr/bin</code> 和 <code>usr/lib</code> 下面。我们先把这两个文件夹清空（因为我们尽量只用 <code>busybox</code> 嘛）。<br>同样的，那些 hook,<br>然后将 <code>busybox</code> 安装到 <code>usr/bin</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">busybox --install -s <span class="hljs-variable">$&#123;INITRAMFS_DIR&#125;</span><span class="hljs-regexp">/usr/</span>bin<br></code></pre></td></tr></table></figure><p>再把 <code>busybox</code> 本体复制过去。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">install -Dm755 /usr/bin/busybox  -t <span class="hljs-variable">$&#123;INITRAMFS_DIR&#125;</span>/usr/bin<br></code></pre></td></tr></table></figure><p>然后我们由于我们打算通过 http 传输 rootfs, 所以得加上网卡驱动。把内核自带的<strong>网卡驱动</strong>都复制到 <code>usr/lib/modules</code> 下面.<br>注意，这些驱动一定要是 <code>.ko</code> 格式（而不是 <code>.ko.zst</code>, 因为两次压缩没有必要）</p><p>同时由于我们要挂载 <code>squashfs</code> 形式的 rootfs 还要挂载 <code>overlayfs</code>, 因此也需要 <code>squashfs</code> 与 <code>overlayfs</code> 这两个模块。<br>另外，由于原来的 initramfs 使用了一些 glibc 的库和命令，它们与 <code>busybox</code> 的不一致，我们需要对脚本做一些修改以兼容 <code>busybox</code> 的命令, 比如 <code>busybox</code> 的 <code>mount</code> 没有 <code>--mkdir</code>，同时我们将 <code>curl</code> 更换为 <code>wget</code>。</p><p>而 <code>losetup</code> 我不会配置参数以达到和原来一样的效果，因此这个就直接用<code>glibc</code>的 <code>losetup</code> 而不是 <code>busybox</code> 的了。我们需要将它以及它所依赖的动态库都一起复制过去，具体可以通过 <code>lddtree</code> 命令查看。这里 <code>/usr/lib/libsmartcols.so.1</code> 是一个软链接，所以我直接把 <code>/usr/lib/libsmartcols.so*</code> 都复制过去了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">➜  ~ lddtree /usr/bin/losetup<br>/usr/bin/losetup (interpreter =&gt; /lib64/ld-linux-x86-64.so.2)<br>    libsmartcols.so.1 =&gt; /usr/lib/libsmartcols.so.1<br>    libc.so.6 =&gt; /usr/lib/libc.so.6<br></code></pre></td></tr></table></figure><p>由于我们使用的 <code>busybox</code> 和 原装 initramfs 的 <code>busybox</code> 不一致（我们使用的 <code>busybox</code> 会优先使用 <code>busybox</code> applet, 而不是 <code>PATH</code> 中的命令），因此，在使用两者都有的命令时，需要使用绝对路径（例如 <code>/usr/bin/losetup</code>).</p><p>另外我们加了一个 <code>addmod</code> 的 hook, 并且在 config 中先于其他 hook 执行以加载网卡（原来是在 <code>udev</code> 中执行的，但是我们把 <code>udev</code> 拿掉了）。</p><h2 id="打包">打包</h2><p>linux 内核其实支持两种引导的格式，initrd 与 initramfs, 两者的区别可以看参考资料。我们使用如下的命令创建 initramfs。 其中 <code>xz -1</code> 是压缩程序及压缩等级，也可以调整成 <code>zstd -19</code>.</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">find</span> . 2&gt;/dev/<span class="hljs-literal">null</span> | cpio -o -R root:root -H newc | xz -1 <span class="hljs-attribute">--format</span>=lzma &gt;<span class="hljs-built_in">..</span>/initramfs-linux.img<br></code></pre></td></tr></table></figure><h2 id="启动">启动</h2><p>命令行启动的启动命令（方便查看日志调试）</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">qemu-system-x86_64 \<br>-m 18G \<br>-net nic -net<span class="hljs-built_in"> user </span>-nographic \<br>-device nec-usb-xhci,<span class="hljs-attribute">id</span>=xhci,addr=0x1b \<br>-device usb-tablet,<span class="hljs-attribute">id</span>=tablet,bus=xhci.0,port=1 \<br>-device usb-kbd,<span class="hljs-attribute">id</span>=keyboard,bus=xhci.0,port=2 \<br>-smp 4,<span class="hljs-attribute">cores</span>=4  -kernel vmlinuz-linux  -initrd initramfs-linux.img 、<br>-append <span class="hljs-string">&#x27;archisobasedir=arch archiso_http_srv=http://192.168.122.1/  ip=dhcp console=ttyS0 &#x27;</span><br></code></pre></td></tr></table></figure><p>启动的同时我们要保证启动了一个 http 服务，并确保<code>http://192.168.122.1/arch/x86_64/airootfs.sfs</code> 这个路径有效，这样我们就能顺利启动了。</p><h2 id="制作-rootfs">制作 rootfs</h2><p><code>airootfs.sfs</code> 可以自己制作. <code>$&#123;ROOTFS_DIR&#125;</code> 是一个与 initramfs 无关的文件夹, 同时我们将 <code>root</code> 密码设置成了 <code>root</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacstrap -K <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ROOTFS_DIR&#125;</span>&quot;</span> base <span class="hljs-comment"># and other pkgs you like</span><br><span class="hljs-built_in">sudo</span> arch-chroot <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ROOTFS_DIR&#125;</span>&quot;</span> passwd&lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">root</span><br><span class="hljs-string">root</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><p>接着使用如下的命令打包 <code>squashfs</code>, 打包出来的文件就是 <code>airootfs.sfs</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> mksquashfs <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ROOTFS_DIR&#125;</span>&quot;</span> airootfs.sfs \<br>  -not-reproducible \<br>  -xattrs \<br>  -wildcards \<br>  -noappend \<br>  -progress \<br>  -mem 5G \<br>  -e \<br>    var/cache/pacman/pkg \<br>    var/lib/pacman/sync \<br>    var/log/journal \<br>    efi \<br>    boot/grub \<br>    boot/initramfs-linux<span class="hljs-string">&quot;*&quot;</span>.img \<br>    boot/vmlinuz-linux<br></code></pre></td></tr></table></figure><h2 id="暂未解决的问题">暂未解决的问题</h2><p>目前 <code>losetup</code> 和 <code>ipconfig</code> 还是用的动态链接的，尤其 <code>ipconfig</code> 是从源码编译的，后续可以看看如何用 <code>busybox</code> 的内置命令实现这两个功能，这样我们就完全不需要 <code>glibc</code> 的库了。（另一种方法是将 <code>busybox</code> 也换成动态链接的版本）</p><h2 id="参考资料">参考资料</h2><ol><li><a href="https://www.baeldung.com/linux/initrd-vs-initramfs">initrd-vs-initramfs</a></li><li><a href="https://wiki.archlinux.org/title/Preboot_Execution_Environment">Preboot Execution Environment</a></li><li><a href="https://olbat.net/files/misc/netboot.pdf">PXE network boot methods</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>initramfs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PXE 启动 archlinux</title>
    <link href="/2023/12/24/archlinux-pxeboot/"/>
    <url>/2023/12/24/archlinux-pxeboot/</url>
    
    <content type="html"><![CDATA[<p>本文没有编写完成，以后也许不会更新。</p><p>最近想整个 PXE 启动的 archlinux 环境，启动之后像 archiso 一样，跑在内存里面。</p><h2 id="实现思路">实现思路</h2><p>PXE 启动 grub, 然后走 http 下载 kernel 和 initramfs, 在 initramfs 启动过程中下载 rootfs，最后 <code>switch_root</code> 到 rootfs。</p><h2 id="搭建一个-tftp、dhcp、http-server">搭建一个 tftp、dhcp、http server</h2><p>根据 archwiki 的指导，我们用 dnsmasq 作为 tftp 与 dhcp server. 下面是我的 dnsmasq 配置(与软件包内置版本的 diff)</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-comment">diff --git a/dnsmasq.conf b/dnsmasq.conf</span><br><span class="hljs-comment">index 936e468..07aa658 100644</span><br><span class="hljs-comment">--- a/dnsmasq.conf</span><br><span class="hljs-comment">+++ b/dnsmasq.conf</span><br><span class="hljs-meta">@@ -7,7 +7,7 @@</span><br> # Listen on this specific port instead of the standard DNS port<br> # (53). Setting this to zero completely disables DNS function,<br> # leaving only DHCP and/or TFTP.<br><span class="hljs-deletion">-#port=5353</span><br><span class="hljs-addition">+port=0</span><br><br> # The following two options make you a better netizen, since they<br> # tell dnsmasq to filter out queries which the public DNS cannot<br><span class="hljs-meta">@@ -113,7 +113,9 @@</span><br> # specified interfaces (and the loopback) give the name of the<br> # interface (eg eth0) here.<br> # Repeat the line for more than one interface.<br><span class="hljs-deletion">-#interface=</span><br><span class="hljs-addition">+interface=wlp3s0</span><br><span class="hljs-addition">+interface=virbr0</span><br><span class="hljs-addition">+interface=br0</span><br> # Or you can specify which interface _not_ to listen on<br> #except-interface=<br> # Or which to listen on by address (remember to include 127.0.0.1 if<br><span class="hljs-meta">@@ -164,8 +166,9 @@</span><br> # a lease time. If you have more than one network, you will need to<br> # repeat this for each network on which you want to supply DHCP<br> # service.<br><span class="hljs-deletion">-#dhcp-range=192.168.0.50,192.168.0.150,12h</span><br><span class="hljs-deletion">-</span><br><span class="hljs-addition">+dhcp-range=192.168.122.50,192.168.122.150,12h</span><br><span class="hljs-addition">+dhcp-range=192.168.2.1,proxy</span><br><span class="hljs-addition">+dhcp-range=10.42.0.50,10.42.0.240,12h</span><br> # This is an example of a DHCP range where the netmask is given. This<br> # is needed for networks we reach the dnsmasq DHCP server via a relay<br> # agent. If you don&#x27;t know what a DHCP relay agent is, you probably<br><span class="hljs-meta">@@ -439,9 +442,9 @@</span><br> # Magic number - needed before anything else is recognised<br> #dhcp-option-force=208,f1:00:74:7e<br> # Configuration file name<br><span class="hljs-deletion">-#dhcp-option-force=209,configs/common</span><br><span class="hljs-addition">+dhcp-option-force=209,archiso_pxe.cfg</span><br> # Path prefix<br><span class="hljs-deletion">-#dhcp-option-force=210,/tftpboot/pxelinux/files/</span><br><span class="hljs-addition">+dhcp-option-force=210,</span><br> # Reboot time. (Note &#x27;i&#x27; to send 32-bit value)<br> #dhcp-option-force=211,30i<br><br><span class="hljs-meta">@@ -449,7 +452,7 @@</span><br> # this if you want to boot machines over the network and you will need<br> # a TFTP server; either dnsmasq&#x27;s built-in TFTP server or an<br> # external one. (See below for how to enable the TFTP server.)<br><span class="hljs-deletion">-#dhcp-boot=pxelinux.0</span><br><span class="hljs-addition">+dhcp-boot=/boot/syslinux/ipxe.pxe</span><br><br> # The same as above, but use custom tftp-server instead machine running dnsmasq<br> #dhcp-boot=pxelinux,server.name,192.168.1.100<br><span class="hljs-meta">@@ -458,8 +461,8 @@</span><br> # filenames, the first loads iPXE, and the second tells iPXE what to<br> # load. The dhcp-match sets the ipxe tag for requests from iPXE.<br> #dhcp-boot=undionly.kpxe<br><span class="hljs-deletion">-#dhcp-match=set:ipxe,175 # iPXE sends a 175 option.</span><br><span class="hljs-deletion">-#dhcp-boot=tag:ipxe,http://boot.ipxe.org/demo/boot.php</span><br><span class="hljs-addition">+dhcp-match=set:ipxe,175 # iPXE sends a 175 option.</span><br><span class="hljs-addition">+dhcp-boot=tag:ipxe,/boot/syslinux/lpxelinux.0</span><br><br> # Encapsulated options for iPXE. All the options are<br> # encapsulated within option 175<br><span class="hljs-meta">@@ -506,10 +509,10 @@</span><br><br><br> # Enable dnsmasq&#x27;s built-in TFTP server<br><span class="hljs-deletion">-#enable-tftp</span><br><span class="hljs-addition">+enable-tftp</span><br><br> # Set the root directory for files available via FTP.<br><span class="hljs-deletion">-#tftp-root=/var/ftpd</span><br><span class="hljs-addition">+tftp-root=/tmp/pxe/archiso</span><br><br> # Do not abort if the tftp-root is unavailable<br> #tftp-no-fail<br><span class="hljs-meta">@@ -671,7 +674,7 @@</span><br> #log-queries<br><br> # Log lots of extra information about DHCP transactions.<br><span class="hljs-deletion">-#log-dhcp</span><br><span class="hljs-addition">+log-dhcp</span><br><br> # Include another lot of configuration options.<br> #conf-file=/etc/dnsmasq.more.conf<br></code></pre></td></tr></table></figure><p>工作目录为 <code>/tmp/pxe</code>，下面是目录结构 <code>archiso</code> 目录是 <code>archlinux-2023.12.01-x86_64.iso</code> 解压后的文件夹</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus">/tmp/pxe<br>├── archiso<br>│   ├── arch<br>│   ├── boot<br>│   ├── EFI<br>│   ├── shellia32<span class="hljs-selector-class">.efi</span><br>│   └── shellx64<span class="hljs-selector-class">.efi</span><br>├── archlinux-<span class="hljs-number">2023.12</span>.<span class="hljs-number">01</span>-x86_64<span class="hljs-selector-class">.iso</span><br>└── dnsmasq<span class="hljs-selector-class">.conf</span><br><br></code></pre></td></tr></table></figure><p>dnsmasq 启动命令为 (<code>-d</code> 是为了看输出)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> dnsmasq -C dnsmasq.conf -d<br></code></pre></td></tr></table></figure><p>http server 的启动命令为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> darkhttpd /tmp/pxe/archiso --port 80<br></code></pre></td></tr></table></figure><p>然后我们从 qemu 建立一个虚拟机，走 pxe 启动，就能进入 livecd 了。</p><p>qemu 启动命令</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> qemu-system-x86_64 -boot n -netdev tap,id=mynet0,ifname=tap0,script=no,downscript=no -device e1000,netdev=mynet0,mac=<span class="hljs-number">52</span>:<span class="hljs-number">55</span>:<span class="hljs-number">00</span>:d1:<span class="hljs-number">55</span>:<span class="hljs-number">01</span> -nographic -curses<br><br></code></pre></td></tr></table></figure><h3 id="自定义-initramfs">自定义 initramfs</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">find</span> . 2&gt;/dev/<span class="hljs-literal">null</span> | cpio -o  -R root:root -H newc | xz -3 <span class="hljs-attribute">--format</span>=lzma &gt; <span class="hljs-built_in">..</span>/initramfs-linux.img<br></code></pre></td></tr></table></figure><h3 id="自定义-rootfs">自定义 rootfs</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pacstrap -K NEWROOT <span class="hljs-keyword">base</span> <span class="hljs-keyword">base</span>-devel<br></code></pre></td></tr></table></figure><p>然后打包成 <code>squashfs</code></p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs livescript">sudo mksquashfs . ../airootfs.sfs <span class="hljs-string">\</span><br>  -<span class="hljs-keyword">not</span>-reproducible <span class="hljs-string">\</span><br>  -xattrs <span class="hljs-string">\</span><br>  -wildcards <span class="hljs-string">\</span><br>  -noappend <span class="hljs-string">\</span><br>  -progress <span class="hljs-string">\</span><br>  -mem <span class="hljs-number">5</span>G <span class="hljs-string">\</span><br>  -e <span class="hljs-string">\</span><br>    <span class="hljs-keyword">var</span>/cache/pacman/pkg <span class="hljs-string">\</span><br>    <span class="hljs-keyword">var</span>/lib/pacman/sync <span class="hljs-string">\</span><br>    <span class="hljs-keyword">var</span>/log/journal <span class="hljs-string">\</span><br>    efi <span class="hljs-string">\</span><br>    boot/grub <span class="hljs-string">\</span><br>    boot/initramfs-linux<span class="hljs-string">&quot;*&quot;</span>.img <span class="hljs-string">\</span><br>    boot/vmlinuz-linux<br></code></pre></td></tr></table></figure><h3 id="qemu-调试">qemu 调试</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros">qemu-system-x86_64 \<br>-m 8G \<br>-chardev stdio,<span class="hljs-attribute">id</span>=char0,logfile=serial.log,signal=off \<br>-serial chardev:char0 \<br>-vga virtio \<br>-net nic -net<span class="hljs-built_in"> user </span>\<br>-device nec-usb-xhci,<span class="hljs-attribute">id</span>=xhci,addr=0x1b \<br>-device usb-tablet,<span class="hljs-attribute">id</span>=tablet,bus=xhci.0,port=1 \<br>-device usb-kbd,<span class="hljs-attribute">id</span>=keyboard,bus=xhci.0,port=2 \<br>-smp 4,<span class="hljs-attribute">cores</span>=4  -kernel vmlinuz-linux  -initrd initramfs-linux.img -append <span class="hljs-string">&#x27;ip=:::::eth0:dhcp&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="参考资料">参考资料</h2><ol><li><a href="https://wiki.archlinux.org/title/Preboot_Execution_Environment">Preboot Execution Environment</a></li><li><a href="https://olbat.net/files/misc/netboot.pdf">PXE network boot methods</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pxeboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>复制 btrfs 分区到另一块硬盘</title>
    <link href="/2023/11/12/move-btrfs-to-another-disk/"/>
    <url>/2023/11/12/move-btrfs-to-another-disk/</url>
    
    <content type="html"><![CDATA[<p>双十一来了，我入手了心心念念的致钛Ti 7100 plus。 但是迟迟没有将它换到我的笔记本上，直到这周末，才终于有时间将数据迁移到新盘上面，可惜的是，我的 <code>$HOME</code> 已经在周五晚上的测试打包过程中被误删了，后来回滚到了今年 7 月的快照。不过幸运的是除了我以外没有其他用户被删 <code>$HOME</code>，咱不用被挂在耻辱柱上了。</p><h2 id="基本思路">基本思路</h2><p>由于 btrfs 有子卷 (subvolume)，无法像以前 ext4 时候一样直接用 rsync 同步数据。但是我又不想直接全盘 <code>dd</code>。<br>在咨询了群友以及在谷歌后，决定使用 <code>dd</code> 来迁移数据。基本步骤是</p><ol><li>缩小 btrfs 所在分区</li><li><code>dd</code> 缩小后的分区到新的硬盘上。</li></ol><h2 id="开始操作">开始操作</h2><p>应某群友的要求，这一部分我尽量详细地介绍具体操作。本操作需要你的电脑具有至少两个 nvme 硬盘位。</p><h3 id="拆机换硬盘">拆机换硬盘</h3><ol><li>电脑关机，拔掉电源。</li><li>脱下毛衣等易产生静电的衣物，双手摸墙 10s 放静电</li><li>用螺丝刀将电脑后盖拆开。</li><li>断开电脑的内置电池。</li><li>长按电源键 15s 放电。</li><li>顺便清一下灰，这一步可以不做。</li><li>换上新的硬盘到另一个槽位。</li><li>合上后盖（轻轻合在一起即可，不要拧后盖螺丝）。</li></ol><h3 id="复制文件">复制文件</h3><ol><li>接上电源，外接 USB, 从 livecd 启动。启动后可以拔掉 U 盘。（默认 copytoram）。</li><li>给新硬盘分区，分区布局与旧硬盘一样（我的是 512M EFI,其他全给 btrfs），这一步不用 mkfs。</li><li>用 <code>dd</code> 拷贝旧的 EFI 分区。</li><li>挂载旧硬盘的 btrfs 分区到 <code>/mnt</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/nvme0n1p2 /mnt<br></code></pre></td></tr></table></figure><ul><li>a. 查看 btrfs 分区的用量，注意两个地方，<code>Device allocated</code> 与 <code>Free</code> 的 <code>min</code>.</li></ul><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">➜  ~ btrfs filesystem usage /mnt</span><br><span class="hljs-attribute">Overall</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">Device size</span><span class="hljs-punctuation">:</span> <span class="hljs-string">                  1.86TiB</span><br>    <span class="hljs-attribute">Device allocated</span><span class="hljs-punctuation">:</span> <span class="hljs-string">           815.02GiB</span><br>    <span class="hljs-attribute">Device unallocated</span><span class="hljs-punctuation">:</span> <span class="hljs-string">           1.07TiB</span><br>    <span class="hljs-attribute">Device missing</span><span class="hljs-punctuation">:</span> <span class="hljs-string">                 0.00B</span><br>    <span class="hljs-attribute">Device slack</span><span class="hljs-punctuation">:</span> <span class="hljs-string">                   0.00B</span><br>    <span class="hljs-attribute">Used</span><span class="hljs-punctuation">:</span> <span class="hljs-string">                       807.01GiB</span><br>    <span class="hljs-attribute">Free (estimated)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">             1.07TiB      (min: 548.94GiB)</span><br>    <span class="hljs-attribute">Free (statfs, df)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">            1.07TiB</span><br>    <span class="hljs-attribute">Data ratio</span><span class="hljs-punctuation">:</span> <span class="hljs-string">                      1.00</span><br>    <span class="hljs-attribute">Metadata ratio</span><span class="hljs-punctuation">:</span> <span class="hljs-string">                  2.00</span><br>    <span class="hljs-attribute">Global reserve</span><span class="hljs-punctuation">:</span> <span class="hljs-string">             512.00MiB      (used: 0.00B)</span><br>    <span class="hljs-attribute">Multiple profiles</span><span class="hljs-punctuation">:</span> <span class="hljs-string">                 no</span><br><br><span class="hljs-attribute">Data,single</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Size:789.01GiB, Used:786.17GiB (99.64%)</span><br>   <span class="hljs-attribute">/dev/nvme0n1p2        789.01GiB</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">Metadata,DUP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Size:13.00GiB, Used:10.42GiB (80.17%)</span><br>   <span class="hljs-attribute">/dev/nvme0n1p2         26.00GiB</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">System,DUP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Size:8.00MiB, Used:128.00KiB (1.56%)</span><br>   <span class="hljs-attribute">/dev/nvme0n1p2         16.00MiB</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">Unallocated</span><span class="hljs-punctuation">:</span><br>   /dev/nvme0n1p2          1.07TiB<br></code></pre></td></tr></table></figure><ul><li>b. 缩小分区，我们将分区缩小比 <code>min: 548.94GiB</code> 稍微小一点的大小，比如缩小 <code>540G</code>.</li></ul><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">btrfs <span class="hljs-keyword">file</span><span class="hljs-params">system</span> resize -<span class="hljs-number">540</span>G /mnt<br></code></pre></td></tr></table></figure><p>重复上述缩小分区的过程，直到不能再缩小（或者到你认为合适的大小）。<br>操作完毕之后将它卸载掉</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">umount /mnt<br></code></pre></td></tr></table></figure><ol start="5"><li>开始拷贝分区。这里 <code>/dev/nvme0n1p2</code> 是旧硬盘，<code>/dev/nvme1n1p2</code> 是新硬盘。其中 <code>bs</code> 是 block size, 需要大于一个扇区的大小（通常为4k），可以设置得大一些，这样复制得快。（比如 <code>16M</code>）， <code>count</code> 是块数量，需要满足<br><code>bs * count &gt;= Device size</code>，我们假设 <code>bs=16M</code>, 设备大小我们成功缩小到了 1T, 则 <code>count</code> 至少应该为 65536, 实际中应该稍微再多一些为好。</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">dd <span class="hljs-attribute">if</span>=/dev/nvme0n1p2 <span class="hljs-attribute">of</span>=/dev/nvme1n1p2 <span class="hljs-attribute">status</span>=progress <span class="hljs-attribute">bs</span>=4M <span class="hljs-attribute">count</span>=XXX<br></code></pre></td></tr></table></figure><p>等到跑完就拷贝完毕了。</p><h3 id="重建-boot-分区">重建 boot 分区</h3><p>这一步可能不是必要的，但是保险起见还是操作下。</p><ol><li>将新硬盘挂载上，然后 <code>chroot</code> 进去</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/nvme1n1p2 /mnt<br>mount /dev/nvme1n1p1 /mnt/boot<br>arch-chroot /mnt<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>chroot</code> 里面 执行 <code>mkinitcpio -P</code> 重新生成引导。<br>注意可以不用修改 <code>fstab</code> 并重新生成 <code>grub.cfg</code></li></ol><h3 id="检查能否启动">检查能否启动</h3><p>关机，断开电源，打开后盖，双手摸墙放静电，拔掉旧硬盘，将其他的硬盘一并插回去（比如 windows 盘）。</p><p>按电源键开机，进入 BIOS, 添加启动项指向新的硬盘，<code>EFI/GRUB/grubx64.efi</code>，然后将它调到第一启动项，保存重启。应当会正常进入 linux 系统。</p><p>关机，断开电源，双手摸墙放静电，长按电源键放电。然后将电池插上。按电源键开机，能正常进入系统即可。</p><p>然后继续关机，把后盖合上，卡扣也扣上，螺丝拧上，插上电源，开机。</p><p>教程完毕。</p><h2 id="推荐阅读">推荐阅读</h2><ol><li><a href="https://wiki.archlinux.org/title/Partclone">partclone</a> 可以比较简单地完成复制分区。</li><li><a href="https://wiki.archlinux.org/title/Dd">dd</a> 用法以及它的文档。</li></ol>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>btrfs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从零开始的 NixOS 教程（Flake篇)</title>
    <link href="/2023/05/29/nix-flakes/"/>
    <url>/2023/05/29/nix-flakes/</url>
    
    <content type="html"><![CDATA[<p>想不到还有人看，本来我都弃坑了，想到有人看，又捡起来了。我的 flake 已经托管到 <a href="https://github.com/sukanka/flakes">github 仓库</a>了，目前我还算新手，因此提交信息还比较乱。</p><p>安装教程见<a href="https://blog.askk.cc/2022/09/18/nixos-installation/">从零开始的 NixOS 教程（安装篇）</a>。</p><p>Nix 系列最吸引我的地方之一就在于 flake 了，我们可以把所有的 flake 托管到 GitHub, 然后在服务器上引入。这样简简单单就备份好了各种配置文件。重装系统或者批量部署非常容易。</p><h2 id="简单说明-Nix-的语法">简单说明 Nix 的语法</h2><p>我在写 flake 的时候，最痛苦的就是不知道要怎么写，也不知道该去哪里学。后来慢慢读了一些文档，但是也还是不会写。直到我看到了 <a href="https://nixos.org/guides/nix-pills/">nix pills</a>. 对 nix 的机制有了一些了解，才算比较会用/会写 nix 了。</p><p>Nix 是一个函数式编程语言，我们需要注意的通常就三点:</p><ol><li><code>&#123;&#125;</code> 是一个 <code>set</code>, 不是其他语言中的作用域的概念。</li><li><code>p:q</code> 是一个函数，接受一个参数 <code>p</code>，输出一个 <code>q</code>.</li><li>某些 <code>.nix</code> 文件需要遵守特定的格式（包含且只能包含某些特定的属性，比如 <code>flake.nix</code>）</li></ol><h2 id="开始抄一个-Flake">开始抄一个 Flake</h2><p>我们在上一篇教程里面已经开启了 flake 支持，现在只要在 <code>/etc/nixos</code> 下面新建 <code>flake.nix</code> 并输入如下内容</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123;<br>  <span class="hljs-comment"># Description, write anything or even nothing</span><br>  <span class="hljs-attr">description</span> = <span class="hljs-string">&quot;Lan Tian&#x27;s NixOS Flake&quot;</span>;<br><br>  <span class="hljs-comment"># Input config, or package repos</span><br>  <span class="hljs-attr">inputs</span> = &#123;<br>    <span class="hljs-comment"># Nixpkgs, NixOS&#x27;s official repo</span><br>    nixpkgs.<span class="hljs-attr">url</span> = <span class="hljs-string">&quot;github:NixOS/nixpkgs/nixos-unstable&quot;</span>;<br>  &#125;;<br><br>  <span class="hljs-comment"># Output config, or config for NixOS system</span><br>  <span class="hljs-attr">outputs</span> = &#123; self, nixpkgs, ... &#125;: &#123;<br>    <span class="hljs-comment"># Define a system called &quot;nixos&quot;</span><br>    nixosConfigurations.<span class="hljs-string">&quot;nixos&quot;</span> = nixpkgs.lib.nixosSystem &#123;<br>      <span class="hljs-attr">system</span> = <span class="hljs-string">&quot;x86_64-linux&quot;</span>;<br>      <span class="hljs-attr">modules</span> = [<br>        ./configuration.nix<br>      ];<br>    &#125;;<br><br>    <span class="hljs-comment"># You can define many systems in one Flake file.</span><br>    <span class="hljs-comment"># NixOS will choose one based on your hostname.</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># nixosConfigurations.&quot;nixos2&quot; = nixpkgs.lib.nixosSystem &#123;</span><br>    <span class="hljs-comment">#   system = &quot;x86_64-linux&quot;;</span><br>    <span class="hljs-comment">#   modules = [</span><br>    <span class="hljs-comment">#     ./configuration2.nix</span><br>    <span class="hljs-comment">#   ];</span><br>    <span class="hljs-comment"># &#125;;</span><br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里简单说一下: 这个 <code>flake.nix</code> 就是一个 <code>set</code>, 具有三个属性 <code>description</code>(字符串), <code>inputs</code>（<code>set</code>）, <code>outputs</code>（函数）。<br>没错， <code>outputs</code> 是一个函数 <code>&#123;self,nixpkgs,...&#125;:&#123;&#125;</code> 参数是第一个 <code>&#123;&#125;</code>中的 <code>self</code>(就是 <code>output</code> 自己)与 <code>nixpkgs</code>, 还有一些省略的参数<code>...</code>(就是说你可以多传，但是我们不使用)，<br>函数返回值<code>&#123;&#125;</code>是一个 <code>set</code>, 它包含一个属性 <code>nixosConfigurations</code>。</p><p>保存之后执行 <code>nix flake update</code> 会自动生成一个 <code>flake.lock</code>, 它是一个 json, 记录了当时所使用的仓库的具体的 commit id 以保证可重复性。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;nodes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;nixpkgs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;locked&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;lastModified&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1663357389</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;narHash&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sha256-oYA2nVRSi6yhCBqS5Vz465Hw+3BQOVFEhfbfy//3vTs=&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;owner&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NixOS&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;repo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nixpkgs&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;da6a05816e7fa5226c3f61e285ef8d9dfc868f3c&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;github&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;original&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;owner&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NixOS&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;ref&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nixos-unstable&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;repo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nixpkgs&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;github&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;inputs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;nixpkgs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nixpkgs&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;root&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>接下来我们运行 <code>nixos-rebuild switch</code> 来切换到 <code>flake.nix</code>。当存在 <code>flake.nix</code> 的时候， Nix 会优先使用 <code>flake.nix</code> 而不是 <code>configuration.nix</code>。（注意：并不是同时使用，因此我们在 <code>flake.nix</code> 里面手动引入了 <code>configuration.nix</code>）</p><p>注意：<strong>如果你启用了 flake, 并使用 Git 来管理文件，那么 nix 会忽略不由 Git 管理的文件，并且仅读取 stage 或者 commit 了的文件。</strong> 这点在创建新文件的时候需要注意。<br>另外可以把 <code>/etc/nixos</code> 链接到用户目录下，并且权限改为 777（或者把 owner 修改为自己的用户，这样子可以用普通用户修改了，问过 NickCao, 这么干没问题）</p><p>值得注意的是 <code>flake.nix</code> 的语法是固定的，我们并不能在 output 里面自己定义变量。下面举个例子说明：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix">...<br><span class="hljs-attr">outputs=&#123;pkgs,...&#125;:rec&#123;</span><br>  <span class="hljs-comment"># 注意到这里我们想要用 b引用 a, 所以要加 rec.</span><br>  <span class="hljs-attr">a=1;</span><br>  <span class="hljs-attr">b=a;</span><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p>这样子是不可以的，在 output里面只能使用它规定好的一些属性（比如<code>nixosConfigurations</code>），不能自己定义新的属性。<br>当我们需要一些辅助变量的时候，我们要使用 <code>let</code> 块，举例：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix">...<br><span class="hljs-attr">outputs=&#123;pkgs,...&#125;:</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">host1=&quot;nixos&quot;;</span> <span class="hljs-keyword">in</span><br>  &#123;<br>  nixosConfigurations.$<span class="hljs-attr">host1</span> = ...;<br>&#125;<br></code></pre></td></tr></table></figure><p>另外一个建议是在 flake 的最后配置一个 Formatter, 我一般使用</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">formatter.<span class="hljs-attr">x86_64-linux</span> = nixpkgs.legacyPackages.$&#123;system&#125;.alejandra;<br></code></pre></td></tr></table></figure><p>然后每次提交之前执行 <code>nix fmt</code> 格式化文档。当然你也可以把它写到git pre-commit 的 hook 里面,这样每次提交前会自动帮你格式化。</p><h2 id="使用-Nvfetcher-更新-vscode-插件">使用 <a href="https://github.com/berberman/nvfetcher">Nvfetcher</a> 更新 vscode 插件</h2><p>vscode 的插件只有一部分在 nix 的官方源里面，其他的要自己管理，但是管理起来比较麻烦。需要手动填写版本号跟shasum, 每次还得手动更新，让人苦不堪言。<br>但是后来有人给我推荐了 nvfetcher, 它可以自动更新版本号跟 shasum, 替代手工维护，达到跟 <code>flake.lock</code> 类似的效果。我们只需要写一个 <code>nvfetcher.toml</code><br>然后执行 nvfetcher 就能自动生成一个 nix 文件跟 json文件。<br>先看一下 nvfetcher 的配置吧</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs toml"><span class="hljs-section">[vscode-remote-ssh-edit]</span><br><span class="hljs-attr">src.vsmarketplace</span> = <span class="hljs-string">&quot;ms-vscode-remote.remote-ssh-edit&quot;</span><br><span class="hljs-attr">fetch.vsmarketplace</span> = <span class="hljs-string">&quot;ms-vscode-remote.remote-ssh-edit&quot;</span><br><span class="hljs-attr">passthru</span> = &#123; publisher = <span class="hljs-string">&quot;ms-vscode-remote&quot;</span>, name = <span class="hljs-string">&quot;remote-ssh-edit&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>这几个部分都是必要的，不能再精简了。<br>生成的文件我们只用 <code>generated.json</code>, 不使用 <code>generated.nix</code>. 这里需要用到一些 nix 的内置函数来处理 json, 我们先看一下需要的格式长什么样</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-attr">extFromMarket</span> = pkgs.vscode-utils.extensionsFromVscodeMarketplace (<br>    [<br>      <span class="hljs-comment"># &#123;</span><br>      <span class="hljs-comment">#   name = &quot;vscode-typescript-next&quot;;</span><br>      <span class="hljs-comment">#   publisher = &quot;ms-vscode&quot;;</span><br>      <span class="hljs-comment">#   version = &quot;5.0.202302260&quot;;</span><br>      <span class="hljs-comment">#   sha256 = &quot;KNQslqJa8zEKMu0FsVHj/J5ZonKy0wrZf+jN8PJQbLA=&quot;;</span><br>      <span class="hljs-comment"># &#125;</span><br>    ]);<br></code></pre></td></tr></table></figure><p><code>[]</code> 之间的部分就是我们需要的啦，它是一个 list of set(集合的数组)。<br>再看看我们的 <code>gernerated.json</code> (一小部分)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;vscode-LiveServer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;cargoLocks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;extract&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vscode-LiveServer&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;passthru&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LiveServer&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publisher&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ritwickdey&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;pinned&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LiveServer-5.7.9.zip&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sha256&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sha256-w0CYSEOdltwMFzm5ZhOxSrxqQ1y4+gLfB8L+EFFgzDc=&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;url&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://ritwickdey.gallery.vsassets.io/_apis/public/gallery/publisher/ritwickdey/extension/LiveServer/5.7.9/assetbyname/Microsoft.VisualStudio.Services.VSIXPackage&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5.7.9&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><p>我们需要一个函数把 json转化为 nix 的 set. 可以参考如下函数。</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-attr">parsePkg</span> = pkg:<br>    <span class="hljs-keyword">with</span> pkg; &#123;<br>      <span class="hljs-attr">name</span> = passthru.name;<br>      <span class="hljs-attr">publisher</span> = passthru.publisher;<br>      <span class="hljs-keyword">inherit</span> version;<br>      <span class="hljs-attr">sha256</span> = src.sha256;<br>    &#125;;<br></code></pre></td></tr></table></figure><p>这里 <code>parsePkg</code> 接受一个 <code>pkg</code> 返回一个 <code>set</code>, 其中 <code>with pkg;</code> 算是一个局部作用域，在后面可以直接使用 <code>pkg</code> 的属性，例如 <code>version</code>，而不用写 ``pkg.version<code>. </code>inherit version<code> 是</code>version=version<code>的简便写法，因此这里等同于</code>version=pkg.version`.</p><p>nix 下有函数可以读取 json</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-attr">sources</span> = <span class="hljs-built_in">builtins</span>.fromJSON (<span class="hljs-built_in">builtins</span>.readFile ../_sources/generated.json);<br></code></pre></td></tr></table></figure><p>最后我们可以使用 <a href="https://ryantm.github.io/nixpkgs/functions/library/attrsets/#function-library-example-lib.attrsets.attrValues"><code>builtins.attrValues</code></a> 来将 属性转化为 list</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-built_in">map</span> parsePkg (<span class="hljs-built_in">builtins</span>.attrValues sources)<br></code></pre></td></tr></table></figure><p>整体可以看 <a href="https://github.com/sukanka/flakes/blob/master/vscode/extFromMarket.nix">extFromMarket</a>.</p><h2 id="使用-deploy-rs-进行批量部署">使用 <a href="https://github.com/serokell/deploy-rs">deploy-rs</a> 进行批量部署</h2><h2 id="参考资料">参考资料</h2><ul><li><a href="https://lantian.pub/en/article/modify-website/nixos-initial-config-flake-deploy.lantian/#nix-flake">NixOS Series 2: Basic Config, Nix Flake &amp; Batch Deploy</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nixos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>certbot 自动更新 DNSPOD 泛域名证书</title>
    <link href="/2023/03/14/certbot-wildchar-auto-renew/"/>
    <url>/2023/03/14/certbot-wildchar-auto-renew/</url>
    
    <content type="html"><![CDATA[<p>最近我把服务器上的证书全换成泛域名证书了。域名比较多的话，每一个域名都要申请一份证书，虽然可以用 certbot 自动续期，但是因为不同的域名证书不一样，在写 nginx 配置的时候比较麻烦。</p><p>由于 certbot 已经支持了 泛域名证书的申请，所以我们可以申请泛域名证书，然后为泛域名证书自动续期就好了。假设我们的域名是 <code>askk.cc</code>，我希望为 <code>askk.cc</code> 与 <code>*.askk.cc</code> 申请一份证书。</p><h2 id="具体步骤">具体步骤</h2><p>首先，我们需要一个软件包：<a href="https://github.com/SkyLothar/certbot-dns-dnspod">certbot-dns-dnspod</a>, arch 用户的话，我已经打包好了<a href="https://aur.archlinux.org/packages/certbot-dns-dnspod-git">certbot-dns-dnspod-git</a>.<br>安装上该软件包之后，去 DNSPOD 申请 APIKEY. 具体做法参考 <a href="https://cloud.tencent.com/developer/article/1117551">腾讯云 DNSPod 域名 API 申请 Let’s Encrypt 泛域名 SSL 证书过程记录</a>。<br>然后记录下ID 与 KEY，写到文件里(我写到 <code>/etc/letsencrypt/dnspod.ini</code>) 记得将文件权限设置为 <code>600</code>。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># cat /etc/letsencrypt/dnspod.ini</span><br><span class="hljs-attr">dns_dnspod_api_id</span>=<span class="hljs-string">&quot;YOUR_ID&quot;</span><br><span class="hljs-attr">dns_dnspod_api_token</span>=<span class="hljs-string">&quot;YOUR_KEY&quot;</span><br></code></pre></td></tr></table></figure><p>接下来为每个泛域名手动申请一遍证书以便 certbot 记录下更新参数（可以看 <code>/etc/letsencrypt/renewal/askk.cc.conf</code>）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> certbot certonly  --preferred-challenges dns -d <span class="hljs-string">&quot;*.askk.cc&quot;</span> -d askk.cc --dns-dnspod-credentials /etc/letsencrypt/dnspod.ini<br></code></pre></td></tr></table></figure><p>到这里其实泛域名证书就申请完了，记得启动 <code>certbot.timer</code> 让它帮你自动更新。</p><h2 id="Nginx-配置">Nginx 配置</h2><p>再说一下如何在 Nginx里面使用泛域名证书，<br>首先创建这样一个文件（一个泛域名一个文件）</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#/etc/nginx/conf.d/001-certbot-askk.cc.conf</span><br><br><span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/askk.cc/fullchain.pem; <span class="hljs-comment"># managed by Certbot</span><br><span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/askk.cc/privkey.pem; <span class="hljs-comment"># managed by Certbot</span><br><span class="hljs-attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="hljs-comment"># managed by Certbot</span><br><span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="hljs-comment"># managed by Certbot</span><br></code></pre></td></tr></table></figure><p>然后在你的每个网站的配置里都加上这么一行就配置好证书了。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">include</span> conf.d/<span class="hljs-number">001</span>-certbot-askk.cc.conf;<br></code></pre></td></tr></table></figure><p>本期到这里就结束了</p><h2 id="参考资料">参考资料</h2><ol><li><a href="https://cloud.tencent.com/developer/article/1117551">腾讯云 DNSPod 域名 API 申请 Let’s Encrypt 泛域名 SSL 证书过程记录</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>domain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dnspod certbot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从巨潮资讯爬取上市公司公告</title>
    <link href="/2022/10/16/cninfo-crawler/"/>
    <url>/2022/10/16/cninfo-crawler/</url>
    
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>最近闲着没什么事，就帮同学写了个爬取巨潮资讯上市公司公告的 python 脚本，根据公司的股票代码以及公告的日期自动下载公告( pdf 或者 html 格式)。<br>脚本开源在 <a href="https://github.com/sukanka/cninfo-crawler">cninfo-crawler</a>。</p><p>刚开始本来想用 selenium 爬的，结果搞到一半发现完全没有反爬，就直接用 requests 库了。</p><h2 id="爬取过程">爬取过程</h2><p>我们先进入<a href="http://www.cninfo.com.cn/new/index">巨潮资讯主页</a>，打开 F12 开发人员工具，再随便搜索一个公司的股票代码跟公告日期。</p><p><img src="https://bu.dusays.com/2022/10/16/634be36334042.png" alt="image-20221016185005940"></p><p>点击查询，然后关注右边开发者工具捕捉到的消息，将它们按照 <code>Type</code> 排序，我们要找的应该在 <code>xhr</code> 里面，而且方法应该是 <code>POST</code>。</p><p><img src="https://bu.dusays.com/2022/10/16/634be3eec2aa5.png" alt="image-20221016185854408"></p><p>一眼我们就发现 <code>query</code> 特别可疑，点开它看看。</p><p><img src="https://bu.dusays.com/2022/10/16/634be45e7d718.png" alt="image-20221016190046214"></p><p>先看标头 <code>POST</code> 再看载荷</p><p><img src="https://bu.dusays.com/2022/10/16/634be4827227a.png" alt="image-20221016190122109"></p><p>这个应该就是我们搜索的时候填的表单，<code>stock</code> 里面的 <code>300409</code> 就是股票代码， 但是那个 <code>9900023868</code> 是啥，不太懂。 <code>seDate</code> 就是我们查询的时间段。其他参数不用改。</p><h3 id="获取下载链接">获取下载链接</h3><p>看一下预览，很明显 <code>adjunctUrl</code> 就是下载链接了，可惜这是个相对链接，</p><p><img src="https://bu.dusays.com/2022/10/16/634be4fa0dd7c.png" alt="image-20221016190321649"></p><p>我们先点进去看一看，刚开始我尝试从 <em>公告下载</em> 捕获下载链接，但是事实证明完全没有用，后来发现可以点 <strong>全屏</strong></p><p><img src="https://bu.dusays.com/2022/10/16/634be558d267e.png" alt="image-20221016190456492"></p><p>我们点进全屏，立马就发现 chrome 已经帮我们获取到了完整链接。</p><p><img src="https://bu.dusays.com/2022/10/16/634be59af40d7.png" alt="image-20221016190602567"></p><p>因此，完整链接就是 <code>http://static.cninfo.com.cn/</code> 跟 <code>adjunctUrl</code> 拼接一下。</p><p>值得注意的是，并不是所有的文件都是 pdf,也有 html 所以如果要将下载下来的文件重命名的话，要处理下扩展名。</p><h3 id="获取-orgId">获取 orgId</h3><p>这一部分我们说明一下那个神奇的数字 <code>9900023868</code> 怎么来的，因为单用 post 请求不带它的话根本不行，而这个数字每个股票代码不一样。</p><p>注意到 这里有一个 json 文件，我们点进去预览一下，发现有个 <code>orgId</code>，它就是了。</p><p><img src="https://bu.dusays.com/2022/10/16/634be6c06fde8.png" alt="image-20221016191056092"></p><p>保险起见，我们找一下道氏技术的信息（或者搜索一个其他股票对一下）</p><p><img src="https://bu.dusays.com/2022/10/16/634be76aa46ad.png" alt="image-20221016191346392"></p><p>没错，就是这样了。</p><p>因此，所有信息我们都有了。核心的下载代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">query_url = <span class="hljs-string">&quot;http://www.cninfo.com.cn/new/hisAnnouncement/query&quot;</span><br>download_url = <span class="hljs-string">&quot;http://static.cninfo.com.cn&quot;</span><br><span class="hljs-keyword">if</span> end_date == <span class="hljs-literal">None</span>:<br>    end_date = start_date<br>data = &#123;<br>    <span class="hljs-string">&quot;pageNum&quot;</span>:    <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;pageSize&quot;</span>:    <span class="hljs-string">&quot;30&quot;</span>,<br>    <span class="hljs-string">&quot;column&quot;</span>:    <span class="hljs-string">&quot;szse&quot;</span>,<br>    <span class="hljs-string">&quot;tabName&quot;</span>:    <span class="hljs-string">&quot;fulltext&quot;</span>,<br>    <span class="hljs-string">&quot;plate&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;stock&quot;</span>: <span class="hljs-string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(stockid, org_id),<br>    <span class="hljs-string">&quot;searchkey&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;secid&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;category&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;trade&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;seDate&quot;</span>: <span class="hljs-string">&quot;&#123;&#125;~&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(start_date, end_date),<br>    <span class="hljs-string">&quot;sortName&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;sortType&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;isHLtitle&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>&#125;<br>c = requests.post(query_url, data=data, headers=&#123;<span class="hljs-string">&#x27;user-agent&#x27;</span>: ua&#125;)<br></code></pre></td></tr></table></figure><p>其他的工作就是解析返回的json 与下载链接。本文就不再叙述了。</p><h2 id="结语">结语</h2><p>巨潮资讯还是好爬的，完全没有做任何反爬。</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从零开始的 NixOS 教程（安装篇）</title>
    <link href="/2022/09/18/nixos-installation/"/>
    <url>/2022/09/18/nixos-installation/</url>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>与 archlinux 不同， NixOS(以下简称 Nix)因其可复现构建的特性而更加适合服务器。简单来说，在 archlinux 上，你在不同的时间构建同一个版本的软件，构建出来很可能是不一样的，而在 Nix 上，不同时间构建出来的同一份软件<strong>应当是</strong>二进制级别的相同，而这种特性就非常适合服务器。同时 Nix 每个包的依赖都是独立的，都放在 <code>/nix/store</code>下面的子文件夹，文件夹名称通常是 对应构建的 id，不同版本的依赖直接自动链接到对应的文件。 但是 Nix 由于不支持 <a href="https://zh.m.wikipedia.org/zh-hans/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84%E6%A0%87%E5%87%86">FHS</a> 规范，个人认为不太适合当成个人电脑的系统，个人电脑上也不需要可复现的构建（至少我作为打包者也不关心，我只要最新的，不要可复现）。还有就是 Nix 应该会在 <code>/nix/store</code> 下面存放好多个不同版本的软件（作为依赖引入嘛），所以磁盘空间会消耗得比较快（服务器上当然无所谓啦）。</p><p>闲话就说到这。我之前申请了甲骨文的 ARM 免费服务器，配置为 4c24g,100G. 由于 arch 没有官方的 arm 支持，所以后来装了 Nix, 但是我还不太会 Nix, 当时是用 cloudinit 脚本一键安装的，安装完完全不会用。想要学也不知道从何开始。因为非常羡慕 <a href="https://github.com/NickCao/flakes">NickCao</a> 把 他的 Nix 配置直接放在 github，然后服务器自己去拉取最新配置（也可能是push 的时候自动触发服务器来拉取），总之就非常的炫，管理起来也非常方便， 因而我一心想要学习 Nix 的 flake 使用。但是我完全不懂 Nix, 看了些资料也没明白我要如何开始直接用 flake, 而不是手动去维护一堆 <code>/etc/nixos/</code> 下面的文件。</p><p>后来想到，我当初怎么学 archlinux 的？ 去手动安装它啊！遇到不懂的就去查手册、查wiki 呀。我决定也这样子开始学一下 Nix。因此有了这篇从零开始的 Nix 安装教程。</p><h2 id="安装">安装</h2><h3 id="前期准备">前期准备</h3><p>我打算新建一个 qemu 虚拟机用来跑 Nix, 首先去 <a href="https://nixos.org/download.html#nixos-iso">NixOS 下载页</a> 下载最新的 NixOS 镜像，我有 arch 的经验，因此更偏好于 minimal installation, 而且我的目的也是用在服务器上面，不需要图形界面。</p><p>下载完毕之后直接进 qemu (我用 virtmanager)，新建 nixos 的虚拟机，这一步不展开说。</p><p>我们启动 新建好的 虚拟机，跟着<a href="https://nixos.org/manual/nixos/stable/index.html#sec-installation">官方的安装教程</a>一步步开始走。</p><p>进入 livecd 之后，默认登录的用户是 <code>nixos</code>, 我们使用 <code>sudo su</code> 来切换到 <code>root</code>. 然后检查网络是否正常，可以通过 <code>ip a</code> 查看。一般来说都是正常的，我们是通过虚拟机共享的宿主网络。</p><h3 id="磁盘分区">磁盘分区</h3><p>然后我们就可以开始给磁盘分区了，官方教程用的 <code>gparted</code> 我更喜欢用 <code>fdisk</code>。先用 <code>fdisk -l</code> 看下我们的虚拟磁盘叫什么名字，不出意外是叫 <code>vda</code> (我打命令的时候老是打成 <code>sda</code>)。</p><p>现在我们使用 <code>fdisk</code> 对磁盘进行分区。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">fdisk /dev/vda<br></code></pre></td></tr></table></figure><p>接下来在 新建一个<code>boot</code> 分区，输入 <code>n</code> (表示 new), 起始点默认，大小选择 <code>+512M</code> 然后回车。接着创建主分区，输入 <code>n</code> 然后一路回车（我们把剩下所有空间都分给它）。</p><p>接着调整分区类型，输入 <code>t</code> (表示 type)，先选 <code>1</code>(这是我们的 <code>boot</code> 分区)， 然后类型输入 <code>EF</code> (表示 EFI)， 接着继续输入 <code>t</code>, 选择 <code>2</code>, 类型选择 <code>linux</code>。<br>更改完类型之后输入 <code>w</code> (表示 write) 然后输入 <code>q</code> 退出。</p><p>我们还要格式化磁盘，首先格式化 <code>boot</code> 分区为 <code>FAT32</code> 格式。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkfs.fat -F 32 -n boot /dev/vda1<br></code></pre></td></tr></table></figure><p>格式化主分区为你喜欢的格式(这里我选的 <code>btrfs</code>, 你也可以使用 <code>ext4</code>, 反正随便尝试嘛，我就想试试这个，我自己笔记本电脑上还是用的 <code>ext4</code>).</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkfs.btrfs -L nixos /dev/vda2<br></code></pre></td></tr></table></figure><p>现在我们已经调整好磁盘了，开始准备 <code>chroot</code>了。</p><h3 id="开始安装">开始安装</h3><p>先将 主分区 <code>vda2</code> 挂载到 <code>/mnt</code> 下面</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mount /dev/vda2 /mnt<br></code></pre></td></tr></table></figure><p>然后在 <code>/mnt</code> 下面创建 <code>boot</code> 目录并挂载 <code>vda1</code> 到 该目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir /mnt/boot<br>mount /dev/vda1 /mnt/boot<br></code></pre></td></tr></table></figure><p>接着就可以生成配置文件了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nixos-generate-config --root /mnt<br></code></pre></td></tr></table></figure><p>我们先修改配置文件（在这一步我踩了好多坑，改了好多次配置文件才通过），你不喜欢 <code>nano</code> 的话可以用 <code>vim</code>, 我自己也使用 <code>vim</code> (不会 <code>nano</code>)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nano /mnt/etc/nixos/configuration.nix<br></code></pre></td></tr></table></figure><p>我选择的是用 <code>grub</code> 启动，所以把 <code>grub</code> 相关的选项都启用了（删掉行首的 <code>#</code>）。值得注意的是，需要修改以下这些行</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nix">boot.loader.efi.<span class="hljs-attr">efiSysMountPoint</span> = <span class="hljs-string">&quot;/boot&quot;</span> <span class="hljs-comment">#这里本来是 /boot/efi</span><br>boot.loader.grub.<span class="hljs-attr">device</span> = <span class="hljs-string">&quot;/dev/vda&quot;</span> <span class="hljs-comment"># 这里本来是 sda,但是我们是虚拟机，是 vda</span><br></code></pre></td></tr></table></figure><p>其他的时区、键盘、网络这些我都先没有改。我下一个改的是</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nix">enviroment.<span class="hljs-attr">systemPackages</span> = <span class="hljs-keyword">with</span> pkgs; [<br>    vim<br>    wget<br>];<br></code></pre></td></tr></table></figure><p>不然默认没有 <code>vim</code> 用，而且要记得取消掉最后那个<code>];</code> 的注释，我之前就是因为这个，安装的时候，配置文件检查始终不通过。</p><p>我还启用了 OpenSSH daemon</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">services.openssh.<span class="hljs-attr">enable</span> =<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>改好了之后退出（<code>nano</code> 下面提示的 <code>^</code> 表示 <code>Ctrl</code>）</p><p>最后我们就可以运行 <code>nixos-install</code> 来安装啦。如果没成功，你可以使用如下命令来看哪里有问题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nixos-install --show-trace<br></code></pre></td></tr></table></figure><p>并返回上一步去修改 <code>/mnt/etc/nixos/configuration.nix</code>，再重新执行 <code>nixos-install</code>。<br>成功了的话，在最后一步， <code>nixos-install</code> 会提示你设置 root 密码。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">setting root password...<br>New password: ***<br>Retype new password: ***<br></code></pre></td></tr></table></figure><p>最后执行 <code>reboot</code> 重启就装好了。</p><p>装好 Nix 之后我们仍然可以继续修改 <code>/etc/nixos/configuration.nix</code> ，要切换到修改后的配置需要手动运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nixos-rebuild switch<br></code></pre></td></tr></table></figure><h3 id="使用-SSH-连接">使用 SSH 连接</h3><p>接着我打算采用远程 VNC 登录，毕竟我的 virtmanager 比较简陋，现在还没法从外面复制然后在虚拟机粘贴，而 remmina 可以将剪贴板通过击键的方式发送到远程（有字数限制）。<br>在 qemu 对应的虚拟机界面找到 VNC（如果没有先自己添加），虚拟机启动后会显示端口。<br><img src="https://bu.dusays.com/2022/09/18/6326be53029dd.png" alt="VNC 端口"></p><p>我们下面就可以在 remmina 中使用 VNC 通过 localhost:5901 连接到虚拟机。</p><p>接着我们在 <code>configuration.nix</code> 里面添加上 ssh 公钥，之后我们就可以通过 ssh 从主机连到虚拟机了，各种复制粘贴也都可以很方便地使用了。（这里你需要自己学习生成 ssh 密钥）</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nix">users.users.root.openssh.authorizedKeys.<span class="hljs-attr">keys</span> = [<br>    <span class="hljs-string">&quot;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFzXaUe7Y/3ptNG+xdAf+jC7g1Z7Kj+yXdfcQKZpvsy4 sukanka&quot;</span><br>];<br></code></pre></td></tr></table></figure><p>现在开始我们在虚拟机里面执行 <code>ip a</code> 来查看虚拟机的 ip.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@nixos:/etc/nixos]# ip a<br>...<br>2: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    link/ether 52:54:00:2c:d5:fd brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.122.50/24 brd 192.168.122.255 scope global dynamic noprefixroute enp1s0<br>       valid_lft 3109sec preferred_lft 2484sec<br>    inet6 fe80::5054:ff:fe2c:d5fd/64 scope link<br>       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><p>这里这个 <code>192.168.122.50</code> 就是我们需要的 ip. 之后就可以在外部通过如下的命令连接虚拟机 (<code>~/.ssh/YOU_PRIVATE_KEY</code> 替换成你的私钥文件路径)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh root@192.168.122.50 -i ~/.ssh/YOU_PRIVATE_KEY<br></code></pre></td></tr></table></figure><h2 id="添加-flake-支持">添加 flake 支持</h2><p>首先还是按照 arch 用户的惯例，换上 unstable 源再说。在这里我也踩了个坑。<br>刚开始看的 <a href="https://www.reddit.com/r/NixOS/comments/pu6zk0/comment/he1o5i8/?utm_source=share&amp;utm_medium=web2x&amp;context=3">reddit 帖子</a><br>添加了 unstable 源， 然后我居然把默认的 nixos 源移除了，后来 <code>nixos-rebuild switch</code> 怎么都过不了。结果看到 <a href="https://nixos.wiki/wiki/Nix_channels">Nix-Channels</a> 上面说，必须要添加一个基础源，而且源的名字必须要是 nixos。<br>所以我们实际上的操作如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nix-channel --add https://nixos.org/channels/nixos-unstable nixos<br></code></pre></td></tr></table></figure><p>接着使用 <code>nix-channel --list</code> 看一下有哪些源，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@nixos:/etc/nixos]# nix-channel  --list<br>nixos https://nixos.org/channels/nixos-unstable<br></code></pre></td></tr></table></figure><p>然后使用 <code>nix-channel --remove &lt;name&gt;</code> 移除你不需要的源。</p><p>要启用 flake 支持，需要在 <code>configuration.nix</code> 里面添加 （实际上只要 <code>flakes</code> 那行，我当时把 <code>experimental</code> 写成了 <code>experiment</code> 导致疯狂报错）</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123; pkgs, ... &#125;: &#123;<br>  nix.settings.<span class="hljs-attr">experimental-features</span> = [ <span class="hljs-string">&quot;nix-command&quot;</span> <span class="hljs-string">&quot;flakes&quot;</span> ];<br>&#125;<br></code></pre></td></tr></table></figure><p>然后创建 <code>/etc/nixos/flake.nix</code></p><h2 id="附录">附录</h2><h3 id="Nix-常用命令">Nix 常用命令</h3><ul><li><p><code>nixos-rebuild switch</code>: 修改完配置后，使配置生效</p></li><li><p><code>nixos-rebuild test</code>: 修改完配置后，使配置生效，但是不将它设置为默认启动项</p></li><li><p><code>nixos-rebuild boot</code>: 修改完配置后，将它设置为默认启动项,（但是要下次启动才生效，不立即生效）</p></li><li><p><code>nixos-rebuild switch -p test</code>： 使配置立即生效并将修改完的配置加入到 <code>grub</code> 选项并命名为 <code>test</code>.</p></li><li><p><code>nixos-rebuild build</code>： 测试配置能否通过构建（但是并不切换到该配置）</p></li></ul><h2 id="参考资料">参考资料</h2><ul><li>设置 unstable channel: <a href="https://microeducate.tech/how-to-add-nixos-unstable-channel-declaratively-in-configuration-nix/">https://microeducate.tech/how-to-add-nixos-unstable-channel-declaratively-in-configuration-nix/</a></li><li><a href="https://lantian.pub/en/article/modify-website/nixos-initial-config-flake-deploy.lantian/#nix-flake">NixOS Series 2: Basic Config, Nix Flake &amp; Batch Deploy</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nixos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用 mitmproxy 抓包 https</title>
    <link href="/2022/09/07/use-mitmproxy-to-record-https/"/>
    <url>/2022/09/07/use-mitmproxy-to-record-https/</url>
    
    <content type="html"><![CDATA[<p>这一次是要抓腾讯会议的包，前段时间有人在 AUR 给我维护的 <a href="https://aur.archlinux.org/packages/wemeet-bin">wemeet-bin</a> 标记了过期，并提供了新的版本号，但是，腾讯会议的下载链接不能由版本号完全确定。例如 <code>https://updatecdn.meeting.qq.com/cos/60bbaecfb3bf32615331b07d46001353/TencentMeeting_0300000000_3.10.0.400_x86_64_default.publish.deb</code> 这个链接中 <code>60bbaecfb3bf32615331b07d46001353</code> 的含义不明（其实是 deb 包 的 md5sum)，我们没法由版本号推断出下载链接。因而只能跟随官网更新。</p><p>一开始我尝试按照 <a href="https://blog.askk.cc/2022/07/22/%E4%BD%BF%E7%94%A8%20wireshark%20%E6%8A%93%E5%8C%85%20svstudio/">使用 wireshark 抓包 svstudio</a> 的经验，采用了 <code>SSLKEYLOGFILE</code> 环境变量，但是发现完全没有用， QT 的应用不吃这个环境变量<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[Support SSLKEYLOGFILE variable for debugging connections over SSL/TLS](https://bugreports.qt.io/browse/QTBUG-64310)">[1]</span></a></sup>，没有办法使用 Wireshark 来抓包。后来在群友的推荐下使用 mitmproxy 来抓包。</p><h2 id="具体步骤">具体步骤</h2><h3 id="安装">安装</h3><p>首先安装 <code>mitmproxy</code></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">yay -S mitmproxy</span><br></code></pre></td></tr></table></figure><p>然后执行 <code>mitmweb</code> 启动 web gui,  然后安装 mitmproxy 的证书。</p><p>进入 <code>~/.mitmproxy</code> 打开终端，先将证书转换为 <code>crt</code> 格式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">openssl x509 -inform der -in mitmproxy-ca-cert.cer -out mitmproxy-ca-cert.crt<br></code></pre></td></tr></table></figure><p>然后安装证书</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo trust anchor --store mitmproxy-ca-cert.crt<br></code></pre></td></tr></table></figure><h3 id="抓包">抓包</h3><p>使用 mitmproxy 抓包需要把流量重定向到 mitmproxy 的端口，默认 <code>127.0.0.1:8080</code>. 可以在系统设置里面设定代理，但是我这样做的话，在抓包的时候会导致 mitmproxy 崩溃，而且会抓到其他应用的包。具体信息如下</p><blockquote><p>mitmproxy has crashed.</p></blockquote><blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Error</span>: Minified React error #<span class="hljs-number">185</span>; visit https://reactjs.org/docs/error-decoder.html?invariant=<span class="hljs-number">185</span> for the full message or use the non-minified dev environment for full errors and additional helpful warnings.<br>    <span class="hljs-attribute">at</span> Jg (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">7</span>:<span class="hljs-number">8533</span>)<br>    <span class="hljs-attribute">at</span> Object.enqueueSetState (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">5</span>:<span class="hljs-number">44513</span>)<br>    <span class="hljs-attribute">at</span> Oc.setState (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">1</span>:<span class="hljs-number">3945</span>)<br>    <span class="hljs-attribute">at</span> t.onViewportUpdate (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">58</span>:<span class="hljs-number">48851</span>)<br>    <span class="hljs-attribute">at</span> t.componentDidUpdate (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">58</span>:<span class="hljs-number">48148</span>)<br>    <span class="hljs-attribute">at</span> t.componentDidUpdate (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">58</span>:<span class="hljs-number">46203</span>)<br>    <span class="hljs-attribute">at</span> Yi (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">7</span>:<span class="hljs-number">1828</span>)<br>    <span class="hljs-attribute">at</span> dk (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">9</span>:<span class="hljs-number">5215</span>)<br>    <span class="hljs-attribute">at</span> Dt.unstable_runWithPriority (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">1</span>:<span class="hljs-number">12961</span>)<br>    <span class="hljs-attribute">at</span> gg (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">5</span>:<span class="hljs-number">40220</span>)<br><br><span class="hljs-attribute">Component</span> Stack:<br>    <span class="hljs-attribute">at</span> AutoScrollWrapper (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">58</span>:<span class="hljs-number">45836</span>)<br>    <span class="hljs-attribute">at</span> ConnectFunction (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">51</span>:<span class="hljs-number">11352</span>)<br>    <span class="hljs-attribute">at</span> div<br>    <span class="hljs-attribute">at</span> MainView (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">58</span>:<span class="hljs-number">49804</span>)<br>    <span class="hljs-attribute">at</span> div<br>    <span class="hljs-attribute">at</span> ProxyAppMain (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">62</span>:<span class="hljs-number">3048</span>)<br>    <span class="hljs-attribute">at</span> ConnectFunction (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">51</span>:<span class="hljs-number">11352</span>)<br>    <span class="hljs-attribute">at</span> Provider (http://<span class="hljs-number">127.0.0.1:8081</span>/static/app.js:<span class="hljs-number">51</span>:<span class="hljs-number">8664</span>)<br></code></pre></td></tr></table></figure></blockquote><p>因此我采用 <code>proxychains-ng</code> 把对腾讯会议进行代理，将它的流量重定向到 <code>mitmproxy</code>。</p><p>然后修改 <code>/etc/proxychains.conf</code></p><p>将最后一行改为 mitmproxychains 的地址。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span> <span class="hljs-number">127.0.0.1</span> <span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure><p>然后我们通过 <code>proxychains</code> 代理腾讯会议。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">proxychains wemeet<br></code></pre></td></tr></table></figure><p>现在我们就可以在 mitmweb 里面看到腾讯会议的各种请求了，而且全都是明文。我直接找到了腾讯会议检查更新的网址</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">https://meeting.tencent.com/web-service/query-app-<span class="hljs-keyword">update</span>-info?auth_type=package<span class="hljs-variable">&amp;os</span>=Linux<span class="hljs-variable">&amp;appid</span>=200000001<span class="hljs-variable">&amp;appver</span>=3.9.0.1<span class="hljs-variable">&amp;app_publish_channel</span>=TencentInside<span class="hljs-variable">&amp;app_uid</span>=144115222682129107<span class="hljs-variable">&amp;sdk_id</span>=0300000000<span class="hljs-variable">&amp;platform</span>=linux<span class="hljs-variable">&amp;arch</span>=x86_64<br></code></pre></td></tr></table></figure><p>直接访问这个网址就可以得到最新版的下载链接。</p><h2 id="后记">后记</h2><p>在尝试用 wireshark 抓包的过程中我还发现了腾讯会议会把更新包下载到 <code>/tmp/Temp</code> 文件夹下，因此只要拿到 deb 包， 算下 md5sum 我们就可以拿到下载链接了 (不过那时候我们还不知道下载链接里面那一串代表 md5) 。</p><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://bugreports.qt.io/browse/QTBUG-64310">Support SSLKEYLOGFILE variable for debugging connections over SSL/TLS</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mitmproxy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用 wireshark 抓包 svstudio</title>
    <link href="/2022/07/22/%E4%BD%BF%E7%94%A8%20wireshark%20%E6%8A%93%E5%8C%85%20svstudio/"/>
    <url>/2022/07/22/%E4%BD%BF%E7%94%A8%20wireshark%20%E6%8A%93%E5%8C%85%20svstudio/</url>
    
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>昨天我 AUR 上的包 <a href="https://aur.archlinux.org/packages/svstudio-bin">svstudio-bin</a> 又被人标记过期了，说提示应用内更新，新版本为 1.7.0。<br>但是我去官网查，发现官网没有放出更新，就只能自己抓包了。刚开始的时候是真的用不来 wireshark, 看着网上的教程说找 <code>GET</code> 请求，但是我发现我抓到的全是  TCP 或者 TLS,<br>根本就没有 HTTP 请求。后来在找对了关键词，搜索到了需要的方法才成功。</p><h2 id="具体过程">具体过程</h2><p>我最初看到的那篇文章现在找不到了，但是和 <a href="https://www.cnblogs.com/yurang/p/11505741.html">Wireshark解密HTTPS流量的两种方法</a> 的第二种方法是一样的。</p><p>首先在终端设置 <code>SSLKEYLOGFILE</code> 环境变量，</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">SSLKEYLOGFILE</span>=/tmp/ssl.log<br></code></pre></td></tr></table></figure><p>然后终端不要关，打开 wireshark, 找到 <code>编辑&gt;首选项&gt;protocol&gt;ssl</code>， 在 <code>(Pre)-Master-Secret log filename</code> 下面填入 <code>/tmp/ssl.log</code>,<br>保存后返回到 wireshark 主界面，开始抓包。<br>然后在刚刚的终端里面输入 <code>svstudio</code> 打开 svstudio, 它会开始检查更新，我们直接同意，让它开始下载。现在我们可以直接停止 wireshark 的抓包了。<br>然后在抓到的包里面，找到一堆 HTTP  GET 请求，里面就有我们需要的下载链接，同时我还找到了一个检查更新的链接，以后不用再重新抓包了。</p><p>本文到这里也就结束了。</p>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>wireshark</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>重新在 Oracle VPS 上安装 archlinux</title>
    <link href="/2022/07/04/reinstall-arch-on-oracle/"/>
    <url>/2022/07/04/reinstall-arch-on-oracle/</url>
    
    <content type="html"><![CDATA[<h2 id="故事背景">故事背景</h2><p>故事的背景其实有点惨，我之前的 oracle vps 在小太阳的帮助下装上了 archlinux, 而且平稳运行了大概两年的样子吧，后来我还把 matrix 部署在上面了。可是某一天更新了系统之后，它挂了！</p><p>ssh 也无法连上， vnc 也连不上（这其实是因为 <code>openssh</code> 更新了)，于是我又只能把  matrix 服务器转回国内。但是，从昨天开始，我matrix 开始看不了图片了，就算服务器挂梯子也不行，始终看不了图片（享受 IRC 待遇）。这可不行啊，得想办法把 matrix 再搬到国外，因此又想起了那台停机几个月的 vps。</p><p>这里插一句，如果要装成 NixOS 的话，非常方便，似乎有对应的 Could-init 文件，在初始化 vps 的时候添加进去就好了。但是 archlinux 没有。</p><hr><p>补充另一个方法： <a href="https://gist.github.com/JaHIY/48e8732b90d830ad1ca6183cc8e6c430">Kars Wang 的 gist</a>，这个方法不需要操作 UEFI shell 也能够实现重新分区，看起来咱走了弯路。</p><hr><h2 id="踩坑经历">踩坑经历</h2><p>这里大家看看就好，我只说哪些做法是不推荐的。</p><ul><li>首先，我自己的文章：<a href="https://blog.askk.cc/2022/02/14/install-ArchLinux-On-Oracle-VPS/">在 Oracle 免费 VPS 上安装 Archlinux</a> 肯定是不推荐了。但是可以看一看，有些基础的操作（比如开机器、<strong>连 VNC</strong>）还是值得一看的，但是具体步骤不能照搬。</li><li>然后是 Clansty 的文章：<a href="https://nyac.at/posts/cloud-server-arch-linux">在阿里云服务器上安装 Arch Linux </a>，如果你只有一台机器，那可以看这个，但是你有多台机器的话，我也不推荐你用 bootstrap 安装。</li><li>最后是 Netboot 的方式：如果你的服务器内存高于 <strong>2GiB</strong>（实际上好像高于1.5GiB 就可以), 那就直接用 Netboot 吧, 别看我的文章了。Netboot 我推荐两种安装方式，一种是 <a href="https://netboot.xyz/docs/quick-start">netboot.xyz</a>；另一种是 archlinux 官方的 netboot, 在 <a href="https://archlinux.org/releng/netboot/">https://archlinux.org/releng/netboot/</a> 下载 <a href="https://archlinux.org/static/netboot/ipxe-arch.16e24bec1a7c.efi">ipxe-arch.efi</a>，放到服务器的<code>/boot/EFI/rescue</code> 下面，然后连上  VNC，将服务器重启，在 UEFI 里面选择 IPXE 启动即可，或者找到下载的 efi 启动。</li></ul><h2 id="推荐的安装过程">推荐的安装过程</h2><p>如果你的 VPS 像我一样，只有 1GiB 的 RAM, 无法用 netboot 安装 archlinux, vps 提供商又不被 vps2arch 所支持，然后你又想完整地安装 archlinux (包括对硬盘重新分区，oracle 的 EFI 太小了，只有 106M)。 那么你应该看看我这一篇文章。</p><p>本文假定，你还有一台可用的 oracle 的 VPS，并且已经装上了 archlinux, 能够正常使用。（如果你另一台 vps 不是 archlinux, 那也没关系，你可以看 <a href="https://nyac.at/posts/cloud-server-arch-linux">在阿里云服务器上安装 Arch Linux </a>，把某些操作对应的替换过来就可以了。</p><h3 id="事前准备">事前准备</h3><p>首先按照 <a href="https://blog.askk.cc/2022/02/14/install-ArchLinux-On-Oracle-VPS/">在 Oracle 免费 VPS 上安装 Archlinux</a> 做好 <strong>连接服务器</strong> 与 <strong>连接 VNC</strong>.</p><p>现在，我们已经有一台 archlinux 服务器 (或者其他服务器，即前文的 I 机)，和一台 Ubuntu 20.04 的新开的机器（你开的什么就是什么）。</p><p>然后我们将 ubuntu 20.04 的机器<strong>关机</strong>，在甲骨文的面板上<strong>将它的引导卷分离下来</strong>，注意这是要新装 archlinux 的机器，注意左下角 <strong>资源&gt; 引导卷</strong>，然后点右边的三个点，分离引导卷。</p><p><img src="https://bu.dusays.com/2022/07/04/62c2bcf4f3335.png" alt="1656929522935.png"></p><p>聪明的你可能猜到我们要干什么了，没错，我们要把它挂载到另一台服务器上面，然后装好 archlinux 再挂载回来！</p><p>在 oracle 的网页面板上打开另一台服务器( archlinux, I机) ，找到对应的位置，附加上<strong>块存储卷</strong>，注意位置在 <strong>资源 &gt; 附加的块存储卷</strong></p><p><img src="https://bu.dusays.com/2022/07/04/62c2bdeceaea1.png" alt="1656929770190.png"></p><p>等一会等到附加完毕之后，找到右边的三个点<code>...</code> 点击，选择 <strong>iSCSI 命令和信息</strong>，展开 <strong>Linux</strong>, 会给你 连接（三条）和断开连接（两条）的命令，保存好。我这里就不截图出来了。</p><p><img src="https://bu.dusays.com/2022/07/04/62c2be996210b.png" alt="1656929943171.png"></p><p>然后通过 ssh 连上 I 机，进去之后复制那三条命令，就可添加上硬盘。如果你在这里遇到了错误，请参考 <a href="https://wiki.archlinux.org/title/Open-iSCSI">Open-iSCSI</a>，简单来说，你应该先安装</p><p><code>open-iscsi</code>软件包，然后启动对应的服务（并将它加入开机自启）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now iscsid<br></code></pre></td></tr></table></figure><p>然后再重新运行连接的三条命令，应该就可以了。</p><p>成功之后会有类似下面这样的输出,敏感信息用 <code>xxxx</code> 替代了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">New iSCSI node [tcp:[hw=,ip=,net_if=,iscsi_if=default] xxxxxxxxxxxxxxx] added<br>Logging <span class="hljs-keyword">in</span> to [iface: default, target: xxxxxxxxxxxxxx]<br>Login to [iface: default, target: xxxxxxxxxxxxxx] successful.<br></code></pre></td></tr></table></figure><p>然后我们看一下 目前的硬盘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsblk<br></code></pre></td></tr></table></figure><p>输出的结果大致上像这样</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tap">NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>sda       8:0   <span class="hljs-number"> 0 </span>46.6G <span class="hljs-number"> 0 </span>disk<br>|-sda1    8:1   <span class="hljs-number"> 0 </span>46.5G <span class="hljs-number"> 0 </span>part /<br>|-sda14   8:14  <span class="hljs-number"> 0 </span>   4M <span class="hljs-number"> 0 </span>part<br>`-sda15   8:15  <span class="hljs-number"> 0 </span> 106M <span class="hljs-number"> 0 </span>part /boot<br>sdb       8:32  <span class="hljs-number"> 0 </span>46.6G <span class="hljs-number"> 0 </span>disk<br>|-sdb1    8:33  <span class="hljs-number"> 0 </span> 512M <span class="hljs-number"> 0 </span>part<br>`-sdb2    8:34  <span class="hljs-number"> 0 </span>46.1G <span class="hljs-number"> 0 </span>part<br></code></pre></td></tr></table></figure><p>右边的 <code>/</code> 与 <code>/boot</code> 就是我们目前正在用的硬盘的分区，注意到 <code>/boot</code> 只有 106M，连两个内核都装不下，而 <code>sdb</code> （注意你的可能不是 <code>sdb</code>)就是我们新挂载上的硬盘，我们要将 archlinux 装到这个硬盘里面。</p><h3 id="开始安装">开始安装</h3><h4 id="分区">分区</h4><p>首先，我们将 <code>sdb</code> 重新分区</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> fdisk /dev/sdb<br></code></pre></td></tr></table></figure><p>输出如下</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Welcome <span class="hljs-built_in">to</span> fdisk (util-linux <span class="hljs-number">2.38</span>).<br>Changes will remain <span class="hljs-keyword">in</span> memory only, <span class="hljs-keyword">until</span> you decide <span class="hljs-built_in">to</span> <span class="hljs-built_in">write</span> them.<br>Be careful <span class="hljs-keyword">before</span> <span class="hljs-keyword">using</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">write</span> command.<br><br><br>Command (m <span class="hljs-keyword">for</span> help):<br></code></pre></td></tr></table></figure><p>输入 <code>d</code>, 删除分区，我输入了两次，把两个分区都删了。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Command</span> (m for help): d<br><span class="hljs-attribute">Partition</span> number (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>, default <span class="hljs-number">2</span>): <span class="hljs-number">2</span><br><br><span class="hljs-attribute">Partition</span> <span class="hljs-number">2</span> has been deleted.<br><br><span class="hljs-attribute">Command</span> (m for help): d<br><span class="hljs-attribute">Selected</span> partition <span class="hljs-number">1</span><br><span class="hljs-attribute">Partition</span> <span class="hljs-number">1</span> has been deleted.<br></code></pre></td></tr></table></figure><p>然后重新创建分区，输入 <code>n</code>,然后提示输入大小的时候输入 <code>+512M</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Command</span> (m for help): n<br><span class="hljs-attribute">Partition</span> number (<span class="hljs-number">1</span>-<span class="hljs-number">128</span>, default <span class="hljs-number">1</span>): <span class="hljs-number">1</span><br><span class="hljs-attribute">First</span> sector (<span class="hljs-number">34</span>-<span class="hljs-number">97677278</span>, default <span class="hljs-number">2048</span>):<br><span class="hljs-attribute">Last</span> sector, +/-sectors or +/-size&#123;K,M,G,T,P&#125; (<span class="hljs-number">2048</span>-<span class="hljs-number">97677278</span>, default <span class="hljs-number">97675263</span>): +<span class="hljs-number">512</span>M<br><br><span class="hljs-attribute">Created</span> a new partition <span class="hljs-number">1</span> of type &#x27;Linux filesystem&#x27; and of size <span class="hljs-number">512</span> MiB.<br></code></pre></td></tr></table></figure><p>然后再次输入 <code>n</code> 一路回车创建我们的第二个分区</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Command</span> (m for help): n<br><span class="hljs-attribute">Partition</span> number (<span class="hljs-number">2</span>-<span class="hljs-number">128</span>, default <span class="hljs-number">2</span>):<br><span class="hljs-attribute">First</span> sector (<span class="hljs-number">1050624</span>-<span class="hljs-number">97677278</span>, default <span class="hljs-number">1050624</span>):<br><span class="hljs-attribute">Last</span> sector, +/-sectors or +/-size&#123;K,M,G,T,P&#125; (<span class="hljs-number">1050624</span>-<span class="hljs-number">97677278</span>, default <span class="hljs-number">97675263</span>):<br><br><span class="hljs-attribute">Created</span> a new partition <span class="hljs-number">2</span> of type &#x27;Linux filesystem&#x27; and of size <span class="hljs-number">46</span>.<span class="hljs-number">1</span> GiB.<br></code></pre></td></tr></table></figure><p>然后输入 <code>p</code> 看一下我们的分区</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs tap">Command (m for help): p<br><br>Disk /dev/sdb: 46.58 GiB,<span class="hljs-number"> 50010783744 </span>bytes,<span class="hljs-number"> 97677312 </span>sectors<br>Disk model: BlockVolume<br>Units: sectors of<span class="hljs-number"> 1 </span>*<span class="hljs-number"> 512 </span>=<span class="hljs-number"> 512 </span>bytes<br>Sector size (logical/physical):<span class="hljs-number"> 512 </span>bytes /<span class="hljs-number"> 4096 </span>bytes<br>I/O size (minimum/optimal):<span class="hljs-number"> 4096 </span>bytes /<span class="hljs-number"> 1048576 </span>bytes<br>Disklabel type: gpt<br>Disk identifier: 6780050F-7A6E-4BDB-87EF-9993AC5C0EBA<br><br>Device       Start      End  Sectors  Size Type<br>/dev/sdb1    <span class="hljs-number"> 2048 </span><span class="hljs-number"> 1050623 </span><span class="hljs-number"> 1048576 </span> 512M Linux filesystem<br>/dev/sdb2 <span class="hljs-number"> 1050624 </span>97675263<span class="hljs-number"> 96624640 </span>46.1G Linux filesystem<br></code></pre></td></tr></table></figure><p>好像 <code>sdb1</code> 的类型不太对，我们给它改一下，输入 <code>t</code>, 然后输入<code>1</code>（分区编号）， 再输入<code>1</code> （分区类型）</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Command (m <span class="hljs-keyword">for</span> help): t<br><span class="hljs-keyword">Partition</span> number (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>, <span class="hljs-keyword">default</span> <span class="hljs-number">2</span>): <span class="hljs-number">1</span><br><span class="hljs-keyword">Partition</span> <span class="hljs-keyword">type</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">alias</span> (<span class="hljs-keyword">type</span> L <span class="hljs-keyword">to</span> list <span class="hljs-keyword">all</span>): <span class="hljs-number">1</span><br><br>Changed <span class="hljs-keyword">type</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">partition</span> <span class="hljs-string">&#x27;Linux filesystem&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;EFI System&#x27;</span>.<br></code></pre></td></tr></table></figure><p>可以看到分区类型已经成功改为 <code>EFI</code> 了。最后 <strong>输入 <code>w</code> 保存</strong>。（我就不输入了，我都已经装好了，保存了我装好的系统就没了）。</p><h4 id="pacstrap">pacstrap</h4><p>这一步其实是参考的 <a href="https://www.viseator.com/2017/05/17/arch_install/">以官方Wiki的方式安装ArchLinux</a>，但是我把重要的内容都抄过来了，大家没必要点进去（嘿嘿）。</p><p>然后我们将硬盘挂载到对应文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> mount /dev/sdb2 /mnt/<br><span class="hljs-built_in">sudo</span> mount /dev/sdb1 /mnt/boot<br></code></pre></td></tr></table></figure><p>没有报错的话，我们就挂载好啦。由于我们是境外服务器嘛，没必要改镜像，我们直接用 <code>pacstrap</code> 安装一些必要的包进去。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacstrap /mnt base base-devel linux linux-firmware dhcpcd<br></code></pre></td></tr></table></figure><p>然后生成 <code>fstab</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> genfstab -L /mnt &gt;&gt; /mnt/etc/fstab<br></code></pre></td></tr></table></figure><p>然后我们要 看一下 <code>fstab</code> 对不对（<strong>其实这里生成的 <code>fstab</code> 不对哦</strong>）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /mnt/etc/fstab<br></code></pre></td></tr></table></figure><p>结果如下，注意：**你看到的跟我的不一样！**你的应该是写的 <code>/dev/sdb</code> 之类的，你需要自己把他们改成 <code>UUID</code> 这样的，具体的 <code>UUID</code> 里面有。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># Static information about the filesystems.</span><br><span class="hljs-comment"># See fstab(5) for details.</span><br><br><span class="hljs-comment"># &lt;file system&gt; &lt;dir&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;</span><br><span class="hljs-comment"># /dev/sdb2 UUID=fc934606-93e4-4748-b2b9-faf07f2dec9b</span><br><span class="hljs-attribute">UUID</span>=fc934606-93e4-4748-b2b9-faf07f2dec9b               /               ext4            rw,relatime,<span class="hljs-attribute">stripe</span>=256  0 1<br><br><span class="hljs-comment"># /dev/sdb1 UUID=EF87-F5A7</span><br><span class="hljs-attribute">UUID</span>=EF87-F5A7                  /boot           vfat            rw,relatime,<span class="hljs-attribute">fmask</span>=0022,dmask=0022,codepage=437,iocharset=ascii,shortname=mixed,utf8,errors=remount-ro   0 2<br><br>/swapfile               none            swap            defaults        0 0<br></code></pre></td></tr></table></figure><p><strong>注意到我们还多了个 <code>/swapfile</code> 所以我们也必须要创建一个 <code>swapfile</code> 或者你可以把那行注释掉。</strong></p><h4 id="chroot">chroot</h4><p>然后我们可以 <code>chroot</code> 进去了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> arch-chroot /mnt<br></code></pre></td></tr></table></figure><p>先设置时区</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br>hwclock --systohc<br></code></pre></td></tr></table></figure><p>装一些必要的包，过程中一路确认就好</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacman -S vim <span class="hljs-built_in">sudo</span> sshd dhcpcd<br></code></pre></td></tr></table></figure><p>设置下 <code>locale</code>,在里面启用 <code>en_US.UTF-8 UTF-8</code> 就行了，服务器上不需要中文。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>locale.gen<br></code></pre></td></tr></table></figure><p>然后执行</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">locale-gen</span><br></code></pre></td></tr></table></figure><p>然后打开<code>locale.conf</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /etc/locale.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><p>在文件里面第一行写入</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">LANG</span><span class="hljs-operator">=</span>en_US.UTF-<span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><p>保存退出。</p><p>现在开始设置主机名</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /etc/<span class="hljs-built_in">hostname</span><br></code></pre></td></tr></table></figure><p>在第一行输入你设置的主机名，假设是 <code>myhostname</code>，保存并退出。</p><p>编辑<code>/etc/hosts</code>文件：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>hosts<br></code></pre></td></tr></table></figure><p>在文件末尾添加（将<code>myhostname</code>替换成你自己设定的主机名），实际上这里<strong>还应该将你的服务器的公网IP 也映射到 <code>localhost</code></strong> 但是不做也无所谓。</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>localhost<br>::<span class="hljs-number">1</span>localhost<br><span class="hljs-number">127.0.1.1</span>myhostname.localdomainmyhostname<br></code></pre></td></tr></table></figure><p>保存并退出。</p><p>现在开始输入 <code>passwd</code> 设置<code>root</code> 的密码，注意密码需要输入两遍，不会有回显。</p><p>然后我们安装 <code>ucode</code>, intel 的就输入 <code>intel-ucode</code> （Oracle 好像是 AMD 的，那就换成 <code>amd-ucode</code>）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacman -S amd-ucode<br></code></pre></td></tr></table></figure><p>然后我们安装 <code>grub</code></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">pacman -S grub efibootmgr</span><br></code></pre></td></tr></table></figure><p>部署 <code>grub</code>并生成配置文件</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">grub-install <span class="hljs-attribute">--target</span>=x86_64-efi <span class="hljs-attribute">--efi-directory</span>=/boot <span class="hljs-attribute">--bootloader-id</span>=grub<br>grub-mkconfig -o /boot/grub/grub.cfg<br></code></pre></td></tr></table></figure><p><strong>注意：如果你前面的 <code>fstab</code> 里面有 <code>/swapfile</code></strong>，</p><p>请创建 <code>swapfile</code> 不然启动会失败，这里我创建 2G</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/swapfile bs=1M count=2048 status=progress<br></code></pre></td></tr></table></figure><p>修改权限并初始化，然后启动它。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 0600 /swapfile<br>mkswap  /swapfile<br>swapon /swapfile<br></code></pre></td></tr></table></figure><p>如果你已经是一个老手，你可以在这里就设置好你的用户，配置好 <code>sudo</code>, 同时不要忘记将你的 ssh 公钥写入到你用户的 <code>authorized_keys</code></p><h4 id="配置用户">配置用户</h4><p>我们首先创建一个用户，请将 <code>username</code> 替换为你的用户名。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">useradd -m -G wheel username<br></code></pre></td></tr></table></figure><p>然后为它设置一个密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">passwd username<br></code></pre></td></tr></table></figure><p>再为它配置 <code>sudo</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">EDITOR=vim visudo<br></code></pre></td></tr></table></figure><p>找到</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"># %wheel <span class="hljs-keyword">ALL</span>=(<span class="hljs-keyword">ALL</span>:<span class="hljs-keyword">ALL</span>) NOPASSWD: <span class="hljs-keyword">ALL</span><br></code></pre></td></tr></table></figure><p>去掉前面的 <code>#</code>， 然后保存退出，这样我们的用户不需要密码就能使用 <code>sudo</code> 了。</p><h4 id="退出-chroot">退出 chroot</h4><p>我们的系统差不多要安装好了，下面退出 <code>chroot</code>，并卸载硬盘。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span><br>sudo umount -R /mnt<br></code></pre></td></tr></table></figure><p>如果提示</p><figure class="highlight mercury"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mercury">umount: /mnt: target <span class="hljs-keyword">is</span> busy.<br></code></pre></td></tr></table></figure><p>我们就使用 下面的命令卸载。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> umount -R /mnt -l<br></code></pre></td></tr></table></figure><p>然后我们还要把硬盘卸载下去，因为要挂载回另外一台机器上了。</p><p>最后我们找到这台机器<strong>附加的块存储卷</strong>，找到 <strong>iSCSI 命令和信息</strong>， 复制其中的 <strong>断开连接</strong> 命令，并输入，应该会提示</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">Logging</span> <span class="hljs-string">out</span> <span class="hljs-string">of</span> <span class="hljs-string">session</span> [<span class="hljs-attr">sid:</span> <span class="hljs-number">6</span>, <span class="hljs-attr">target:</span> <span class="hljs-string">xxxxxxxxxxxxxxxxxxx</span>]<br><span class="hljs-string">Logout</span> <span class="hljs-string">of</span> [<span class="hljs-attr">sid:</span> <span class="hljs-number">6</span>, <span class="hljs-attr">target:</span> <span class="hljs-string">xxxxxxxxxxxxxxxxx</span>] <span class="hljs-string">successful.</span><br></code></pre></td></tr></table></figure><p>然后我们直接<strong>分离块存储卷</strong>。</p><p><img src="https://bu.dusays.com/2022/07/04/62c2ca71bfc89.png" alt="1656932975616.png"></p><p>给新机器 (ubuntu 20.04,但是快要是 arch 了) 附加引导卷，在对应机器页面的 <strong>资源&gt; 引导卷</strong> 下面。</p><h3 id="配置-UEFI">配置 UEFI</h3><p>首先我们先连上 VNC，请参见 <a href="###%E4%BA%8B%E5%89%8D%E5%87%86%E5%A4%87">事前准备</a>，在我们在 I 机上面装好 <code>tmux</code>, 并运行 <code>tmux</code></p><p>粘贴中转  vnc 的 命令进去，然后按  <code>ctrl+b</code> 再按 <code>d</code> 分离 <code>tmux</code>，免得我们 ssh 断开后中转也自动断开了。注意，如果这里 VNC 连接断了，请重新连接，并检查中转服务是不是也断了，中转服务也断了请重新连接中转服务。</p><p>然后我们在本地用 <code>remmia</code> 连上  VNC。注意 VNC 的画面，同时给 新机器开机，在 VNC 那里疯狂按 <code>F2</code> 来进入 <code>UEFI</code> 页面。</p><p>进入到 UEFI 之后画面大概像这样，里面有 Boot manager, 但是好像什么都干不了。也有 Boot Maintainance Manager,能够干一些事情。</p><p><img src="https://bu.dusays.com/2022/07/04/62c2cd2046b5d.png" alt="1656933662022.png"></p><p>比如 Boot Maintainance Manger 里面能够改  Boot order, 但是实际上没有用。这里就不展示了。</p><p>我们选择 Boot Manger，再选择 EFI Internal Shell, 回车进入 shell.</p><p><img src="https://bu.dusays.com/2022/07/04/62c2ce6417ee9.png" alt="1656933986185.png"></p><p><strong>注意： 此处开始不能用 <code>ctrl+v</code> 粘贴了，但是 remmia 有自带的将剪贴板逐字发送到 VNC 的功能，扳手🔧图标就是</strong></p><p>我们输入如下命令查看现有的启动项。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bcfg boot dump<br></code></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2022/07/04/62c2cf09c8be5.png" alt="1656934152288.png"></p><p>这是我的启动项，第一个已经被改成 archlinux 了，你的第一个应该是 <code>UEFI ORACLE BlockVolume</code>. 而且你没有 <code>Option: 04</code>.</p><p>然后我们添加一个 grub 启动项，序号为<code>4</code>，命名为 <code>archlinux</code></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">bcfg </span><span class="hljs-keyword">boot </span><span class="hljs-keyword">add </span><span class="hljs-number">4</span> fs0:\EFI\grub\grubx64.efi <span class="hljs-string">&quot;archlinux&quot;</span><br></code></pre></td></tr></table></figure><p>然后我们将它移动到编号为 0的位置</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bcfg</span> boot mv <span class="hljs-number">4</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>你可能以为这就管用了，其实并没有，真正管用的是下一步。</p><p>我们删除掉 <code>ORACLE</code> 的启动项，它现在编号应该为 <code>4</code>。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">bcfg </span><span class="hljs-keyword">boot </span>rm <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>然后我们输入 <code>exit</code> 退出 shell. 回到 <code>Boot Maintainance Manager &gt; Boot Options &gt; Change Boot Order</code> 可以看到，我们的 <code>archlinux</code> 启动项变成了第一位！</p><p><img src="https://bu.dusays.com/2022/07/04/62c2d0c699d09.png" alt="1656934595781.png"></p><p>然后我们回到 UEFI 主页面，选择 <strong>Continue</strong>，就看到熟悉的 <code>grub</code> 啦</p><p><img src="https://bu.dusays.com/2022/07/04/62c2d47fd07df.png" alt="1656935550278.png"></p><p>进去了之后登录 <code>root</code> 帐号，然后我们要启动 <code>dhcpcd</code> 与 <code>sshd</code> 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> --now dhcpcd<br>systemctl <span class="hljs-built_in">enable</span> --now sshd<br></code></pre></td></tr></table></figure><p>然后就可以尝试通过 <code>ssh</code> 连接到服务器了。本文到这里也就完结了。<br>最后附上一张 <code>neofetch</code> 结果。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">╭─sukanka@oarch ~<br>╰─$ neofetch --off<br>sukanka@oarch<br>-------------<br>OS: Arch Linux x86_64<br>Host: KVM/QEMU (Standard PC (i440FX + PIIX, 1996) pc-i440fx-4.2)<br>Kernel: 5.18.9-arch1-1<br>Uptime: 54 mins<br>Packages: 166 (pacman)<br>Shell: zsh 5.9<br>Resolution: 1024x768<br>Terminal: /dev/pts/0<br>CPU: AMD EPYC 7551 (2) @ 1.996GHz<br>GPU: 00:02.0 Vendor 1234 Device 1111<br>Memory: 115MiB / 964MiB<br><br><br>╭─sukanka@oarch ~<br>╰─$ lsblk<br>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>sda      8:0    0 46.6G  0 disk<br>├─sda1   8:1    0  512M  0 part /boot<br>└─sda2   8:2    0 46.1G  0 part /<br></code></pre></td></tr></table></figure><h2 id="参考文章">参考文章</h2><ul><li><a href="https://lixingcong.github.io/2018/06/12/uefi-shell/">UEFI Shell常用命令</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>archlinux</tag>
      
      <tag>VPS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用 Bitwarden 管理密码</title>
    <link href="/2022/07/02/use-bitwarden/"/>
    <url>/2022/07/02/use-bitwarden/</url>
    
    <content type="html"><![CDATA[<p>最近出了超星学习通的数据泄漏了一次，然后在6月27号的时候，腾讯QQ 发生了大面积的盗号事件，被盗的帐号在各种群里面发色图，造成一大群人社死。</p><p>出于惰性，我们设置密码时总是喜欢设置重复的密码，重复的用户名，重复的邮箱。这样一下就能想起来帐号密码，登录十分方便，但是一旦发生密码泄漏事件，就会导致多个帐号被盗，因为这些帐号用的都是同样的密码嘛。举个例子，要是我微博跟豆瓣用的同样的帐号密码，如果我微博被盗了或者微博的用户数据泄漏了，盗号者知道了我的微博密码，他可能也去豆瓣试试这个帐号跟密码，然后我豆瓣帐号也被盜了。</p><p>因此，偷懒用重复的密码是要不得的，况且，许多人密码甚至都懒得想，直接用烂大街的密码，比如手机号加一个字母啦，连续的数字啦，等等。这些密码就算不泄漏也很容易猜出来。那么，有没有一种办法，能够保护我们的密码，而我们又不用记太多密码呢？答案当然是有的，就是使用密码管理软件。</p><h2 id="常用的密码管理软件">常用的密码管理软件</h2><p>市面上常见的密码管理软件有 keepass, lastpass, 1password, bitwarden, google, apple 等等。</p><p>其中大多数人对于 google 跟 apple 都应该比较熟悉。google 的密码管理在登录上帐号就可以使用了，还能够进行多端同步，但是在苹果的设备上不好用。</p><p>同理，苹果的密码管理在 android 上也不好用。</p><p><a href="https://1password.com/zh-cn/">1password</a> 应该是一款老牌密码管理软件了，但是不开源，密码默认保存在它的服务器上，而且要钱，每月2.99美元的价格可不便宜。</p><p><a href="https://keepass.info/index.html">keepass</a> 是一款开源的密码管理器，目前比较流行的是 <a href="https://github.com/keepassxreboot/keepassxc">KeePassXC</a>, 开源，跨平台，功能也比较多，但是个人觉得不太美观。</p><p>Lastpass 就不说了，发生过数据泄漏，应该没人再用这个了吧。</p><p><a href="https://github.com/bitwarden">Bitwarden</a> 是一个开源免费的全平台密码管理软件，你既可以使用  Bitwarden Inc 提供的云服务，也可以自己搭建服务器后端，使用自己的服务器存储数据。如果你自建了服务器，你将直接解锁高级用户。Bitwarden 还能够创建组织，将其他用户邀请到组织，从而可以很方便的共享密码。</p><p>有人翻译了 Bitwarden 的文档： <a href="https://help.ppgg.in/">Bitwarden 帮助中心中文版</a>，上面详细介绍了 bitwarden 的特性。</p><p>如果你想自建 bitwarden 的后端的话，推荐自建 <a href="https://github.com/dani-garcia/vaultwarden">vaultwarden</a>, 这是用 rust 重写的 bitwarden 服务器端，中文文档参见: <a href="https://rs.ppgg.in/">Vaultwarden Wiki 中文版</a>。</p><p>搭建教程可以参见我以前写的 <a href="https://blog.askk.cc/2022/03/03/host-vaultwarden/">在 Archlinux 服务器上部署 vaultwarden</a>。</p><h2 id="使用-bitwarden">使用 bitwarden</h2><h3 id="注册与登录">注册与登录</h3><p>如果你使用的 Bitwarden Inc 提供的服务，那么注册与登录不会有任何困难，但是如果你使用的自建的服务，记得设置你自己的服务器，在这里点击左上角的设置图标，输入你的服务器地址。</p><p><img src="https://bu.dusays.com/2022/07/03/62c06f05d8779.png" alt="1656778496816.png"></p><p>Bitwarden 主要有 vaults, Send, 工具，报告，组织 五部分。</p><h3 id="Vaults">Vaults</h3><p>Vaults 就是我们存放密码的地方啦，你可以记录帐号密码、银行卡号、身份信息或者其他安全笔记，还可以将它们分类到不同的文件夹下。Bitwarden 还可以帮你管理帐号的两步验证，比如 TOTP 验证码，一些不重要的两步验证我都交给它管理了，重要的两步验证还是单独用 aegis 管理。</p><h3 id="Send">Send</h3><p>Send 功能可以让你将一些东西发送给别人，可以设置非常复杂的选项，比如访问次数限制，需要密码访问等等。</p><img src="https://bu.dusays.com/2022/07/03/62c06ca576587.png" alt="image-20220703000313524" style="zoom:50%;" /><h3 id="工具">工具</h3><p>这个功能是给我们生成密码或者用户名用的，密码的强弱主要在于密码的长度，密码越长，通常越难破解。Bitwarden 支持生成用户名、密码、密码短语。</p><p><img src="https://bu.dusays.com/2022/07/03/62c06d6793e34.png" alt="1656778084850.png"></p><h3 id="报告">报告</h3><p>这个页面主要是进行密码检查，比如检查弱密码、密码有没有泄漏、以及重复密码。</p><p><img src="https://bu.dusays.com/2022/07/03/62c06e1b258b3.png" alt="1656778265401.png"></p><h3 id="组织">组织</h3><p>组织就是你可以建一个小群，把一些密码移到组织里面，再拉一些人进来，让他们可以共享你的帐号跟密码。</p>]]></content>
    
    
    
    <tags>
      
      <tag>bitwarden</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在同一域名下部署 mastodon 与 matrix</title>
    <link href="/2022/05/05/mastodon-and-matrix-under-same-domain/"/>
    <url>/2022/05/05/mastodon-and-matrix-under-same-domain/</url>
    
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>前段时间部署了 matrix 服务器，并水了<a href="https://blog.askk.cc/2022/02/28/deploy-dendrite/">一篇博客</a>，现在又对 mastodon 心心念念，今天终于开始尝试 mastodon 了！ mastodon 的部署还是挺简单的，先安装 aur 的 <code>mastodon</code> 包， 按照 <code>postinstall</code> 的指示进行。很快我就将 mastodon 部署在了境内的腾讯云服务器上。</p><p>但是，我希望我的 local domain 是 <code>askk.cc</code>，web domain 是 <code>mastodon.askk.cc</code>， 这个诉求很简单，改一下 mastodon 的配置文件就行了，参见 <a href="https://docs.joinmastodon.org/admin/config/">mastodon 文档</a>. 不推荐参考 <a href="https://dallas.lu/zh-TW/use-your-primary-domain-as-an-mastodon-name">使用你的主网域作為 Mastodon 實例名</a>。</p><p>可是，还有个问题是，我的主域名已经被 matrix 占用了，并且，服务端 dendrite 部署在境外的服务器上，而且主域名 <code>askk.cc</code> 也解析到了境外。</p><p>我该怎么办呢？</p><h2 id="失败的尝试">失败的尝试</h2><p>首先呢，想到腾讯的 DNSPOD 可以将一个域名解析到多个 IP, 我将主域名解析到两个服务器不就行了嘛。我试了下，失败，一堆  matrix 的请求发到了 mastodon 所在服务器。</p><h2 id="成功的尝试">成功的尝试</h2><p>想到 Nick Cao 老师曾经提过， dendrite 的 homeserver 与 well-known server 不一定要在一台服务器上，于是我想到了把  dendrite 的 homeserver 搬到境内，well-known server 还是在境外，dendrite 也还是运行在境外的机器上。</p><p>mastodon 本身就支持 <code>LOCAL_DOMAIN</code> 跟 <code>WEB_DOMAIN</code>，根据我的需求, <code>WEB_DOMAIN</code> 是 <code>mastoson.askk.cc</code>，也就是 WEB 面板，<code>LOCAL_DOMAIN</code> 是 <code>askk.cc</code>，它决定了我的帐号叫 <code>@i@askk.cc</code>。根据 mastodon 的文档</p><blockquote><p>To install Mastodon on <code>mastodon.example.com</code> in such a way it can serve <code>@alice@example.com</code>, set <code>LOCAL_DOMAIN</code> to <code>example.com</code> and <code>WEB_DOMAIN</code> to <code>mastodon.example.com</code>. This also requires additional configuration on the server hosting <code>example.com</code> to redirect or proxy requests to <code>https://example.com/.well-known/webfinger</code> to <code>https://mastodon.example.com/.well-known/webfinger</code>. For instance, with nginx, the configuration could look like the following:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">location /.well-known/webfinger &#123;<br>  <span class="hljs-built_in">return</span> 301 https://mastodon.example.com<span class="hljs-variable">$request_uri</span>;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><p>我们只要在 <code>askk.cc</code> 的 Nginx 配置文件里面加上这么一段就可以了，最后我的 主域名配置文件变成了这样子</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">server_name</span> askk.cc;<br>    <span class="hljs-comment"># mastodon</span><br>    <span class="hljs-attribute">set</span> <span class="hljs-variable">$mastodon_host</span> mastodon.askk.cc;<br>    <span class="hljs-section">location</span> /.well-known/webfinger &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$mastodon_host</span><span class="hljs-variable">$request_uri</span>;<br>    &#125;<br><br>    <span class="hljs-comment">## matrix</span><br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">8448</span> ssl;<br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">8448</span> ssl;<br>    <span class="hljs-section">location</span> <span class="hljs-regexp">~ ^/_matrix/</span> &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://matrix.askk.cc:8008;<br>        <span class="hljs-comment">#proxy_pass http://127.0.0.1:8008;</span><br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$remote_addr</span>;<br>    &#125;<br>    <span class="hljs-section">location</span> /.well-known/matrix/server &#123;<br>        <span class="hljs-attribute">default_type</span> application/json;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.server&quot;: &quot;matrix.askk.cc:443&quot; &#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-section">location</span> /.well-known/matrix/client &#123;<br>        <span class="hljs-comment"># If your sever_name here doesn&#x27;t match your matrix homeserver URL</span><br>        <span class="hljs-comment"># (e.g. hostname.com as server_name and matrix.hostname.com as homeserver URL)</span><br>        <span class="hljs-attribute">default_type</span> application/json;<br>        <span class="hljs-attribute">add_header</span> Access-Control-Allow-Origin <span class="hljs-string">&#x27;*&#x27;</span>;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.homeserver&quot;: &#123; &quot;base_url&quot;: &quot;https://askk.cc&quot; &#125; &#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl ipv6only=<span class="hljs-literal">on</span>; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/askk.cc-<span class="hljs-number">0001</span>/fullchain.pem; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/askk.cc-<span class="hljs-number">0001</span>/privkey.pem; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="hljs-comment"># managed by Certbot</span><br><br>&#125;<br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">if</span> (<span class="hljs-variable">$host</span> = askk.cc) &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$host</span>/<span class="hljs-variable">$request_uri</span>;<br>    &#125; <span class="hljs-comment"># managed by Certbot</span><br><br><br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span> askk.cc;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">404</span>; <span class="hljs-comment"># managed by Certbot</span><br>&#125;<br></code></pre></td></tr></table></figure>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-99ad78da" role="button" aria-expanded="false" aria-controls="collapse-99ad78da">        <div class="fold-arrow">▶</div>下面是原来的方法，已经不建议使用了      </div>      <div class="fold-collapse collapse" id="collapse-99ad78da">        <div class="fold-content">          <p>先将 <a href="http://askk.cc">askk.cc</a> 解析到 mastodon 所在的服务器上。然后在该服务器上进行下面的操作。</p><p>修改 mastodon 的 nginx 配置 <code>/etc/nginx/conf.d/mastodon.conf</code>，在合适的位置加入了<code>include conf.d/matrix_homeserver.conf.sub;</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nginx">...<br><span class="hljs-section">server</span> &#123;<br>  <span class="hljs-attribute">server_name</span> askk.cc;<br>  <span class="hljs-attribute">set</span> <span class="hljs-variable">$mastodon_host</span> mastodon.askk.cc;<br>  <span class="hljs-attribute">root</span> /var/lib/mastodon/public;<br>  <span class="hljs-comment">#location /.well-known/acme-challenge/ &#123; allow all; &#125;</span><br>  <span class="hljs-comment">#location / &#123; return 301 https://$host$request_uri; &#125;</span><br>    <span class="hljs-comment"># 加入了下面这一行</span><br>  <span class="hljs-comment"># matrix server</span><br>  <span class="hljs-attribute">include</span> conf.d/matrix_homeserver.conf.sub;<br>    <span class="hljs-section">location</span> = /.well-known/host-meta &#123;<br>     <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://mastodon.askk.cc<span class="hljs-variable">$request_uri</span>;<br>  &#125;<br><br><br><span class="hljs-comment">## mastodon web url</span><br>  <span class="hljs-section">location</span> <span class="hljs-regexp">~ ^/(about/more|settings|web|pghero|sidekiq|admin|interact|explore|public|@.*|relationships|filters|terms|inert.css)</span>&#123;<br>      <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)</span> https://<span class="hljs-variable">$mastodon_host</span><span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br>  &#125;<br>...<br></code></pre></td></tr></table></figure><p>其中 <code>/etc/nginx/conf.d/matrix_homeserver.conf.sub</code> 的内容为</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">listen</span> <span class="hljs-number">8448</span> ssl  default_server;<br><span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">8448</span> ssl default_server;<br><br><span class="hljs-comment">## matrix url</span><br><span class="hljs-section">location</span> <span class="hljs-regexp">~ ^/_matrix/</span> &#123;<br>        <span class="hljs-comment">#rewrite  ^(.*) http://matrix.askk.cc:8008;</span><br>        <span class="hljs-attribute">proxy_pass</span> http://matrix.askk.cc:8008;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$remote_addr</span>;<br>&#125;<br><span class="hljs-section">location</span> /.well-known/matrix/server &#123;<br>                <span class="hljs-attribute">default_type</span> application/json;<br>                <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.server&quot;: &quot;matrix.askk.cc:443&quot; &#125;&#x27;</span>;<br>&#125;<br><br><span class="hljs-section">location</span> /.well-known/matrix/client &#123;<br>         <span class="hljs-comment"># If your sever_name here doesn&#x27;t match your matrix homeserver URL</span><br>         <span class="hljs-comment"># (e.g. hostname.com as server_name and matrix.hostname.com as homeserver URL)</span><br>         <span class="hljs-attribute">default_type</span> application/json;<br>         <span class="hljs-attribute">add_header</span> Access-Control-Allow-Origin <span class="hljs-string">&#x27;*&#x27;</span>;<br>         <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.homeserver&quot;: &#123; &quot;base_url&quot;: &quot;https://askk.cc&quot; &#125; &#125;&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>其实就是从境外服务器 dendrite 的 nginx 配置里面把  homeserver 部分的配置抄了出来。主要的点其实在于 <code>location ~ ^/_matrix/ </code> 这一段。后面的 well-known 我也顺便抄了过来。</p>        </div>      </div>    </div><p>最后重启 <code>nginx</code> 服务就好了。 matrix 跟 mastodon 运行在同一个域名下，并且一个在境内，一个在境外。</p><h2 id="总结">总结</h2><p>突然发现 dendrite 的配置真的非常灵活，有非常多的可能性，<s>而 mastodon 的话，感觉就不如 dendrite 灵活。</s> mastodon 也非常灵活！</p>]]></content>
    
    
    
    <tags>
      
      <tag>matrix</tag>
      
      <tag>mastodon</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>paru 进阶教程</title>
    <link href="/2022/04/27/paru/"/>
    <url>/2022/04/27/paru/</url>
    
    <content type="html"><![CDATA[<p>最近从 yay 换到了 paru, 但是 paru 不像 yay 一样有一个竹林写的 <a href="https://zhul.in/2021/04/04/yay-more/">yay进阶</a>， 因此，我打算开一个坑。</p><p><a href="https://github.com/Morganamilo/paru">Paru</a> 是 yay 的作者之一 Morganamilo 使用 rust 编写的另一个 aur helper。基本命令与功能与 yay 和 <code>pacman</code> 几乎一样，所以迁移过来不会有任何困难。</p><h2 id="基本用法">基本用法</h2><p>本部分也是摘抄自  <code>man paru</code>.</p><ul><li><code>paru</code></li></ul><p>当什么参数都不加的时候，默认是 执行 <code>paru -Syu</code>，首先从软件仓库查找更新，然后从 AUR 查找更新。</p><ul><li><code>paru &lt;search terms&gt;</code>  例如： <code>paru foo</code></li></ul><p>通过 <code>paru</code> 搜索带有 <code>foo</code> 关键词的软件包，并询问你要安装哪一个。以下是 <code>paru texlive-full</code> 的输出。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">1 aur/texlive-full 1:2022.20220406-1 [+5 ~0.00] [已安装]<br>    This packages provides texlive-full <span class="hljs-keyword">in</span> /opt. It also tricks ArchLinux into thinking it has its texlive packages installed.<br>:: 需要安装的包 (例如: 1 2 3, 1-3):<br>:: <br></code></pre></td></tr></table></figure><ul><li><code>paru &lt;operation&gt; [options] [targets]</code></li></ul><p>这里 <code>operation</code> 是一个必须参数，表示操作，用缩写的时候用一个大写字母表示。 例如 <code>-S</code> 表示 <code>--sync</code>, <code>options</code> 是选项，多个选项可以写在一起，例如 <code>paru --sync -y -u</code> 就是常见的 <code>paru -Syu</code>.</p><h2 id="Paru-特有的操作">Paru 特有的操作</h2><p><code>paru</code> 有以下几个操作：</p><ul><li><p><code>-P</code> (<code>--show</code>)</p><p>打印相关的选项</p></li><li><p><code>-G</code> (<code>--getpkgbuild</code>)</p><p>从 ABS (archlinux build system, arch 构建系统) 或者 AUR 下载 PKGBUILD， ABS 只能对 Arch LInux 软件仓库用。</p></li><li><p><code>-U</code> (<code>--upgrade</code>)</p><p>当不带目标执行的时候，与 <code>makepkg</code> 相同，构建当前文件夹下的 PKGBUILD</p></li><li><p><code>-L</code> (<code>--repoctl</code>)</p><p>列出所有仓库。</p></li><li><p><code>-C</code> (<code>--chrootctl</code>)</p><p>到 chroot 的交互式命令行。</p></li><li><p>如果不带任何操作，默认执行 <code>paru -Syu</code></p></li></ul><h2 id="扩展-pacman-的操作">扩展 pacman 的操作</h2><p>扩展到同时支持软件仓库和 AUR 的软件包的操作有</p><p><code>-R, -S, -Si, -Sl, -Ss, -Su, -Sc, -Qu, -T</code> 。</p><ul><li><p><code>-R</code></p><p><code>paru</code> 会同时清除关于 <code>devel</code> 包的缓存数据。</p></li><li><p><code>-Sc</code></p><p><code>paru</code> 会同时清除缓存的 AUR 软件包以及缓存中任何未被跟踪的文件。清除未被跟踪的文件会清除所有下载的 source 以及构建好的软件包，但是下载的 VCS source 会被保留。添加 <code>-d</code> 或者 <code>--delete</code> 可以删除整个软件包，而不是仅仅清理它。</p></li><li><p><code>-Ss</code></p><p>可以通过正则表达式搜索 AUR 软件包，但是必须通过 <code>-x</code> 或者 <code>--regex</code> 明确指定。不管 <code>--searchby</code> 如何设定，正则表达式都只匹配包名 (<code>pkgname</code>) 而不匹配描述 (<code>pkgdesc</code>)。</p></li><li><p><code>-Sss</code></p><p><code>paru</code> 会展示详细的搜索结果。</p></li><li><p><code>-S, -Si, -Sl, -Ss, -Su, -Qu</code></p><p>对于这些选项， <code>paru</code> 也能够处理 AUR 的包。</p></li><li><p><code>-Ts</code></p><p>从一列包中筛选出在 AUR 中的包。</p></li></ul><h3 id="无-operation">无 <code>operation</code></h3><p>当没有 <code>operation</code> 的时候， <code>paru</code> 默认是交互式搜索并询问用户要安装那个软件包.</p><p>如果也不带搜索内容，就默认是 <code>paru -Syu</code>. 下面介绍各种选项</p><ul><li><code>--gendb</code></li></ul><p>生成数据库，当且仅当从另一个 AUR helper 迁移到 paru 时，才应使用此选项。简单来说就是把 PKGBUILD 下载下来对比是否要更新。</p><ul><li><code>-c</code> (<code>--clean</code>)</li></ul><p>移除不被需要的依赖。如果它是某个包的 <code>make</code>或 <code>check</code> 或者可选依赖话，也不会被移除，这时可以使用 <code>-cc</code> 进行移除。</p><h2 id="打印信息相关-P-show">打印信息相关 <code>-P</code> (<code>--show</code>)</h2><ul><li><code>-c</code> (<code>--complete</code>)</li></ul><p>打印所有来自 AUR 和软件仓库的包，用于自动补全，<strong>用户不应直接使用</strong>。</p><ul><li><code>-s</code> (<code>--state</code>)</li></ul><p>展示安装的软件包的信息以及系统健康情况，以及是否有过期、孤儿包等。下面是 <code>paru -Ps</code> 的输出</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">paru v1.10.0 +git - libalpm v13.0.1</span><br><span class="hljs-section">===========================================</span><br>共安装包: 1543<br>AUR 包: 42<br>软件库包: 1500<br>单独指定安装的包: 349<br><span class="hljs-section">软件包共占用空间: 57.29GiB</span><br><span class="hljs-section">===========================================</span><br>最大的十个包:<br>matlab: 26.43GiB<br>texlive-full: 6.90GiB<br>cuda: 4.01GiB<br>anaconda: 3.18GiB<br>wps-office-cn: 1.19GiB<br>dingtalk-bin: 652.62MiB<br>zoom: 456.30MiB<br>go: 445.68MiB<br>nvidia-utils: 437.66MiB<br><span class="hljs-section">blender: 325.33MiB</span><br><span class="hljs-section">===========================================</span><br><span class="hljs-meta">:: 不在 AUR 中的软件包:</span> foxitpdfeditor-bin<br><span class="hljs-meta">:: 被标记为已过期:</span> mongodb-tools<br></code></pre></td></tr></table></figure><ul><li><code>-w</code> (<code>--news</code>)</li></ul><p>展示来自 Arch Linux 主页的新闻。只展示比所有本地软件包构建日期要新的新闻，要展示所有新闻，请使用 <code>-ww</code></p><ul><li><code>-o</code> (<code>--order</code>)</li></ul><p>展示 目标软件包的构建顺序，例如 <code>paru -Po icalingua++ </code></p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">AUR TARGET icalingua</span><span class="hljs-literal">++</span> <span class="hljs-comment">icalingua</span><span class="hljs-literal">++</span><br></code></pre></td></tr></table></figure><h2 id="获取-PKGBUILD-相关-G-getpkgbuild">获取 PKGBUILD 相关 <code>-G</code> (<code>--getpkgbuild</code>)</h2><ul><li><code>-p</code> (<code>--print</code>)</li></ul><p>将 PKGBUILD 打印到终端（而不是下载 PKGBUILD)</p><ul><li><code>-c</code> (<code>--comments</code>)</li></ul><p>展示软件包的 AUR 评论。</p><ul><li><code>-s</code> (<code>--ssh</code>)</li></ul><p>通过 ssh 克隆 AUR 仓库，例如 可读写的远程。</p><h2 id="仓库控制相关-L-repoctl">仓库控制相关 <code>-L</code> (<code>--repoctl</code>)</h2><ul><li><code>-l</code> (<code>--list</code>)</li></ul><p>显示本地仓库的软件包</p><ul><li><code>-d</code> (<code>--delete</code>)</li></ul><p>移除本地的一个软件包， <code>-dd</code> 同时卸载该软件包。</p><ul><li><code>-y</code> (<code>--refresh</code>)</li></ul><p>刷新本地仓库</p><ul><li><code>-q</code> (<code>--quiet</code>)</li></ul><p>展示更少信息。</p><h2 id="CHROOT-相关-C-chrootctl">CHROOT 相关 <code>-C</code> (<code>--chrootctl</code>)</h2><ul><li><code>-i</code> (<code>--install</code>)</li></ul><p>将一个软件包安装到 chroot</p><ul><li><code>-u</code> (<code>--sysupgrade</code>)</li></ul><p>更新 chroot</p><h2 id="更新相关-U-upgrade">更新相关 <code>-U</code> (<code>--upgrade</code>)</h2><ul><li><code>-i</code> (<code>--install</code>)</li></ul><p>构建完毕后同时安装。</p><h2 id="新的选项">新的选项</h2><p>下面的选项适用于所有选项</p><ul><li><code>--repo</code></li></ul><p>假设所有目标来自于软件仓库，并且像  <code>-u</code> 只处理来自于软件仓库的软件包</p><ul><li><code>-a</code> (<code>--aur</code>)</li></ul><p>假设所有目标来自于 aur, 并且 <code>-u</code> 之类的选项只处理来自于 aur 的包。</p><ul><li><code>--aururl</code></li></ul><p>设置 aur 代理（只代理下载 aur 仓库, 不代理下载打包的 source)</p><ul><li><code>--clonedir &lt;dir&gt;</code></li></ul><p>设置下载和运行 PKGBUILD 的目录</p><ul><li><code>--makepkg &lt;command&gt;</code></li></ul><p>设置 <code>makepkg</code> 调用的命令，可以是 <code>PATH</code> 里面的命令或者任意一个绝对路径指向的文件。</p><ul><li><code>--makepkgconf &lt;file&gt;</code></li></ul><p>为 chroot 环境指定一个 makepkg 的配置文件，只能使用绝对路径。</p><ul><li><code>--pacman &lt;command&gt;</code></li></ul><p>调用 <code>pacman</code> 的命令，可以是 <code>PATH</code> 里面的命令或者任意一个绝对路径指向的文件。</p><ul><li><code>--git &lt;command&gt;</code></li></ul><p>设置 自定义 <code>git</code> 的命令 ，可以是 <code>PATH</code> 里面的命令或者任意一个绝对路径指向的文件。</p><ul><li><code>--gitflags &lt;flags&gt;</code></li></ul><p>向 <code>git</code> 传递的参数，每次当 <code>paru</code> 调用 <code>git</code> 的时候都会传递。参数按空格分割，然后用引号包裹起来，即</p><p><code>--gitflags &quot;flag1 flag2 flag3&quot;</code></p><ul><li><code>--gpg &lt;command&gt;</code></li></ul><p>设置 gpg 命令，可以是 <code>PATH</code> 里面的命令或者任意一个绝对路径指向的文件。</p><ul><li><code>--gpgflags &lt;flags&gt;</code></li></ul><p>向 <code>gpg</code> 传递的参数，每次当 <code>paru</code> 调用 <code>gpg</code> 的时候都会传递。参数按空格分割，然后用引号包裹起来，即</p><p><code>--gpgflags &quot;flag1 flag2 flag3&quot;</code></p><ul><li><code>--fm &lt;command&gt;</code></li></ul><p>启用 fm （file manager) 模式，使用指定的 文件管理器完成 PKGBUILD 审阅，并且能够编辑 PKGBUILD 与相关的文件。要使更改持久化，请提交 (commit).</p><ul><li><code>--fmflags &lt;flags&gt;</code></li></ul><p>向  fm 传递的参数，每次当 <code>paru</code> 调用 <code>gpg</code> 的时候都会传递。参数按空格分割，然后用引号包裹起来。即</p><p><code>--fmflags &quot;flag1 flag2 flag3&quot;</code></p><ul><li><code>--asp &lt;command&gt;</code></li></ul><p>自定义的 <code>asp</code> 命令，可以是 <code>PATH</code> 里面的命令或者任意一个绝对路径指向的文件。</p><ul><li><code>--mflags &lt;flags&gt;</code></li></ul><p>向 <code>makepkg</code> 传递的参数，每次当 <code>paru</code> 调用 <code>makepkg</code> 的时候都会传递。参数按空格分割，然后用引号包裹起来，即<code>--mflags &quot;flag1 flag2 flag3&quot;</code></p><ul><li><code>--bat &lt;command&gt;</code></li></ul><p>自定义的 <code>bat</code> 命令，可以是 <code>PATH</code> 里面的命令或者任意一个绝对路径指向的文件。</p><ul><li><code>--batflags &lt;flags&gt;</code></li></ul><p>向 <code>bat</code> 传递的参数，每次当 <code>paru</code> 调用 <code>bat</code> 的时候都会传递。参数按空格分割，然后用引号包裹起来，也就是</p><p><code>--batflags &quot;flag1 flag2 flag3&quot;</code></p><ul><li><code>--sudo &lt;command&gt;</code></li></ul><p>自定义的 <code>sudo</code> 命令，可以是 <code>PATH</code> 里面的命令或者任意一个绝对路径指向的文件。<code>--sudoloop</code> 选项不一定能和自定义的 <code>sudo</code> 命令兼容。</p><ul><li><code>--sudoflags &lt;flags&gt;</code></li></ul><p>向 <code>sudo</code> 传递的参数，每次当 <code>paru</code> 调用 <code>sudo</code> 的时候都会传递。参数按空格分割，然后用引号包裹起来，也就是 <code>--sudoflags &quot;flag1 flag2 flag3&quot;</code></p><ul><li><code>--completioninterval &lt;days&gt;</code></li></ul><p>刷新补全缓存的时间间隔，设置为<code>0</code> 表示每次都刷新，<code>-1</code> 表示永不刷新，默认值为 <code>7</code>.</p><ul><li><code>--sortby  &lt;votes|popularity|id|baseid|name|base|submitted|modified&gt;</code></li></ul><p>在搜索时对 AUR 的软件包按特定指标排序，默认按 <code>votes</code> 降序排列。</p><ul><li><code>--searchby &lt;name|name-desc|maintainer|depends|checkdepends|makedepends|optdepends&gt;</code></li></ul><p>按指定域进行 AUR 搜索，默认按 <code>name-desc</code> 搜索。</p><ul><li><code>--skipreview</code></li></ul><p>跳过审阅过程</p><ul><li><code>--review</code></li></ul><p>不跳过审阅过程</p><ul><li><code>--upgrademenu</code></li></ul><p>展示详细的更新清单，格式类似于 <code>pacman</code> 的 <code>VerbosePkgLists</code> 选项。可以使用 数字、数字范围或者仓库名称跳过某些更新。 <strong>不建议跳过来自软件仓库的更新，因为这可能会导致部分更新。该选项的目的是用于跳过某些 AUR 更新。</strong></p><ul><li><code>--nogrademenu</code></li></ul><p>不展示更新菜单</p><ul><li><code>--removemake [yes|no|ask]</code></li></ul><p>在安装完软件包后移除 <code>makedepends</code>。如果设置为 <code>ask</code>，在构建过程中会显示一个询问菜单。没有指定选项时，默认是 <code>yes</code>。</p><ul><li><code>--noremovemake</code></li></ul><p>在安装完软件包后不移除 <code>makedepends</code>。</p><ul><li><code>--topdown</code></li></ul><p>从上往下打印搜索结果，首先打印来自软件仓库的软件包。这是默认行为。</p><ul><li><code>--bottomup</code></li></ul><p>从下往上打印搜索结果，首先打印来自 AUR 的软件包。</p><ul><li><code>--limit &lt;limit&gt;</code></li></ul><p>在一次搜索中限制返回的结果的数量，默认是<code>0</code> (无限制)。可以分别对 aur 和软件仓库进行限制。</p><ul><li><code>-x (--regex)</code></li></ul><p>在 AUR 搜索中启用正则表达式。只匹配 <code>pkgname</code>(包名), 不匹配 <code>pkgdesc</code>(描述)。</p><ul><li><code>--nocheck</code></li></ul><p>不解决依赖或者不运行 PKGBUILD 中的 <code>check</code> 函数。</p><ul><li><code>--installdebug</code></li></ul><p>如果一个包提供 debug 包，同时安装 debug 包。</p><ul><li><code>--noinstalldebug</code></li></ul><p>当一个包提供 debug 包时，不安装 debug 包。</p><ul><li><code>--devel</code></li></ul><p>在系统更新 (sysupgrade) 时，同时检查 aur 的包 development 更新，目前只支持 git 包 （即 <code>foo-git</code> 之类的包）。</p><ul><li><code>--nodevel</code></li></ul><p>在系统更新时， 不检查 development 的软件包。</p><ul><li><code>--develsuffixes</code></li></ul><p><code>paru</code> 用来决定一个包是否是 devel package 的后缀，当启用 <code>--needed</code> 选项时用于决定是否要更新 <code>pkgver</code>。<strong>注意 suffixes 是复数，即可以有多个后缀</strong>。</p><ul><li><code>--cleanafter</code></li></ul><p>在安装后移除未被跟踪的文件（不移除目录）。这使得采用版本控制系统（VCS) 的软件包能够轻松拉取更新而不是重新克隆整个仓库。</p><ul><li><code>--nocleanafter</code></li></ul><p>安装后不移除软件包的源文件(source)</p><ul><li><code>--redownload [yes|no|all]</code></li></ul><p>即使在本地缓存有 PKGBUILD 的时候也总是重新下载一份 PKGBUILD。如果指定 <code>all</code>，所有软件包的 PKGBUILD 都会重新下载，而不仅仅是目标 (targets) 软件包, 当指定了该选项时，默认为 <code>yes</code>。</p><ul><li><code>--noredownload</code></li></ul><p>当下载 PKGBUILD 时，如果本地缓存的 PKGBUILD 跟 AUR 的一样新或者比 AUR 的新时，不重新下载 PKGBUILD。</p><ul><li><code>--provides</code></li></ul><p>查找匹配 <code>provides</code> 的 AUR 软件包，当有多个结果时，提示用户选择一个。该选项会增加解决依赖的时间（但是感知不强）。</p><ul><li><code>--noprovides</code></li></ul><p>不查找 AUR 软件包的 <code>provides</code> 部分。 <code>paru</code> 不会展示 <code>provider</code> 菜单，但是 <code>pacman</code> 仍然会为软件仓库中的包展示 <code>provider</code> 菜单。</p><ul><li><code>--pgpfetch</code></li></ul><p>提示从每个 PKGBUILD 的 <code>validpgpkeys</code> 部分导入未知的 PGP 密钥。</p><ul><li><code>--nopgpfetch</code></li></ul><p>不提示导入未知的 PGP 密钥。这可能会导致软件包构建失败，除非使用 <code>--skippgpcheck</code> 或者自定义的 gpg 配置。</p><ul><li><code>--newsonupgrade</code></li></ul><p>在系统更新时打印新的新闻。</p><ul><li><code>--useask</code></li></ul><p>使用 <code>pacman</code> 的 <code>--ask</code> flag 来自动确认软件包冲突。 <code>paru</code> 会提前列出冲突列表。<code>paru</code> 有可能会没有检测到软件包冲突，导致一个软件包没有经过询问就被移除。但是这是几乎不可能的。 (very unlikely).</p><ul><li><code>--nouseask</code></li></ul><p>在安装过程中手动解决冲突，不冲突的软件包不需要手动确认。</p><ul><li><code>--savechanges</code></li></ul><p>在审阅 PKGBUILD 的过程中提交 (commit) 更改。</p><ul><li><code>--nosavechanges</code></li></ul><p>不提交审阅过程中的更改</p><ul><li><code>--combinedupgrade</code></li></ul><p>在系统更新的过程中，<code>paru</code>首先首先刷新数据库，然后展示将要更新的软件包。在完成审阅 PKGBUILD 以后， 来自软件仓库和 AUR 的更新将不需要手动干预。如果 <code>paru</code> 在刷新数据库后退出而没有进行系统更新，用户需要自己通过 <code>pacman</code> 进行更新。</p><ul><li><code>--nocombinedupgrade</code></li></ul><p>系统更新过程中，首先执行 <code>pacman -Syu</code>,然后更新来自 AUR 的软件包。</p><ul><li><code>--batchinstall</code></li></ul><p>当构建和安装 AUR 软件包的时候，将每个需要安装的软件包加入队列，当所有软件包都构建好之后，批量安装。</p><ul><li><code>--nobatchinstall</code></li></ul><p>当每个AUR 软件包构建完成之后立即安装。</p><ul><li><code>--rebuild [yes|no|all]</code></li></ul><p>即使当本地有构建好的副本也重新构建软件包。如果选择 <code>all</code> 所有包都被重新构建，而不仅仅是目标软件包。默认值是 <code>no</code>。</p><ul><li><code>--norebuild</code></li></ul><p>当构建软件包时，如果本地有相同版本的软件包，则跳过构建，使用现有的软件包。</p><ul><li><code>--sudoloop [= args...]</code></li></ul><p>在后台周期性调用 <code>sudo</code> 来在耗时长的构建中防止超时。 <strong>可选参数可以用来决定如何循环调用，在使用 <code>doas</code> 的时候可能会有用。</strong></p><ul><li><code>--nosudoloop</code></li></ul><p>不在后台循环调用 <code>sudo</code>。</p><ul><li><code>--localrepo [= Repos...]</code></li></ul><p>使用一个本地仓库来构建和更新 AUR 软件包。</p><p><code>paru</code> 会作用于启用的软件仓库而不是外部软件包上。这个仓库必须已经在 <code>pacman.conf</code> 中声明，但是不必已经存在于硬盘上。</p><p>可选地，可以传递一个仓库列表，<code>paru</code> 默认会考虑所有本地仓库，将软件包构建到第一个软件仓库，并更新其他启用的仓库的软件包。</p><ul><li><code>--chroot [= /path/to/chroot]</code></li></ul><p>在 chroot 中构建软件包，这需要启用 <code>localrepo</code> 选项，可选指定 chroot 的创建路径。</p><ul><li><code>--nochroot</code></li></ul><p>不在 chroot 中构建软件包。</p><ul><li><code>--sign [= key]</code></li></ul><p>使用 gpg 对软件包进行签名，可选指定使用哪个 key 进行签名。</p><ul><li><code>--nosign</code></li></ul><p>不对软件包进行 gpg 签名。</p><ul><li><code>--keeprepocache</code></li></ul><p>通常情况下，当 AUR 的软件包升级时，旧的版本会被清理。这个选项禁用了上述行为，保留了所有版本，仅更新了数据库。</p><ul><li><code>--nokeeprepocache</code></li></ul><p>不保留旧的软件包。</p><ul><li><code>--signdb [= key]</code></li></ul><p>使用 gpg 对数据库进行签名，可选指定使用哪个 key 进行签名。</p><ul><li><code>--nosigndb</code></li></ul><p>不对数据库进行 gpg 签名。</p><h2 id="一些例子">一些例子</h2><ul><li><code>paru foo</code></li></ul><p>从软件仓库和 AUR 交互式搜索和安装软件包。</p><ul><li><code>paru -Syu</code></li></ul><p>更新软件包列表，并升级所有已安装的软件包。</p><ul><li><code>paru -Sua</code></li></ul><p>更新所有已安装的来自 AUR 的软件包。</p><ul><li><code>paru -S foo</code></li></ul><p>从软件仓库或者 AUR 安装软件包 <code>foo</code>。</p><ul><li><code>paru -Ss foo</code></li></ul><p>从 软件仓库或者 AUR 搜索软件包 <code>foo</code>。</p><ul><li><code>paru -Si foo</code></li></ul><p>从软件仓库或者 AUR 获取有关软件包 <code>foo</code> 的信息。</p><ul><li><code>paru -S foo --mflags &quot;--skipchecksums --skippgpcheck&quot;</code></li></ul><p>安装软件包 <code>foo</code> 并跳过校验和与 PGP 检验。</p><h2 id="环境变量">环境变量</h2><p><code>paru</code> 支持以下的环境变量。<strong>我相信你永远不会用上它们。</strong></p><ul><li><code>AURDEST</code></li></ul><p>用于设置构建软件包的目录，使用 <code>--clonedir</code> 覆盖该变量。</p><ul><li><code>PARU_CONF</code></li></ul><p>覆盖 <code>paru</code> 查找自身配置文件的位置。</p><ul><li><code>PARU_PAGER</code></li></ul><p><code>paru</code> 用于审阅文件的 <code>pager</code>，优先级高于 <code>PAGER</code> 环境变量，但是低于 <code>paru.conf</code> 的设置。</p><h2 id="相关文件">相关文件</h2><h3 id="配置目录">配置目录</h3><p><code>paru</code> 的配置文件目录位于 <code>$XDG_CONFIG_HOME/paru/</code>， 如果 <code>$XDG_CONFIG_HOME</code> 未设定，则为</p><p><code>$HOME/.config/paru</code>。 <code>paru.conf</code> 用于保存 <code>paru</code> 所有的选项。<strong>实际上 arch 的 <code>paru.conf</code>在 <code>/etc</code> 下面</strong></p><h3 id="缓存目录">缓存目录</h3><p>缓存目录在 <code>$XDG_CACHE_HOME/paru/</code>，如果 <code>$XDG_CACHE_HOME</code> 为空则是 <code>$HOME/.cache/paru</code>。<code>packages.aur</code> 保存了一份 AUR 软件包的列表用于补全，默认情况下补全文件 7 天更新一次。 <code>devel.json</code> 保存了一份所有 VCS 软件包的名称以及它们最新的提交，如果任何一个提交发生变化，对应的软件包会被重新构建。</p><h3 id="构建目录">构建目录</h3><p>除非重新指定，该目录的位置与缓存目录相同。该目录用于存放下载的 AUR 包以及它们的 souce 文件和构建好的软件包。</p><h3 id="pacman-conf">pacman.conf</h3><p><code>paru</code> 使用 <code>pacman.conf</code> 通过 <code>alpm.rs</code> 或者 <code>paru</code> 本身来设置某些 <code>pacman</code> 选项。大部分的 <code>libalpm</code> 选项和 <code>pacman</code> 选项都被继承了。</p><h2 id="常用命令">常用命令</h2><ol><li>更新系统： <code>paru</code> 或者 <code>paru -Syu</code></li><li>强制刷新文件数据库： <code>paru -Fyy</code></li><li>移除软件包及其依赖： <code>paru -Rsc foo</code></li><li>清理不被需要的软件包： <code>paru -c</code></li><li>查看最大的10个软件包:  <code>paru -Ps</code></li></ol><p>就写这几个吧，其实有些是 <code>pacman</code>命令的。</p><h2 id="结语">结语</h2><p>其实我是从 <code>yay</code> 转到 <code>paru</code> 的，还是习惯打 <code>yay</code>，于是我在我的 <code>.zshrc</code> 里面加上了一行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">alias</span> yay=paru<br></code></pre></td></tr></table></figure><p>于是我又可以愉快地使用 <code>yay</code> 了！</p>]]></content>
    
    
    
    <tags>
      
      <tag>archlinux</tag>
      
      <tag>aur 助手</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 Linux 上安装 VNPY</title>
    <link href="/2022/03/30/install-vnpy/"/>
    <url>/2022/03/30/install-vnpy/</url>
    
    <content type="html"><![CDATA[<h2 id="起因">起因</h2><p>最近跟同学一起参加了一个<a href="https://posts.careerengine.us/p/621df647446a3a4b1a887a49">全国大学生统计建模量化模拟交易大赛</a>.</p><p>量化交易需要安装 <a href="https://gitee.com/vnpy/vnpy">VNPY</a>, 然后替换下文件并启动. 但是我最开始简单折腾了下,发现运行环境搭不起来.直到最近几天, VNPY 更新了 3.0 版本,才能正常运行.</p><h2 id="配置过程">配置过程</h2><p>首先 到 <a href="https://gitee.com/vnpy/vnpy">VNPY</a> 的主页上拉取仓库. 我直接拉到 <code>/tmp</code> 下面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://gitee.com/vnpy/vnpy.git<br></code></pre></td></tr></table></figure><p>然后进入文件夹,创建 python 虚拟环境, 并进入虚拟环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> vnpy <br>python -m venv .<span class="hljs-built_in">env</span><br><span class="hljs-built_in">source</span> .<span class="hljs-built_in">env</span>/bin/activate<br></code></pre></td></tr></table></figure><p>然后跟着官方的安装步骤走, 不过我不敢用他们的一键脚本.  先安装两个 python 模块,注意看 <code>install.sh</code> 里面的代码,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install --upgrade pip wheel<br>pip install numpy==1.21.5<br></code></pre></td></tr></table></figure><p>然后安装 <code>ta-lib</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S ta-lib<br></code></pre></td></tr></table></figure><p>最后安装依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install -r requirements.txt<br></code></pre></td></tr></table></figure><hr><p><strong>如果你使用火象,请执行下面的步骤</strong></p><p>用官方给的替换文件 <code>constant.py</code> 替换 <code>vnpy/trader/constant.py</code></p><hr><p>然后我们安装 VNPY (还是刚刚那个终端,那个 python 的虚拟环境)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install .<br></code></pre></td></tr></table></figure><p>到这里我们就安装完成啦!</p><p>如果你是运行正常的 VNPY, 请按 VNPY 官方的示例脚本运行.</p><p>但是你会发现运行不起来,缺依赖, 请安装下列依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install vnpy_ctp vnpy_ctastrategy vnpy_ctabacktester vnpy_sqlite vnpy_rqdata<br></code></pre></td></tr></table></figure><hr><p><strong>如果你使用火象</strong></p><p>下载官方的 <a href="https://dl.sukanka.com/ali/Others/%E7%81%AB%E8%B1%A1API%E5%A8%81%E5%8A%9B%E5%A2%9E%E5%BC%BA%E5%8C%85">火象威力增强包</a>,</p><p>在 VNPY 里面创建一个 <code>huoxiang</code> 文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> huoxiang<br></code></pre></td></tr></table></figure><p>将火象威力增强包里面的几个 <code>.py</code> 文件复制进去</p><p>然后运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python huoxiang/run.py<br></code></pre></td></tr></table></figure><p>还是会发现运行不起来,还需要以下依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install vnpy_rest vnpy_websocket requests vnpy_datamanager<br></code></pre></td></tr></table></figure><p>装完之后就能够运行起来了. 效果如下</p><p><img src="https://bu.dusays.com/2022/04/16/79f2122a3b8f3.png" alt=""></p><p>但是还是有一个问题,图片的左上角 接口显示为空,是没法正常交易的. 在 2.9 版本的 VNPY 据说可以正常使用,但是 2.9 版本的依赖我装不上.</p><p>所以,探索到这里就结束了.</p>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>vnpy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 Archlinux 服务器上部署 vaultwarden</title>
    <link href="/2022/03/03/host-vaultwarden/"/>
    <url>/2022/03/03/host-vaultwarden/</url>
    
    <content type="html"><![CDATA[<h2 id="介绍">介绍</h2><p>下面的内容摘抄自 <a href="https://help.ppgg.in/"><strong>Bitwarden 帮助中心中文版</strong></a>, 会被谷歌提示危险网站，忽略即可。</p><blockquote><p>Bitwarden 是一个开源的密码管理系统，你可以使用 Bitwarden 官方提供的云服务，也可以将 Bitwarden 安装和托管在自己的服务器上。</p></blockquote><blockquote><p>个人账户的免费版不限制使用时间、不限制密码条目数、不限制设备数量、不限制文件夹数量、支持常见的验证器应用程序（如 <a href="https://authy.com">Authy</a>、 <a href="https://www.microsoft.com/en-us/account/authenticator">Microsoft Authenticator</a>、<a href="https://github.com/google/google-authenticator">Google Authenticator</a>），完全可以满足大部分个人的日常使用。</p></blockquote><blockquote><p>需要使用更高级功能（TOTP、文件附件等），可以选择个人账户的高级版，或者使用组织账户。</p></blockquote><p>简单来说， Bitwarden 就是一个全平台的开源的密码管理器啦！那么，这和这篇文章的 vaultwarden 又有什么关系呢？</p><p>下面的内容抄自 <a href="https://rs.ppgg.in/">Vaultwarden Wiki 中文版</a>.</p><blockquote><p>Vaultwarden 是一个用于本地搭建 Bitwarden 服务器的第三方 Docker 项目。兼容 Bitwarden 官方客户端，仅在部署的时候使用 Vaultwarden 镜像，桌面端、移动端、浏览器扩展等客户端均使用 Bitwarden 官方的客户端。</p><p>Vaultwarden 很轻量，对于不希望使用官方的占用大量资源的自托管部署而言，它是理想的选择。</p></blockquote><p>介绍完了我们开始讲部署服务器端。</p><h2 id="部署">部署</h2><p>在 archlinux 上部署vaultwarden 是很方便的，直接从官方仓库安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S vaultwarden vaultwarden-web<br></code></pre></td></tr></table></figure><p>然后修改配置文件 <code>/etc/vaultwarden.env</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> vim /etc/vaultwarden.env<br></code></pre></td></tr></table></figure><p>根据自己的喜好修改即可。重要的是 <code>ADMIN_TOKEN</code>,这是你登录 web 管理员面板时候的密码。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">## Token for the admin interface, preferably use a long random string</span><br><span class="hljs-comment">## One option is to use &#x27;openssl rand -base64 48&#x27;</span><br><span class="hljs-comment">## If not set, the admin panel is disabled</span><br><span class="hljs-attr">ADMIN_TOKEN</span>=YOUR_ADMIN_TOKEN<br></code></pre></td></tr></table></figure><p>注意， web 的部分也要改，通过取消注释的方式改成如下样子（使用 <code>vaultwarden-web</code> )。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">## Web vault settings</span><br><span class="hljs-attr">WEB_VAULT_FOLDER</span>=/usr/share/webapps/vaultwarden-web<br><span class="hljs-attr">WEB_VAULT_ENABLED</span>=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>还有其他部分也要改，这里我放一下我改好的，大家可以参照着改。</p><p>这里附一份我的配置,通过 <code>cat /etc/vaultwarden.env |grep -E '^[^#]'</code> 产生（即取消了注释的行）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">DATA_FOLDER=/var/lib/vaultwarden<br>WEB_VAULT_FOLDER=/usr/share/webapps/vaultwarden-web<br>WEB_VAULT_ENABLED=<span class="hljs-literal">true</span><br>WEBSOCKET_ENABLED=<span class="hljs-literal">true</span><br>WEBSOCKET_ADDRESS=0.0.0.0<br>WEBSOCKET_PORT=3012<br>SENDS_ALLOWED=<span class="hljs-literal">true</span><br>EMERGENCY_ACCESS_ALLOWED=<span class="hljs-literal">true</span><br>ICON_SERVICE=bitwarden<br>ICON_REDIRECT_CODE=301<br>ICON_BLACKLIST_REGEX=<span class="hljs-string">&#x27;^(192\.168\.0\.[0-9]+|192\.168\.1\.[0-9]+)$&#x27;</span><br>ICON_BLACKLIST_NON_GLOBAL_IPS=<span class="hljs-literal">true</span><br>SIGNUPS_ALLOWED=<span class="hljs-literal">true</span><br>ADMIN_TOKEN=YOUR_ADMIN_TOKEN<br>DOMAIN=https://YOUR_DOMAIN<br>AUTHENTICATOR_DISABLE_TIME_DRIFT=<span class="hljs-literal">true</span><br>ROCKET_LIMITS=&#123;json=10485760&#125;<br></code></pre></td></tr></table></figure><p>然后启动它并加入开机自启，再看一下是否启动成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now vaultwarden<br>systemctl status vaultwarden<br></code></pre></td></tr></table></figure><p>如果显示 <code>running</code> 就说明跑起来了。</p><p>我们还需要配置一个 反向代理，以便使用 web 面板，这里以 nginx 为例，可以参考官方 wiki  <a href="https://github.com/dani-garcia/vaultwarden/wiki/Proxy-examples">Proxy examples</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> vim /etc/nginx/conf.d/vaultwarden.conf<br></code></pre></td></tr></table></figure><p>配置内容直接抄官方教程，我抄的 <code>Nginx (by blackdex)</code>, 记得把 <code>&lt;SERVER&gt;</code> 改为你的服务器地址，我使用的 <code>localhost</code>， 然后把 <code>server_name</code> 那里</p><p><code>vault.*</code> 替换为你准备提供服务的域名。 <code>auth_basic</code>那两行我不需要，直接注释掉。在 archlinux 上 vaultwarde 用的端口是 8000, 记得改一下。</p><p>然后，给域名申请证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> certbot<br></code></pre></td></tr></table></figure><p>选择你的域名序号，回车。</p><p>最后重启 <code>nginx</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart nginx<br></code></pre></td></tr></table></figure><p>到这里，我们就已经部署好啦。</p><p>可以访问 <code>https://YOUR_SERVER_NAME/admin</code> 进入管理员面板。在里面进行一些高级配置。（记得把 <code>YOUR_SERVER_NAME</code> 替换为你的域名）。</p><p>你需要使用你在配置文件里面写的密码。</p><h2 id="建议阅读">建议阅读</h2><ol><li><a href="https://help.bitwarden.ltd/">Bitwarden 帮助中心中文版</a>：学习如何使用 bitwarden</li><li><a href="https://rs.bitwarden.ltd/">Vaultwarden Wiki 中文版</a>: 了解你可以在服务器端开启哪些功能</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>bitwarden</tag>
      
      <tag>vaultwarden</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 Archlinux 服务器上安装 dendrite</title>
    <link href="/2022/02/28/deploy-dendrite/"/>
    <url>/2022/02/28/deploy-dendrite/</url>
    
    <content type="html"><![CDATA[<p>摘自维基百科：</p><blockquote><p><strong>Matrix</strong>是一种用于实时通信的开放协议。它允许拥有一个<a href="https://zh.wikipedia.org/w/index.php?title=%E9%80%9A%E4%BF%A1%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E5%95%86&amp;action=edit&amp;redlink=1">通信服务提供商</a>帐户的用户与不同服务提供商的用户进行<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E8%81%8A%E5%A4%A9">网络聊天</a>，<a href="https://zh.wikipedia.org/wiki/VoIP">IP语音</a>和<a href="https://zh.wikipedia.org/wiki/%E8%A6%96%E8%A8%8A%E9%9B%BB%E8%A9%B1">视频通话</a>。也就是说，它旨在使不同服务提供商之间的实时通信无缝工作，就像使用<a href="https://zh.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6">电子邮件</a>一样。采用该协议的软件有<a href="https://zh.wikipedia.org/wiki/Element.io">Element.io</a>等。</p></blockquote><p>最近我一直想部署一个 Matrix 服务端。然后就了解到了 Dendrite.</p><p>Dendrite 是基于 Go 的第二代 Matrix 客户端,性能比用Python编写的Synapse服务器强。</p><p>本文参考了<a href="https://github.com/matrix-org/dendrite/blob/main/docs/INSTALL.md">官方的部署教程</a>.</p><h2 id="安装">安装</h2><p>总共三个步骤：</p><ol><li>安装 <code>nats-server</code></li><li>安装 <code>postgresql</code></li><li>安装 <code>dendrite</code></li></ol><hr><h3 id="安装-nats-server">安装 <code>nats-server</code></h3><p>本步骤可以省略，dendrite 会使用内置的 <code>nats-server</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S nats-server<br></code></pre></td></tr></table></figure><p>然后编辑 <code>nats-server</code> 的 <code>service</code> 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl edit --full nats-server.service<br></code></pre></td></tr></table></figure><p>将 <code>ExecStart</code> 行修改为(加上 <code>-js</code>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ExecStart=/usr/bin/nats-server -js --pid /run/nats-server.pid --syslog --http_port 8222<br></code></pre></td></tr></table></figure><p>然后启动 <code>nats-server</code>并加入开机自启。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now nats-server<br></code></pre></td></tr></table></figure><h3 id="安装-PostgreSQL">安装 PostgreSQL</h3><p>直接用 <code>yay</code> 安装数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S postgresql<br></code></pre></td></tr></table></figure><p>接着初始化数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> su - postgres -c <span class="hljs-string">&quot;initdb --locale en_US.UTF-8 -D &#x27;/var/lib/postgres/data&#x27;&quot;</span><br></code></pre></td></tr></table></figure><p>启动 postgresql 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now postgresql<br></code></pre></td></tr></table></figure><p>再创建 <code>dendrite</code> 使用的数据库用户，并输入密码（假设叫 <code>PASSWORD</code>)，记得密码<strong>不要</strong>包含特殊字符，比如(<code>#</code>),否则会导致 <code>config.yaml</code> 解析出错。然后顺便创建对应的数据库。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> -u postgres createuser -P dendrite<br><span class="hljs-built_in">sudo</span> -u postgres createdb -O dendrite dendrite<br></code></pre></td></tr></table></figure><h3 id="安装-Dendrite">安装 Dendrite</h3><p>每一个 dendrite 安装都需要</p><ul><li>一个唯一的 Matrix 签名私钥</li><li>一个有效、被信任的TLS证书和私钥</li></ul><p>安装 <code>dendrite</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S dendrite<br></code></pre></td></tr></table></figure><p>首先我们生成一个 Matrix 签名私钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dendrite-generate-keys --private-key matrix_key.pem<br></code></pre></td></tr></table></figure><p><strong>注意</strong>： 保管好这个私钥，在同一个域名下重新安装 dendrite(或者其他 Matrix 服务端) 的时候，你会需要这个 key。如果失去了这个 key, 你在加入federated rooms 的时候会遇到问题。</p><p>TLS 证书那条没看懂，先忽略。</p><p>之后就是生成配置文件，如果你是一个熟练工的话，我建议你将<code>/etc/dendrite/config-example.yaml</code>复制为 <code>/etc/dendrite/config.yaml</code>，而不是使用 <code>dendrite-generate-config</code>。</p><p>如果你是一个新手，Archlinux 有个很棒的脚本叫做 <code>dendrite-generate-config</code>，我们看一下它的用法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dendrite-generate-config -h<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Usage of dendrite-generate-config:<br>-ci<br>sane defaults <span class="hljs-keyword">for</span> CI testing<br>-db string<br>The DB URI to use <span class="hljs-keyword">for</span> all components <span class="hljs-keyword">if</span> not SQLite files<br>-server string<br>The domain name of the server <span class="hljs-keyword">if</span> not <span class="hljs-string">&#x27;localhost&#x27;</span><br></code></pre></td></tr></table></figure><p>因此，我们用如下命令来生成配置文件，注意把 <code>PASSWORD</code> 替换为你的 dendrite 数据库用户密码。把 <code>askk.cc</code> 替换为你准备用来提供服务的域名。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dendrite-generate-config -db <span class="hljs-string">&#x27;postgres://dendrite:PASSWORD@localhost/dendrite?sslmode=disable&#x27;</span> -server askk.cc &gt;config.yaml<br></code></pre></td></tr></table></figure><p>然后我们看一下默认的配置, 运行 <code>cat config.yaml </code> (如果你想使用完整的配置进行修改，参考 <a href="https://github.com/matrix-org/dendrite/blob/main/dendrite-config.yaml">dendrite sample config</a>)</p><p>然后将配置文件复制到 <code>/etc/dendrite</code>,私钥复制到 <code>/var/lib/dendrite</code>, 并修正权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> config.yaml /etc/dendrite<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> matrix_key.pem  /var/lib/dendrite<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> -R dendrite:dendrite /var/lib/dendrite<br></code></pre></td></tr></table></figure><p>接着添加其他的 <code>key_perspectives</code> 找到对应的行，直接修改，注意缩进。进行这一步是因为默认的 <code>matrix.org</code> 连不上，但是 <code>archlinux.org</code> 跟 <code>mozilla.org</code> 是可以从国内连上的。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">key_perspectives:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">server_name:</span> <span class="hljs-string">matrix.org</span><br><span class="hljs-attr">keys:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key_id:</span> <span class="hljs-string">ed25519:auto</span><br><span class="hljs-attr">public_key:</span> <span class="hljs-string">Noi6WqcDj0QmPxCNQqgezwTlBKrfqehY1u2FyWP9uYw</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key_id:</span> <span class="hljs-string">ed25519:a_RXGa</span><br><span class="hljs-attr">public_key:</span> <span class="hljs-string">l8Hft5qXKn1vfHrg3p4+W8gELQVo8N13JkluMfmn2sQ</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">server_name:</span> <span class="hljs-string">archlinux.org</span><br><span class="hljs-attr">keys:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key_id:</span> <span class="hljs-string">ed25519:a_KKNB</span><br><span class="hljs-attr">public_key:</span> <span class="hljs-string">eO1SdnG7CjsIQ/bPaD7k5kwD8CSvYkzHNdhot4gp1Xg</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">server_name:</span> <span class="hljs-string">mozilla.org</span><br><span class="hljs-attr">keys:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key_id:</span> <span class="hljs-string">ed25519:0</span><br><span class="hljs-attr">public_key:</span> <span class="hljs-string">RsDggkM9GntoPcYySc8AsjvGoD0LVz5Ru/B/o5hV9h4</span><br><span class="hljs-attr">prefer_direct_fetch:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>如果你想添加其他的 服务器，需要自己获取 <code>public_key</code> 方式如下</p><p>访问 <a href="https://federationtester.matrix.org/">Matrix Federation Tester</a>, 输入 你想添加的域名，比如 <code>matrix.org</code>, 测试完成后找到最下面的 View the <a href="https://federationtester.matrix.org/api/report?server_name=matrix.org">json report</a>.</p><p>在新打开的页面你就能够找到 <code>verify_keys</code> 那里就有你需要的 <code>public_key</code> 以及 <code>key_id</code>.</p><p>附上一个我的配置。各种密码已经隐掉，<a href="https://gist.github.com/sukanka/fbcf543cf803ccbc90c0fb6978d1017e">Github gist</a>.</p><p>然后就可以开启自启动并立即启动啦。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now dendrite<br></code></pre></td></tr></table></figure><p>看一下是否启动成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl status dendrite<br></code></pre></td></tr></table></figure><p>成功的话，会有类似如下的输出</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs inform7">Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: <span class="hljs-comment">[961838]</span> <span class="hljs-comment">[INF]</span><br>Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: <span class="hljs-comment">[961838]</span> <span class="hljs-comment">[INF]</span> ---------------- JETSTREAM ----------------<br>Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: <span class="hljs-comment">[961838]</span> <span class="hljs-comment">[INF]</span>   Max Memory:      2.87 GB<br>Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: <span class="hljs-comment">[961838]</span> <span class="hljs-comment">[INF]</span>   Max Storage:     41.82 GB<br>Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: <span class="hljs-comment">[961838]</span> <span class="hljs-comment">[INF]</span>   Store Directory: <span class="hljs-string">&quot;/var/cache/dendrite/jetstream&quot;</span><br>Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: <span class="hljs-comment">[961838]</span> <span class="hljs-comment">[INF]</span> -------------------------------------------<br>Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: <span class="hljs-comment">[961838]</span> <span class="hljs-comment">[INF]</span> Server <span class="hljs-keyword">is</span> ready<br>Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: time=<span class="hljs-string">&quot;2022-02-28T15:26:45.596884493Z&quot;</span> level=info msg=<span class="hljs-string">&quot;Enabled perspective key fetcher&quot;</span> num_public_keys=2 se&gt;<br>Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-comment">[961838]</span>: time=<span class="hljs-string">&quot;2022-02-28T15:26:45.623562213Z&quot;</span> level=info msg=<span class="hljs-string">&quot;Enabling server notices at /_synapse/admin/v1/send_se&gt;</span><br><span class="hljs-string">Feb 28 23:26:45 tencent-arch dendrite<span class="hljs-subst">[961838]</span>: time=&quot;</span>2022-02-28T15:26:45.664262183Z<span class="hljs-string">&quot; level=info msg=&quot;</span>Starting external Monolith listener on :8008<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><h3 id="Dendrite-走代理">Dendrite 走代理</h3><p>假设你已经在服务器上配置好了代理，比如说 <code>v2raya</code>, 但是你显然不想进行透明代理，只想代理 <code>dendrite</code>,这时候，我们为 <code>dendrite</code> 的 systemd 服务添加环境变量即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl edit --full dendrite<br></code></pre></td></tr></table></figure><p>在 <code>[service]</code> 部分添加 <code>Environment</code> 开头的两行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[Service]<br>User=dendrite<br>Environment=https_proxy=127.0.0.1:20172<br>Environment=http_proxy=127.0.0.1:20172<br>ExecStart=/usr/bin/dendrite --config=/etc/dendrite/config.yaml<br>WorkingDirectory=/var/lib/dendrite/<br></code></pre></td></tr></table></figure><p>改好之后重载 <code>systemd</code> 服务文件并重启 <code>dendrite</code>，运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl daemon-reload<br><span class="hljs-built_in">sudo</span> systemctl restart dendrite<br></code></pre></td></tr></table></figure><h3 id="添加-Nginx-配置">添加 Nginx 配置</h3><p>Github 的说明真是不够详细，<code>nginx</code> 的配置还要自己找。</p><p>我们先进入 Nginx 存放配置的文件夹 （没有的话可以先创建）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/nginx/conf.d<br></code></pre></td></tr></table></figure><p>写入配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> vim dendrite.conf<br></code></pre></td></tr></table></figure><p>写入以下内容 （粘贴自 <a href="https://github.com/matrix-org/dendrite/blob/main/docs/nginx/monolith-sample.conf"><code>monolith-sample.conf</code></a> ), 注意修改域名为你自己的域名，比如我的 <code>matrix.askk.cc</code>, <code>ssl</code> 那四行删除掉，待会我们用 certbot 来生成证书。<br>在这里， <code>matrix.askk.cc</code> 是我的 <code>well-known server</code>, <code>askk.cc</code> 是 <code>homeserver</code>，如果你不区分两者，直接将它们改成你在 dendrite 的配置文件里面写的就可以了。 <code># managed by Certbot</code> 表示是由<code>certbot</code> 生成的部分，可以不用全部自己写，但是最少要写一个 <code>listen 80;</code>，<code>certbot</code> 会帮你改成下面那样子。</p><p><strong>注意</strong>： 我添加了那两行 <code>default_type application/json;</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> monolith &#123;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8008</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">server_name</span> matrix.askk.cc;<br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl; <span class="hljs-comment"># IPv6</span><br><br>    <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>    <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">600</span>;<br><br>    <span class="hljs-section">location</span> /.well-known/matrix/server &#123;<br>        <span class="hljs-attribute">default_type</span> application/json;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.server&quot;: &quot;matrix.askk.cc:443&quot; &#125;&#x27;</span>;<br>    &#125;<br>    <span class="hljs-section">location</span> /.well-known/matrix/client &#123;<br>        <span class="hljs-comment"># If your sever_name here doesn&#x27;t match your matrix homeserver URL</span><br>        <span class="hljs-comment"># (e.g. hostname.com as server_name and matrix.hostname.com as homeserver URL)</span><br>        <span class="hljs-attribute">default_type</span> application/json;<br>        <span class="hljs-attribute">add_header</span> Access-Control-Allow-Origin <span class="hljs-string">&#x27;*&#x27;</span>; <span class="hljs-comment"># 如果你 well-known server 与 homeserver 不同，就需要这行。</span><br>        <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.homeserver&quot;: &#123; &quot;base_url&quot;: &quot;https://askk.cc&quot; &#125; &#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-section">location</span> /_matrix &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://monolith;<br>    &#125;<br><br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/matrix.askk.cc/fullchain.pem; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/matrix.askk.cc/privkey.pem; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="hljs-comment"># managed by Certbot</span><br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">if</span> (<span class="hljs-variable">$host</span> = matrix.askk.cc) &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$host</span><span class="hljs-variable">$request_uri</span>;<br>    &#125; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">server_name</span> matrix.askk.cc;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">404</span>; <span class="hljs-comment"># managed by Certbot</span><br>&#125;<br></code></pre></td></tr></table></figure><p>接下来安排 ssl, 首先安装 <code>certbot</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S certbot<br></code></pre></td></tr></table></figure><p>运行 <code>certbot</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> certbot<br></code></pre></td></tr></table></figure><p>输入对应你域名的序号，回车。看到类似如下的输出就说明成功了</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vim">Successfully received certificate.<br>Certificate <span class="hljs-keyword">is</span> saved at: /etc/letsencrypt/live/askk.<span class="hljs-keyword">cc</span>/fullchain.pem<br>Key <span class="hljs-keyword">is</span> saved at:         /etc/letsencrypt/live/askk.<span class="hljs-keyword">cc</span>/privkey.pem<br>This certificate expires <span class="hljs-keyword">on</span> <span class="hljs-number">2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">30</span>.<br>These <span class="hljs-keyword">files</span> will <span class="hljs-keyword">be</span> updated when the certificate renews.<br><br>Deploying certificate<br>Successfully deployed certificate <span class="hljs-keyword">for</span> askk.<span class="hljs-keyword">cc</span> <span class="hljs-keyword">to</span> /etc/nginx/<span class="hljs-keyword">conf</span>.d/dendrite.<span class="hljs-keyword">conf</span><br>Congratulations! You have successfully enabled HTTPS <span class="hljs-keyword">on</span> https://askk.<span class="hljs-keyword">cc</span><br><br>NEXT STEPS:<br>- The certificate will need <span class="hljs-keyword">to</span> <span class="hljs-keyword">be</span> renewed before it expires. Certbot can automatically renew the certificate in the background, but you may need <span class="hljs-keyword">to</span> take steps <span class="hljs-keyword">to</span> enable that functionality. See https://certbot.org/renewal-setup <span class="hljs-keyword">for</span> instructions.<br></code></pre></td></tr></table></figure><p>检查一下 <code>dendrite.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> nginx.conf<br></code></pre></td></tr></table></figure>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-a491874d" role="button" aria-expanded="false" aria-controls="collapse-a491874d">        <div class="fold-arrow">▶</div>下面的内容已经过期，`certbot` 会帮你加上那四行      </div>      <div class="fold-collapse collapse" id="collapse-a491874d">        <div class="fold-content">          <p>你会发现末尾多了两行</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/askk.cc/fullchain.pem; <span class="hljs-comment"># managed by Certbot</span><br><span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/askk.cc/privkey.pem; <span class="hljs-comment"># managed by Certbot</span><br></code></pre></td></tr></table></figure><p>但是！我们的示例配置里明明有三行，我们还要生成另一个文件(这里参考 <a href="https://stackoverflow.com/questions/47190886/certbot-using-weak-diffie-hellman-encryption">certbot using weak diffie hellman encryption</a>)</p><p>执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> openssl  dhparam -out  /etc/letsencrypt/dhparams.pem 2048<br></code></pre></td></tr></table></figure><p>然后在 编辑<code>dendrite.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> vim dendrite.conf<br></code></pre></td></tr></table></figure><p>在前两行 ssl 下面加入</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/dhparams.pem;<br></code></pre></td></tr></table></figure><p>最后检查 <code>dendrite.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> dendrite.conf<br></code></pre></td></tr></table></figure><p>你的 <code>dendrite.conf</code> 看起来像这样 (注意最后三行。)</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#change IP to location of monolith server</span><br><span class="hljs-section">upstream</span> monolith&#123;<br><span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8008</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl; <span class="hljs-comment"># IPv4</span><br><span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl; <span class="hljs-comment"># IPv6</span><br><span class="hljs-attribute">server_name</span> askk.cc;<br><br><br><span class="hljs-attribute">proxy_set_header</span> Host      <span class="hljs-variable">$host</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br><span class="hljs-attribute">proxy_read_timeout</span>         <span class="hljs-number">600</span>;<br><br><span class="hljs-section">location</span> /.well-known/matrix/server &#123;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.server&quot;: &quot;askk.cc:443&quot; &#125;&#x27;</span>;<br>&#125;<br><br><span class="hljs-section">location</span> /.well-known/matrix/client &#123;<br><span class="hljs-comment"># If your sever_name here doesn&#x27;t match your matrix homeserver URL</span><br><span class="hljs-comment"># (e.g. hostname.com as server_name and matrix.hostname.com as homeserver URL)</span><br><span class="hljs-comment"># add_header Access-Control-Allow-Origin &#x27;*&#x27;;</span><br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.homeserver&quot;: &#123; &quot;base_url&quot;: &quot;https://askk.cc&quot; &#125; &#125;&#x27;</span>;<br>&#125;<br><br><span class="hljs-section">location</span> /_matrix &#123;<br><span class="hljs-attribute">proxy_pass</span> http://monolith;<br>&#125;<br><br><span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/askk.cc/fullchain.pem; <span class="hljs-comment"># managed by Certbot</span><br><span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/askk.cc/privkey.pem; <span class="hljs-comment"># managed by Certbot</span><br><span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/dhparams.pem;<br>&#125;<br></code></pre></td></tr></table></figure>        </div>      </div>    </div><p>现在我们就算设置好了，重启 nginx 然后看下是否成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart nginx<br><span class="hljs-built_in">sudo</span> systemctl status nginx<br></code></pre></td></tr></table></figure><p>如果有 绿色的 Active: <strong>active (running)</strong>  字样说明可以了。</p><h2 id="使用不同于-homeserver-的-well-known-server">使用不同于 homeserver 的 well known server</h2><p>这件事的意义在于这里，由于我的 homeserver 叫 <code>matrix.askk.cc</code> , 所以在我的服务器注册的用户都会叫做 <code>@xxx:matrix.askk.cc</code> 这样其实不是很方便，我们也许希望用户叫做 <code>@xxx:askk.cc</code>. 但是我们可能已经把 <code>askk.cc</code> 拿来搭建网站了（<code>443</code>跟<code>80</code>已经被使用了。所以要使用其他的 well known server )</p><p>下面我们假设我的 homeserver 叫 <code>askk.cc</code>(即注册用户叫 <code>@xxx:askk.cc</code>), well known server 叫 <code>matrix.askk.cc</code></p><hr><p>如果你想要使用的 <code>homeserver</code> 与 well-know-server不同（说人话就是 <code>matrix.org</code> 的 well known server 是 <code>matrix-federation.matrix.org</code>）</p><p>你需要修改 <code>/etc/dendrite/config.yaml</code>,比如我希望 well know server 是 <code>matrix.askk.cc</code></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">well_known_server_name:</span> <span class="hljs-string">&quot;matrix.askk.cc&quot;</span><br></code></pre></td></tr></table></figure><p>同时你需要修改 <code>nginx</code> 的页面配置为如下的部分（只放了主要的部分，删除了 <code>ssl</code> 等配置，自己补上）。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span><br>&#123;<br>  <span class="hljs-attribute">server_name</span> matrix.askk.cc;<br>  <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl; <span class="hljs-comment"># IPv6</span><br>  <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl; <span class="hljs-comment"># IPv6</span><br><br><br>  <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>  <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>  <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">600</span>;<br><br>  <span class="hljs-section">location</span> /.well-known/matrix/server<br>  &#123;<br>    <span class="hljs-attribute">default_type</span> application/json;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.server&quot;: &quot;matrix.askk.cc:443&quot; &#125;&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-section">location</span> /.well-known/matrix/client<br>  &#123;<br>    <span class="hljs-comment"># If your sever_name here doesn&#x27;t match your matrix homeserver URL</span><br>    <span class="hljs-comment"># (e.g. hostname.com as server_name and matrix.hostname.com as homeserver URL)</span><br>    <span class="hljs-attribute">default_type</span> application/json;<br>    <span class="hljs-attribute">add_header</span> Access-Control-Allow-Origin <span class="hljs-string">&#x27;*&#x27;</span>;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.homeserver&quot;: &#123; &quot;base_url&quot;: &quot;https://askk.cc&quot; &#125; &#125;&#x27;</span>;<br>&#125;<br><span class="hljs-comment"># 访问 / 手动返回404</span><br><span class="hljs-section">location</span> /<br>&#123;<br>  <span class="hljs-attribute">return</span> <span class="hljs-number">404</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>同时我们给 <code>askk.cc</code> 的 nginx 的配置文件加上如下片段</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs nginx">server&#123;<br>    <span class="hljs-comment"># 其他部分</span><br>  <span class="hljs-comment">## matrix</span><br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">8448</span> ssl;<br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">8448</span> ssl;<br>    <span class="hljs-section">location</span> /_matrix &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://matrix.askk.cc:8008;<br>        <span class="hljs-comment">#proxy_pass http://127.0.0.1:8008;</span><br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$remote_addr</span>;<br>    &#125;<br>    <span class="hljs-section">location</span> /.well-known/matrix/server &#123;<br>        <span class="hljs-attribute">default_type</span> application/json;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.server&quot;: &quot;matrix.askk.cc:443&quot; &#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-section">location</span> /.well-known/matrix/client &#123;<br>        <span class="hljs-comment"># If your sever_name here doesn&#x27;t match your matrix homeserver URL</span><br>        <span class="hljs-comment"># (e.g. hostname.com as server_name and matrix.hostname.com as homeserver URL)</span><br>        <span class="hljs-attribute">default_type</span> application/json;<br>        <span class="hljs-attribute">add_header</span> Access-Control-Allow-Origin <span class="hljs-string">&#x27;*&#x27;</span>;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&#123; &quot;m.homeserver&quot;: &#123; &quot;base_url&quot;: &quot;https://askk.cc&quot; &#125; &#125;&#x27;</span>;<br>    &#125;<br><span class="hljs-comment"># 其他部分</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="测试结果">测试结果</h2><p>去 <a href="https://federationtester.matrix.org/">https://federationtester.matrix.org/</a> 输入自己的的域名(<code>askk.cc</code>) 测试一下</p><p>如果 checks 显示緑色的 <code>Success</code> 就说明成功啦！</p><h2 id="备份与迁移">备份与迁移</h2><p>由于国内的服务器连接不到 <code>matrix.org</code>, 我在服务器上面挂了代理，但是 Nick Cao 老师建议部署到 境外的服务器上。于是我就开始迁移到 Oracle 的服务器上。</p><p>系统还是arch, 所以照常安装。不过 <code>matrix_key.pem</code> 用之前的就是。数据库密码也尽量用一样的。部署好之后导入 postgresql 的数据库就行，原本的用户也还在。</p><p>postgresql 可以不用跟着迁移，只要在新服务器上改下对应的 dendrite 配置文件的连接密码即可，但是这样的话，我们需要对 postgresql 进行一些配置，参见</p><p><a href="https://wiki.archlinux.org/title/PostgreSQL#Configure_PostgreSQL_to_be_accessible_from_remote_hosts">Configure PostgreSQL to be accessible from remote hosts</a>。</p><p>先在旧服务器上导出数据。先停止 dendrite, 然后切到 root 来导出数据。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">sudo systemctl <span class="hljs-keyword">disable</span> <span class="hljs-comment">--now dendrite</span><br>sudo su<br>pg_dump -U postgres -F c dendrite &gt; db1.tar<br></code></pre></td></tr></table></figure><p>把旧服务器上的数据库传到本地</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rsync -chavzP -e <span class="hljs-string">&quot;ssh -p 3456 -i ~/.ssh/tencent-arch&quot;</span> sukanka@a.sukanka.com:~/db1.tar /tmp/www<br></code></pre></td></tr></table></figure><p>把本地的数据库传到新服务器上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rsync -chavzP -e <span class="hljs-string">&quot;ssh -p 1234 -i ~/.ssh/oracle&quot;</span> /tmp/www  sukanka@oarch.sukanka.com:~/db1.tar<br></code></pre></td></tr></table></figure><p>在新服务器上面停止 Dendrite,然后切到 postgres.运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl stop dendrite<br><span class="hljs-built_in">sudo</span> su<br>su postgres<br>dropdb dendrite<br></code></pre></td></tr></table></figure><p>退回到普通用户，恢复数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pg_restore -U postgres -d dendrite -1  db1.tar<br></code></pre></td></tr></table></figure><p>还要备份旧服务器上缓存的媒体文件，并恢复到新服务器上，不然新服务器上会找不到有的媒体文件。</p><p>下面是在旧服务器上的操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> su<br><span class="hljs-built_in">cd</span> /var/lib/dendrite<br>tar -czvf /home/sukanka/media.tar.gz media_store<br></code></pre></td></tr></table></figure><p>然后在把压缩包下载到本地服务器并上传到新服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rsync -chavzP -e <span class="hljs-string">&quot;ssh -p 3456 -i ~/.ssh/tencent-arch&quot;</span> sukanka@a.sukanka.com:~/media.tar.gz /tmp/media.tar.gz<br>rsync -chavzP -e <span class="hljs-string">&quot;ssh -p 1234 -i ~/.ssh/oracle&quot;</span> /tmp/media.tar.gz  sukanka@oarch.sukanka.com:~/media.tar.gz<br></code></pre></td></tr></table></figure><p>在新服务器上恢复数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> su<br><span class="hljs-built_in">cp</span> media.tar.gz /var/lib/dendrite<br><span class="hljs-built_in">cd</span> /var/lib/dendrite<br>tar -xvf media.tar.gz media_store<br></code></pre></td></tr></table></figure><p>新服务器上重新启动 dendrite</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl start dendrite<br></code></pre></td></tr></table></figure><h3 id="注意">注意</h3><p>如果你同时搞了 bridge, 记得把桥的数据库也备份下来。</p><h2 id="桥接-tg">桥接 tg</h2><p>安装 AUR 上的 <code>mautrix-telegram</code> 包，改好配置文件。另外记得把 <code>dendrite</code> 加入到 <code>mautrix-telegram</code> 组。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">usermod -a -G mautrix-telegram dendrite<br></code></pre></td></tr></table></figure><p>首先我们还是要为 <code>mautrix-telegram</code> 创建一个 <code>postgres</code> 用户与数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> -u postgres createuser -P mautrix-telegram<br><span class="hljs-built_in">sudo</span> -u postgres createdb -O mautrix-telegram mautrix-telegram<br></code></pre></td></tr></table></figure><p>创建用户的时候，密码与 dendrite 用户的一样就行。</p><p>然后把数据库链接写入配置文件。</p><p>改配置文件的时候记得 <code>address</code> 填 well-known server, <code>domain</code> 填 <code>homeserver</code>, 例如我的 <code>homeserver</code> 是 <code>askk.cc</code>(即用户为 <code>@user:askk.cc</code>), 但是 well-known server 为 <code>matrix.askk.cc</code>，则按照如下填写。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># The address that this appservice can use to connect to the homeserver.</span><br><span class="hljs-attr">address:</span> <span class="hljs-string">https://matrix.askk.cc</span><br><span class="hljs-comment"># The domain of the homeserver (for MXIDs, etc).</span><br><span class="hljs-attr">domain:</span> <span class="hljs-string">askk.cc</span><br></code></pre></td></tr></table></figure><p>改好配置文件之后，运行下面的命令，生成 <code>registration.yaml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/mautrix-telegram<br><span class="hljs-built_in">sudo</span> -u mautrix-telegram python -m mautrix_telegram -g<br></code></pre></td></tr></table></figure><p>如果你服务器在国内，可能你还需要为它设置代理，修改<code>mautrix-telegram</code> 的 <code>config.yaml</code>，这部分改成如下的样子(直接搜索 proxy), 然后端口这些根据你的情况自己填。同时记得安装 <code>PySocks</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">...<br>proxy:<br>       <span class="hljs-comment"># Allowed types: disabled, socks4, socks5, http, mtproxy</span><br>       <span class="hljs-built_in">type</span>: socks5<br>       <span class="hljs-comment"># Proxy IP address and port.</span><br>       address: 127.0.0.1<br>       port: 20170<br>      ...<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S python-pysocks<br></code></pre></td></tr></table></figure><p>记得重新生成 <code>registration.yaml</code></p><p>最后修改 dendrite 的配置文件（在 <code>/etc/dendrite/config.yaml</code>)，加入最下面一行。最后重启 <code>dendrite</code> 跟 <code>mautrix-telegram</code> 即可。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">app_service_api:</span><br>  <span class="hljs-attr">internal_api:</span><br>    <span class="hljs-attr">listen:</span> <span class="hljs-string">http://localhost:7777</span><br>    <span class="hljs-attr">connect:</span> <span class="hljs-string">http://localhost:7777</span><br>  <span class="hljs-attr">database:</span><br>    <span class="hljs-attr">connection_string:</span> <span class="hljs-string">postgres://dendrite:E3f4zM4fMhWvsv@localhost/dendrite?sslmode=disable</span><br>    <span class="hljs-attr">max_open_conns:</span> <span class="hljs-number">5</span><br>    <span class="hljs-attr">max_idle_conns:</span> <span class="hljs-number">2</span><br>    <span class="hljs-attr">conn_max_lifetime:</span> <span class="hljs-number">-1</span><br>  <span class="hljs-attr">disable_tls_validation:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">config_files:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/mautrix-telegram/registration.yaml</span><br></code></pre></td></tr></table></figure><h2 id="与-mastodon-共用主域名">与 mastodon 共用主域名</h2><p>与在另一个服务器上的 mastodon 共用同一个主域名，参见 <a href="https://blog.askk.cc/2022/05/05/mastodon-and-matrix-under-same-domain/">在同一域名下部署 mastodon 与 matrix</a>。</p>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dendrite</tag>
      
      <tag>matrix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 Oracle 免费 VPS 上安装 Archlinux</title>
    <link href="/2022/02/14/install-ArchLinux-On-Oracle-VPS/"/>
    <url>/2022/02/14/install-ArchLinux-On-Oracle-VPS/</url>
    
    <content type="html"><![CDATA[<p>今天的故事是，在 甲骨文 (Oracle) 提供的免费 VPS 上安装 Archlinux。我很早以前就白嫖了两台 VPS, 配置为 <code>1C1G+50G +480Mbps</code>. 默认提供的系统不含 Archlinux.</p><p>很久以前，我成功在腾讯云上使用 <a href="https://github.com/felixonmars/vps2arch">vps2arch</a> 成功装上了 Archlinux。但是，在 Oracle 上面一直失败，后来我请 小太阳 <code>bigfootACA</code> 帮我安装了一台。</p><p>另一台上面有运行自建的服务，所以一直没有用。直到现在把服务迁移出来了，才考虑也装上 Archlinux，另一个原因是看到群友在讨论在 Oracle VPS 上安装 Arch 这件事情。 但是，现在不好意思再次麻烦人家了。自己动手，丰衣足食。</p><hr><p><strong>更新：本文已经过时，唯一的价值在于连接  VNC，请参考 <a href="https://blog.askk.cc/2022/07/04/reinstall-arch-on-oracle/">重新在 Oracle VPS 上安装 archlinux</a></strong>。</p><h2 id="参考资料">参考资料</h2><p>群友发的两篇博客</p><ul><li>Clansty 的 <a href="https://nyac.at/posts/cloud-server-arch-linux">在阿里云服务器上安装 Arch Linux</a></li><li>Cpt. Huntsman 的 <a href="https://nwn.moe/posts/vps2arch/">给VPS安装Arch Linux</a></li><li>viseator 的 <a href="https://www.viseator.com/2017/05/17/arch_install/">以官方Wiki的方式安装ArchLinux</a> 或者说官方 Wiki</li><li><a href="https://www.zhihu.com/people/68811377">68811377</a> 的知乎文章 <a href="https://zhuanlan.zhihu.com/p/414786217">为Oracle Cloud永久免费VPS重装系统</a></li></ul><h2 id="前期探索">前期探索</h2><p>最开始的时候，我是按照 Cpt. Huntsman 的文章走的，可是，没办法，没有 <code>pivot_root</code> 命令，于是放弃。</p><p>后面转到 Clansty 的方案，她的方案我尝试了很多遍，虽然有些小坑，但是有一次，我本来已经装好了，结果被我作没了（进 <code>/etc/shadow</code> 把自建用户那行删了，自建用户再也登不上，而 <code>root</code> 又没改密码，导致再也连不上了。</p><p>后面就直接终止 VPS, 重新建立实例，中间出现了几次妖蛾子，有时候创建出来的实例我根本就登不上去。有时候创建实例卡在初始化那里。也有一次，本来都快装好 Arch 了，结果 <code>grub-install</code> 命令没搞对（照抄的 Clansty 的，但是我的是 UEFI 引导）。也尝试过知乎文章那样，用控制台连接，然后通过网络启动的方式安装，结果直接一个 <code>kernel panic</code>.</p><p>最终是结合了 Clansty 的方案与知乎的文章的控制台连接。最终的结果如图所示，反复创建删除了好几次。</p><p><img src="https://bu.dusays.com/2022/04/16/6b897a19c1c23.png" alt=""></p><h2 id="安装过程">安装过程</h2><h3 id="选择镜像">选择镜像</h3><p>创建实例的时候选择的镜像为 <strong>Ubuntu 20.04</strong> , 选 <strong>Ubuntu minimal</strong> 也可以 （这个不带 Vim)。</p><p><img src="https://bu.dusays.com/2022/04/16/fe1b3ef46f42e.png" alt="image-20220214005324348"></p><p>在 <strong>添加 SSH 密钥</strong> 的地方，如果你不知道什么是 <em>ssh 密钥</em> 请选择默认选项并点击 <strong>保存私有密钥</strong> 然后放到 <code>~/.ssh/id_rsa</code> 并且执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 600 ~/.ssh/id_rsa<br></code></pre></td></tr></table></figure><p>然后点击<strong>创建</strong>。如果你知道 ssh 密钥，按你自己的喜好操作即可。</p><h3 id="连接服务器">连接服务器</h3><p>创建好之后，选择刚刚创建好的实例</p><p><img src="https://bu.dusays.com/2022/04/16/c6b311e06f1d6.png" alt="image-20220214010036122"><br>找到 IP 地址（打码的部分）与用户名 (ubuntu)</p><p>你可以在终端通过如下命令连接到你的服务器：（把 <code>123.123.123.123</code> 换成你服务器的 IP）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh ubuntu@123.123.123.123 -i ~/.ssh/id_rsa<br></code></pre></td></tr></table></figure><p>现在我们已经知道怎样连接服务器了。</p><p>连上去之后，输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> su<br>passwd root<br>passwd ubuntu<br></code></pre></td></tr></table></figure><p>给两个用户都设置一个密码（每个密码都要输两遍）。以便我们能够在VNC 里面登录。</p><h3 id="连接-VNC">连接 VNC</h3><p>这一部分参考的知乎的文章。</p><p>你需要：</p><ol><li>一台闲置（Idle）的，跟 Oracle 免费机完全没有关联的 VPS (简称 <strong>I 机</strong>)</li><li>一个临时生成的ssh公钥与私钥文件（ssh2）</li><li>装好一个 VNC 客户端，我用的 <code>remmina</code> 与它的  vnc 插件 <code>libvncserver</code></li></ol><p>生成 ssh key:</p><blockquote><p>用I机当做跳板，在内部创建与F机控制台通信的ssh隧道，远程登录I机，输入以下命令，生成ssh2：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh-keygen -b 4096<br></code></pre></td></tr></table></figure><p>一路回车，生成成功，然后导出公钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> ~/.ssh/id_rsa.pub<br></code></pre></td></tr></table></figure><p>将其保留在记事本上，后面要用。</p></blockquote><p>在<strong>实例的详细信息</strong>下方找到 <strong>资源&gt;控制台连接</strong>，创建一个<strong>本地连接</strong>。将刚刚复制到记事本的公钥粘贴进去，完成创建（我已经创建好了，所以无法再创建）。</p><p><img src="https://bu.dusays.com/2022/04/16/fc77d8c7a9ca4.png" alt="image-20220214011517111"></p><p>找到刚刚创建好的控制台连接，最右边点击三个点，选择<strong>复制 Linux/Mac 的 VNC 连接</strong> （我是 Linux 系统嘛，反正复制 VNC 就对了）。</p><p><img src="https://bu.dusays.com/2022/04/16/4bad93c729ea0.png" alt="image-20220214011744746"></p><p>复制出来的命令像这样（这里抄的知乎的，不敢把我自己的放出来），注意这里相对于复制出来的有更改，</p><p><code>localhost:5900</code> 改成了 <code>0.0.0.0:32647</code>， 这是出于安全的原因。</p><p>由于 <code>openssh</code> 8.8 开始弃用了 <code>ssh-rsa</code>，我们重新开启它，在 I 机与 oracle vps 上面分别创建 <code>~/.ssh/config</code>, 写入如下内容</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">PubkeyAcceptedKeyTypes</span> +ssh-rsa<br></code></pre></td></tr></table></figure><p>最终我们的命令变成了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -o ProxyCommand=<span class="hljs-string">&#x27;ssh -W %h:%p -oHostKeyAlgorithms=+ssh-rsa -oPubkeyAcceptedKeyTypes=+ssh-rsa  -i .ssh/id_rsa  -p 443 ocid1.instanceconsoleconnection.oc1.ap-tokyo-1.anxhiljr3qzs6ryc3ibomraydyib4qngcpa3h37b2tb4isljgaujwq5jigya@instance-console.ap-tokyo-1.oci.oraclecloud.com&#x27;</span> -N -L 0.0.0.0:32647:ocid1.instance.oc1.ap-tokyo-1.anxhiljr3qzs6rycfo4gp26wnkjhsv23kycsljg63ej2vsh5uxug5ukb3tqq:5900 ocid1.instance.oc1.ap-tokyo-1.anxhiljr3qzs6rycfo4gp26wnkjhsv23kycsljg63ej2vsh5uxug5ukb3tqq -oHostKeyAlgorithms=+ssh-rsa -i .ssh/id_rsa<br></code></pre></td></tr></table></figure><p>在 I机（中转机）上面执行上述命令，可能需要输入 <code>yes</code>. (参考知乎)。执行后，只出现一个不会退出的光标，而无其他报错，就说明运行成功了。</p><p>装好 <code>remmina</code>  与它的vnc 插件后，在本地打开终端，执行下面的命令（英文界面，中文界面是方框），</p><p><img src="https://bu.dusays.com/2022/07/04/62c24ba5a823e.png" alt="1656900513563.png"></p><p>输入你的中转机（I机） 的 IP 地址，和端口，回车。如图上为 <code>234.234.234.234:32647</code>.</p><p>连接上之后会有这样一个黑框框（我这个已经装好 了）。通过VNC 我们可以监测到 VPS 的状态，即使 ssh 登录不上了，我们还可以通过 VNC 界面查看原因。</p><p>输入用户名 <code>root</code>, 密码点击</p><p><img src="https://bu.dusays.com/2022/07/04/62c24c0b459f1.png" alt="1656900617176.png"></p><p>输入用户名 <code>root</code>, 将 <code>root</code> 的密码复制到剪贴板，然后按照下图的方式输入</p><p><img src="https://bu.dusays.com/2022/07/04/62c24c9b50ce4.png" alt="1656900760844.png"></p><p>准备好了之后，我们可以正式开始安装 Archlinux 了。</p><h3 id="安装-Archlinux">安装 Archlinux</h3><p>首先，登录要安装 Archlinux 的服务器。这里是 Oracle 免费 VPS ubuntu 20.04.</p><p>这一部分基本抄袭的 Clansty 的内容。</p><h4 id="下载-RootFS">下载 RootFS</h4><p>首先呢我们得有一个 Arch 的 RootFS，也就是一个基本的包括 Arch Linux 根目录下所有文件的文件夹，一会儿要 <code>chroot</code> 进去。为了使用<code> chroot</code> 这个功能，直接在 <a href="https://archlinux.org/download/">Arch 的下载页面</a>找一个离服务器比较近的镜像源，复制里面 <code>archlinux-bootstrap</code> 开头的 <code>tar.gz</code> 包的地址，下载到服务器的 <code>/tmp</code> 文件夹。其实这个时候可以 <code>cd</code>到 <code>/tmp</code> 里面把不相关的文件都删掉了。</p><p><strong>注：由于我的服务器IP 是日本的，所以我选择了日本的服务器</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">sudo</span> su<br>wget https://ftp.jaist.ac.jp/pub/Linux/ArchLinux/iso/latest/archlinux-bootstrap-x86_64.tar.gz<br></code></pre></td></tr></table></figure><p>然后自然是要解包这个文件，顺便看看里面都有些啥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -xzf <span class="hljs-built_in">arch</span>*<br><span class="hljs-built_in">cd</span> root.x86_64<br><span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>结果就像</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">bin  boot  dev  etc  home  lib  lib64  mnt  opt  <span class="hljs-keyword">proc</span><span class="hljs-title">  README</span> <span class="hljs-title"> root</span> <span class="hljs-title"> run</span> <span class="hljs-title"> sbin</span> <span class="hljs-title"> srv</span> <span class="hljs-title"> sys</span> <span class="hljs-title"> tmp</span> <span class="hljs-title"> usr</span> <span class="hljs-title"> var</span><br></code></pre></td></tr></table></figure><p>这里面就像一个装好了的 Linux 的根目录一样，所以说是 RootFS 嘛</p><h4 id="进入-chroot-环境">进入 chroot 环境</h4><p>如果使用的是 ubuntu minimal (不带 vim)，先安装 vim</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt update <br>apt install vim<br></code></pre></td></tr></table></figure><p>听说需要用 <code>mount --bind</code> 把 RootFS 解包的目录自己与自己链接起来，不然 <code>pacman</code> 会装不了软件。至于要是不知么做会发生什么，咱也没试过，妳们可以自行尝试。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount --<span class="hljs-built_in">bind</span> /tmp/root.x86_64 /tmp/root.x86_64<br></code></pre></td></tr></table></figure><p>别急，由于这个 RootFS 包是最简安装，你看它只有 140MB 是吧，它里面甚至连个文本编辑器都没有。所以咱需要在 <code>chroot</code> 之前编辑一下镜像源的文件，启用自己喜欢的镜像源，这样 <code>pacman</code> 才能正常安装系统。我的 IP 是日本，我就直接使用日本的镜像源了。虽然 zhullyb 说国外一律用 <a href="https://cloudflaremirrors.com/archlinux">CloudFlare 的镜像源</a>&lt;但是在安装的时候用这个会出错，可以装好了之后替换成这个。选择镜像源的方式就是删除该行前面的注释（<code>#</code>）。vim 使用教程见 <a href="https://www.runoob.com/linux/linux-vim.html">菜鸟教程</a>,会插入 (i), 退出即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /tmp/root.x86_64/etc/pacman.d/mirrorlist<br></code></pre></td></tr></table></figure><p>好啦，现在可以正式进入 <code>chroot</code> 环境啦。不过呢用普通的 <code>chroot</code> 进去之后 <code>/dev</code> 之类的目录会是空的，不可以正常安装系统。要使用 Arch 镜像中的 <code>arch-chroot</code> 脚本，这个脚本会自动执行一些 <code>mount</code> 命令，把设备啊之类的都映射到 <code>chroot</code> 容器里面，咱就可以正常安装系统啦。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/root.x86_64/bin/arch-chroot /tmp/root.x86_64/<br></code></pre></td></tr></table></figure><h4 id="在-chroot-环境中给机器安装-Arch-Linux">在 chroot 环境中给机器安装 Arch Linux</h4><p>首先初始化 <code>pacman</code> 的密钥（读作 ”蜜月“ 哦），<code>pacman</code> 就能正常使用啦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacman-key --init<br>pacman-key --populate archlinux<br></code></pre></td></tr></table></figure><p>现在我们已经进入属于 Arch 的世界了，不会再想念原先的 Linux 发行版了。所以现在应该把原先发行版的文件消灭掉。由于我们现在运行的环境就在原先的分区上，所以直接格式化肯定是不行的。需要把原先的分区挂载到现在的系统中，然后把属于原系统的文件删删删</p><p>在<code>Oracle</code>中，系统分区是 <code>/dev/sda1</code>。</p><p><strong>注：我们可以在 VPS 上执行如下命令查看有哪些分区哦</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">➜  ~ lsblk<br>NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>sda       8:0    0 46.6G  0 disk<br>|-sda1    8:1    0 46.5G  0 part /<br>|-sda14   8:14   0    4M  0 part<br>`-sda15   8:15   0  106M  0 part /boot<br></code></pre></td></tr></table></figure><p>可以看到 系统分区是 <code>/dev/sda1</code>, <code>boot</code> 分区是 <code>/dev/sda15</code>，在 ubuntu里面运行 <code>lsblk</code> 的时候是不会显示 <code>/boot</code> 的，只会显示</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tap">➜  ~ lsblk<br>NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>sda       8:0   <span class="hljs-number"> 0 </span>46.6G <span class="hljs-number"> 0 </span>disk<br>|-sda1    8:1   <span class="hljs-number"> 0 </span>46.5G <span class="hljs-number"> 0 </span>part /<br>|-sda14   8:14  <span class="hljs-number"> 0 </span>   4M <span class="hljs-number"> 0 </span>part<br>`-sda15   8:15  <span class="hljs-number"> 0 </span> 106M <span class="hljs-number"> 0 </span>part <br></code></pre></td></tr></table></figure><p>的字样，但是我们同样要意识到这个<code>106M</code> 的分区应该是 <code>boot</code>.</p><p><strong>现在我们开始挂载分区到系统中啦。</strong></p><p>首先看看你的系统引导方式是 <code>BIOS</code> 还是 <code>UEFI</code>, 这取决于我们是否需要挂载 <code>boot</code> 分区。参考 <a href="https://www.viseator.com/2017/05/17/arch_install/#%E6%A3%80%E6%9F%A5%E5%BC%95%E5%AF%BC%E6%96%B9%E5%BC%8F">Viseator</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> /sys/firmware/efi/efivars<br></code></pre></td></tr></table></figure><p>输入命令并回车执行后，如果提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span>: cannot access <span class="hljs-string">&#x27;/sys/firmware/efi/efivars&#x27;</span>: No such file or directory<br></code></pre></td></tr></table></figure><p>表明你是以<code>BIOS</code>方式引导，否则为以<code>EFI</code>方式引导。</p><p>然后挂载分区，执行下面的命令,挂载 <code>sda1</code> (替换为你的分区)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/sda1 /mnt<br></code></pre></td></tr></table></figure><p><code>UEFI</code> 引导的还要将 <code>sda15</code> （替换为你的分区）挂载到 <code>boot</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/sda15 /mnt/boot<br></code></pre></td></tr></table></figure><p>由于 Linux 系统中“一切皆文件”，像 <code>/dev</code> <code>/proc</code> <code>/run</code> <code>/sys</code> 这些目录都是存储到硬件的映射的，所以不能删。同时，我们工作的目录在 <code>/tmp</code> 下，<code>swapfile</code> （如果有）是我们正在使用的 swap。咱们用 <code>rm -rf</code> 命令，把其余的文件都清除干净。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /mnt<br><span class="hljs-built_in">rm</span> -rf bin boot etc home mnt opt root sbin srv usr var vml* ini* lib* med* snap*<br><span class="hljs-built_in">cd</span> /<br></code></pre></td></tr></table></figure><p>删不掉的就算啦，等它在那里就是了。</p><p>之后就正是进入安装 <code>pacstrap</code> 环节啦</p><p>像正常安装 Arch Linux 一样使用 <code>pacstrap</code> 向目标挂载点安装系统底层的软件包，并生成 <code>fstab</code> 挂载配置文件，注意，这里用 cloudflare 源会出错。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacstrap /mnt base base-devel linux linux-headers linux-firmware vim dhcpcd openssh grub<br>genfstab -U /mnt &gt; /mnt/etc/fstab<br></code></pre></td></tr></table></figure><p>这时候系统安装就已经完成了。</p><h4 id="进入新系统">进入新系统</h4><p>再通过 <code>arch-chroot</code> 切换到安装好的系统目录下，进入最后的系统配置和必备程序包的安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">arch-chroot /mnt<br></code></pre></td></tr></table></figure><blockquote><p>注意，要是在 chroot 的时候发生与 <code>/etc/resolv.conf</code> 挂载相关的问题，可以先执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">umount /etc/resolv.conf<br>arch-chroot /mnt<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;nameserver 223.5.5.5&#x27;</span> &gt; /etc/resolv.conf<br></code></pre></td></tr></table></figure><p>否则可能会无法解析 IP。如果上面 <code>chroot</code> 时没有出现问题可以跳过这个</p></blockquote><p>首先将时区设置为北京时间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br></code></pre></td></tr></table></figure><p>在 <code>/etc/hostname</code> 中设置主机名，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/hostname<br></code></pre></td></tr></table></figure><p>设置你的主机名，如 <code>newarch</code>，然后修改 <code>/etc/hosts</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/hosts<br></code></pre></td></tr></table></figure><p>添加如下内容。注意，第三行需要修改为你自己的 IP，并将 <code>newarch</code> 修改为你刚刚设置的主机名。</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>localhost<br>::<span class="hljs-number">1</span>localhost<br><span class="hljs-number">123.123.123.123</span>newarch.localdomainnewarch<br></code></pre></td></tr></table></figure><p>开启一下必要的服务，这样重启之后就有网并且能通过 SSH 连上啦.(<strong>这里可能会失败，重启后没有网</strong>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> dhcpcd<br>systemctl <span class="hljs-built_in">enable</span> sshd<br></code></pre></td></tr></table></figure><p>还需要给自己创建一个用户，Arch Linux 默认禁止以 <code>root</code> 身份远程登录。<code>-m</code> 的意思是为用户创建自己的主目录，<code>wheel</code> 是默认能执行 <code>sudo</code> 命令的用户组，</p><p>（将 <code>sukanka</code> 替换为你的用户名）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">useradd sukanka -m -G wheel<br></code></pre></td></tr></table></figure><p>然后切换到新创建的用户 （将 <code>sukanka</code> 替换为你的用户名），并且添加自己的公钥，这样重启之后就能直接公钥登录 SSH 啦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">su sukanka<br><span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">mkdir</span> .ssh<br><span class="hljs-built_in">chmod</span> 700 .ssh<br><span class="hljs-built_in">cd</span> .ssh<br>vim authorized_keys <span class="hljs-comment"># 添加你的公钥，你可以在本地机器上面生成一个。</span><br><span class="hljs-built_in">chmod</span> 600 authorized_keys<br></code></pre></td></tr></table></figure><p>回到 root 用户，保险起见，给 root 以及自己的用户设置好密码，这样要是无法公钥登录还能以密码登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">passwd root<br>passwd sukanka<br></code></pre></td></tr></table></figure><p>编辑 <code>sudo</code> 配置文件，取消 <code>%wheel ALL=(ALL) NOPASSWD: ALL</code> 这一行的注释</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">EDITOR=vim visudo<br></code></pre></td></tr></table></figure><p>最后创建引导文件，准备重启啦</p><p><strong>如果你是 BIOS</strong> 引导</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">grub-install --target=i386-pc /dev/vda<br>grub-mkconfig -o /boot/grub/grub.cfg<br></code></pre></td></tr></table></figure><p><strong>如果是 UEFI 引导</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacman -S grub efibootmgr<br>grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub<br>grub-mkconfig -o /boot/grub/grub.cfg<br></code></pre></td></tr></table></figure><p>差不多了，进控制台重启服务器。</p><p>同时，我们连接上 VNC, 查看服务器的状态与启动的过程。</p><p>确保服务器启动成功之后，尝试在本地通过 ssh 连接服务器。密码连接方式如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh sukanka@123.123.123.123 -i ~/.ssh/oracle<br></code></pre></td></tr></table></figure><p>其中 <code>sukanka@123.123.123.123</code> 是 <code>用户名@IP</code> , <code>～/.ssh/oracle</code> 是你在</p><blockquote><p><code>vim authorized_keys # 添加你的公钥，你可以在本地机器上面生成一个。</code></p></blockquote><p>添加的公钥对应的私钥。将它们替换为你自己的信息。</p><p>如果登录失败，尝试使用密码登录，并根据提示输入密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh sukanka@123.123.123.123<br></code></pre></td></tr></table></figure><p>如果这个也没有任何反应，说明服务器没有连上网。</p><p>进入 VNC, 输入用户名，密码（注意密码没有回显）</p><p><img src="https://bu.dusays.com/2022/04/16/1393e47dc8cd4.png" alt="image-20220214022726919"></p><p>登录上去之后，执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl status dhcpcd.service <br>systemctl status sshd.service<br></code></pre></td></tr></table></figure><p>查看 <code>dhcpcd</code> 跟 <code>sshd</code> 的状态，正常两者都应该有显示 <code>Active: **active (running)**</code>，否则就是两者没能成功启动。</p><p>因此我们需要重新让他们自启动‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now dhcpcd.service <br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now sshd.service<br></code></pre></td></tr></table></figure><p>然后再次运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl status dhcpcd.service <br>systemctl status sshd.service<br></code></pre></td></tr></table></figure><p>看看两者的状态，都已经成功运行起来啦。</p><p>我们可以从本地通过 ssh 连接服务器了。</p>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>archlinux</tag>
      
      <tag>VPS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>部署 rustdesk-server-demo</title>
    <link href="/2021/12/09/deploy-rustdesk-server-demo/"/>
    <url>/2021/12/09/deploy-rustdesk-server-demo/</url>
    
    <content type="html"><![CDATA[<p>最近越来越不爽以前用的 <code>todesk</code> 不够流畅，想要自己搭建一个远程桌面服务器，将我在腾讯云的轻量服务器的 8M 大水管利用起来。在 <code>Archlinuxcn-ot</code> 群里面问了一圈，绕来绕去还是回到了 rustdesk, 这是为数不多的开源远程桌面之一。</p><p>该软件包现已经提交到 AUR, 见 <a href="https://aur.archlinux.org/packages/rustdesk-server-demo">rustdesk-server-demo</a></p><h2 id="客户端">客户端</h2><p>首先本地上安装一个 rustdesk, aur 的 <a href="https://aur.archlinux.org/packages/rustdesk/">rustdesk</a> 编译不出来，因此考虑 <a href="https://aur.archlinux.org/packages/rustdesk-bin/">rustdesk-bin</a>, 但是，我看到了 <code>taotieren</code> 认证！然后看到一堆的依赖，一个 <code>bin</code> 包的 <code>makedepends</code> 居然有 <code>gcc</code>, <code>cmake</code> <code>clang</code> 等等。搞的真的要编译什么一样。</p><p>因此打算自己写一个。写好的客户端 <code>PKGBUILD</code> 参考 <a href="https://gist.github.com/sukanka/88ddc411ea8e424dde707a800d1003c9">PKGBUILD for rustdesk</a>.</p><p>包里面有自带 <code>systemd service</code>, 安装之后你可以使用如下命令启动并开启 rustdesk 的开机自启。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl start rustdesk.service<br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> rustdesk.service<br></code></pre></td></tr></table></figure><h2 id="服务器端">服务器端</h2><p>目前服务器端只有一个开源的免费 Demo, 我也写了一个 <code>PKGBUILD</code>,参见 <a href="https://gist.github.com/sukanka/b41e9a3033ef31befa51e06344f5e164">PKGBUILD for rustdesk-server-demo</a>.</p><p>这个 <code>PKGBUILD</code> 在构建的时候会自动获取你的服务器的 IP 地址，并写入到 <code>systemd service</code> 文件里面，如果你不是在要用作 rustdesk server 的服务器上构建，你可以把如下行进行修改：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Environment=\&quot;IP=<span class="hljs-variable">$&#123;_ip&#125;</span>\&quot;<br>Environment=你的服务器域名或者 ip 地址。<br></code></pre></td></tr></table></figure><p>在服务器端安装好 <code>rustdesk-server-demo</code> 之后，运行</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">sudo systemctl <span class="hljs-keyword">start</span> rustdesk-<span class="hljs-keyword">server</span>.service<br>sudo systemctl <span class="hljs-keyword">enable</span> rustdesk-<span class="hljs-keyword">server</span>.service<br></code></pre></td></tr></table></figure><p>将 <code>rustdesk-server-demo</code> 启动并加入开机自启。</p><h2 id="注意事项">注意事项</h2><p>在配置好服务器端之后不要忘记了在服务器提供商处放行 rustdesk 连接的端口（或者在服务器端进行端口转发）。我这里选择直接放行端口。下面是开发者的说明，参见<a href="https://gitee.com/rustdesk/rustdesk-server/blob/master/id-relay-set.md#%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8C-hbbs-%E5%92%8C-hbbr">在服务器上运行 hbbs 和 hbbr</a>.</p><blockquote><p>默认情况下，hbbs 监听21115(tcp)和21116(tcp/udp) ，hbbr 监听21117(tcp)。务必在防火墙开启这几个端口， <strong>请注意21116同时要开启TCP和UDP</strong> ，请注意21116要同时开启TCP和UDP。其中21115是hbbs用作NAT类型测试，21116/UDP是hbbs用作ID注册与心跳服务，21116/TCP是hbbs用作TCP打洞与连接服务，21117是hbbr用作中继服务。</p><ul><li>TCP(21115, 21116, 21117)</li><li>UDP(21116)</li></ul></blockquote><p>最后，提供我的 <code>rustdesk-server</code> 服务器地址：<code>rds.askk.cc</code>， 如果你也愿意共享你的服务器，可以在评论里留下你的 <code>rustdesk-server</code> 服务器地址。</p>]]></content>
    
    
    
    <tags>
      
      <tag>remote desktop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>多元正态的条件分布与 Hotelling&#39;s T square 统计量</title>
    <link href="/2021/10/28/multivariate%20normal%20and%20hotelling&#39;s%20T%20square/"/>
    <url>/2021/10/28/multivariate%20normal%20and%20hotelling&#39;s%20T%20square/</url>
    
    <content type="html"><![CDATA[<p>这篇文章来源于一次作业，本文介绍了多元正态的条件分布，介绍了 Hotelling’s <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 检验与 似然比检验 (Likelihood ratio test) 的 等价性。</p><h2 id="多元正态的条件分布">多元正态的条件分布</h2><p>令 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>X</mi><mn>2</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X=(X_1,X_2)&#x27;\sim N(\mu,\Sigma)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mclose">)</span></span></span></span>, 其中</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Σ</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>12</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>22</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex"> \Sigma=\begin{pmatrix}      \Sigma_{11} &amp; \Sigma_{12} \\      \Sigma_{21} &amp; \Sigma_{22}    \end{pmatrix},</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Σ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span></span></span></span></span></p><p>且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi mathvariant="normal">Cov</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>X</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Sigma_{ij}=\operatorname{Cov}(X_i,X_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mop"><span class="mord mathrm" style="margin-right:0.01389em;">Cov</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">i,j=1,2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span></span></span></span>.</p><p>则有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>X</mi><mn>2</mn></msub><mi mathvariant="normal">∣</mi><msub><mi>X</mi><mn>1</mn></msub><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mn>2</mn></msub><mo>+</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi mathvariant="normal">Σ</mi><mrow><mn>22</mn><mo>⋅</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">X_2|X_1\sim N(\mu_2+\Sigma_{21}\Sigma_{11}^{-1}(X_1-\mu_1), \Sigma_{22\cdot1}),</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1205em;vertical-align:-0.2564em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.4436em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2564em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span><span class="mbin mtight">⋅</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span></span></span></span></span></p><p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mn>1</mn></msub><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mu_1=E(X_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mn>22</mn><mo>⋅</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi mathvariant="normal">Σ</mi><mn>22</mn></msub><mo>−</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi mathvariant="normal">Σ</mi><mn>12</mn></msub></mrow><annotation encoding="application/x-tex">\Sigma_{22\cdot1}=\Sigma_{22}-\Sigma_{21}\Sigma_{11}^{-1}\Sigma_{12}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span><span class="mbin mtight">⋅</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1205em;vertical-align:-0.2663em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><hr><h3 id="证明">证明</h3><p>下面证明这个结论，证明过程参考了知乎的 <a href="https://zhuanlan.zhihu.com/p/47122783">回归分析|笔记整理（4）——多元正态分布理论（中）</a>. 主要思路是对方差进行变形（对角化）</p><p>首先，我们有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Σ</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>12</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>22</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mrow><msub><mi>r</mi><mn>2</mn></msub><mo>−</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>r</mi><mn>1</mn></msub></mrow></mpadded></mover><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>12</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>O</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi mathvariant="normal">Σ</mi><mn>22</mn></msub><mo>−</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi mathvariant="normal">Σ</mi><mn>12</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mrow><msub><mi>c</mi><mn>2</mn></msub><mo>−</mo><msub><mi>c</mi><mn>1</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi mathvariant="normal">Σ</mi><mn>12</mn></msub></mrow></mpadded></mover><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>O</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>O</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mrow><mn>22</mn><mo>⋅</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>≡</mo><mi mathvariant="normal">Λ</mi></mrow><annotation encoding="application/x-tex">\Sigma=\begin{pmatrix}      \Sigma_{11} &amp; \Sigma_{12} \\      \Sigma_{21} &amp; \Sigma_{22}    \end{pmatrix}    \xrightarrow{r_2-\Sigma_{21}\Sigma_{11}^{-1} r_1} \begin{pmatrix}      \Sigma_{11} &amp; \Sigma_{12}                                        \\      O           &amp; \Sigma_{22}-\Sigma_{21}\Sigma_{11}^{-1}\Sigma_{12}    \end{pmatrix}    \xrightarrow{c_2-c_1\Sigma_{11}^{-1}\Sigma_{12}}    \begin{pmatrix}      \Sigma_{11} &amp; O                 \\      O           &amp; \Sigma_{22\cdot1}    \end{pmatrix}\equiv\Lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Σ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2459em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mtight">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.214em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4142em;vertical-align:-0.9571em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4571em;"><span style="top:-3.6171em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9571em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4571em;"><span style="top:-3.6171em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9571em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2459em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.214em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span><span class="mbin mtight">⋅</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Λ</span></span></span></span></span></p><p>由于初等行变换相当于左乘一个初等矩阵，初等列变换相当于右乘一个初等矩阵，因此有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Λ</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>O</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>O</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="normal">Σ</mi><mrow><mn>22</mn><mo>⋅</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>I</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>O</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>I</mi></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mi mathvariant="normal">Σ</mi><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>I</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi mathvariant="normal">Σ</mi><mn>12</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>O</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>I</mi></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>≡</mo><mi>A</mi><mi mathvariant="normal">Σ</mi><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">\Lambda =\begin{pmatrix}      \Sigma_{11} &amp; O                 \\      O           &amp; \Sigma_{22\cdot1}    \end{pmatrix}=    \begin{pmatrix}      I                            &amp; O \\      -\Sigma_{21}\Sigma_{11}^{-1} &amp; I    \end{pmatrix} \Sigma    \begin{pmatrix}      I &amp; -\Sigma_{11}^{-1}\Sigma_{12} \\      O &amp; I    \end{pmatrix}    \equiv A\Sigma A&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Λ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span><span class="mbin mtight">⋅</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4142em;vertical-align:-0.9571em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4571em;"><span style="top:-3.6171em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span><span style="top:-2.4029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9571em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4571em;"><span style="top:-3.6171em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span></span><span style="top:-2.4029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9571em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4571em;"><span style="top:-3.6029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span><span style="top:-2.4029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9571em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4571em;"><span style="top:-3.6029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9571em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord mathnormal">A</span><span class="mord">Σ</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>因此, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="normal">Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi mathvariant="normal">Λ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">\Sigma^{-1}=A&#x27;\Lambda^{-1}A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">Λ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span>.</p><p>对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的 pdf, 有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow></msup><mi mathvariant="normal">∣</mi><mi mathvariant="normal">Σ</mi><msup><mi mathvariant="normal">∣</mi><mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mi>μ</mi><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi mathvariant="normal">Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mi>μ</mi><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">f(X)=(2\pi)^{-\frac{n}{2}}|\Sigma|^{-\frac{1}{2}}e^{-\frac{1}{2}(X-\mu)&#x27;\Sigma^{-1}(X-\mu)},</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2869em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8971em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mord">∣Σ</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0369em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">μ</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">μ</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span></span></span></span></span></p><p>但是，我们只关心指数部分</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mi>μ</mi><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi mathvariant="normal">Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mi>μ</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>X</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>−</mo><msubsup><mi>μ</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>X</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>−</mo><msubsup><mi>μ</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi mathvariant="normal">Λ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>A</mi><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>X</mi><mn>2</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>X</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>−</mo><msubsup><mi>μ</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mo stretchy="false">(</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>X</mi><mn>2</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>2</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mi mathvariant="normal">Λ</mi><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>X</mi><mn>2</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mo stretchy="false">(</mo><mo>−</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>X</mi><mn>2</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>2</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msubsup><mi mathvariant="normal">Σ</mi><mrow><mn>22</mn><mo>⋅</mo><mn>1</mn></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><mo>−</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>X</mi><mn>2</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}      &amp;(X-\mu)&#x27;\Sigma^{-1}(X-\mu) \\      =&amp;      \begin{pmatrix}        X_1&#x27;-\mu_1&#x27; &amp; X_2&#x27;-\mu_2&#x27;      \end{pmatrix}A&#x27;\Lambda^{-1}A      \begin{pmatrix}        X_1-\mu_1 \\        X_2-\mu_2      \end{pmatrix}                                                                                                                                               \\                                 =&amp;\begin{pmatrix}                                      X_1&#x27;-\mu_1&#x27; &amp; -(\Sigma_{21}\Sigma_{11}^{-1}(X_1-\mu_1)+X_2-\mu_2)&#x27;                                    \end{pmatrix}      \Lambda      \begin{pmatrix}        X_1-\mu_1 \\        -\Sigma_{21}\Sigma_{11}^{-1}(X_1-\mu_1)+X_2-\mu_2      \end{pmatrix}                                                                                                             \\                                 =&amp;(X_1-\mu_1)&#x27;\Sigma^{-1}_{11}(X_1-\mu_1)                                                                                        \\                                 &amp;+(-\Sigma_{21}\Sigma_{11}^{-1}(X_1-\mu_1)+X_2-\mu_2)&#x27;\Sigma_{22\cdot 1}^{-1}(-\Sigma_{21}\Sigma_{11}^{-1}(X_1-\mu_1)+X_2-\mu_2)    \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:9.9866em;vertical-align:-4.7433em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.2433em;"><span style="top:-7.8363em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"></span></span><span style="top:-5.7263em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-3.0192em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-0.8979em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:0.6262em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.7433em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.2433em;"><span style="top:-7.8363em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"><span class="mord"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">μ</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">μ</span><span class="mclose">)</span></span></span><span style="top:-5.7263em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">Λ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span><span style="top:-3.0192em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8571em;"><span style="top:-3.0029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3571em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8571em;"><span style="top:-3.0029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mopen">(</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3571em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Λ</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4571em;"><span style="top:-3.6171em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4029em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9571em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span><span style="top:-0.8979em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"><span class="mord"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.4436em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2564em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:0.6262em;"><span class="pstrut" style="height:3.4571em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.4436em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2564em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.4436em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span><span class="mbin mtight">⋅</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2564em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.4436em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2564em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.7433em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>因此，从方差跟均值可以看出结论了</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>X</mi><mn>2</mn></msub><mi mathvariant="normal">∣</mi><msub><mi>X</mi><mn>1</mn></msub><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mn>2</mn></msub><mo>+</mo><msub><mi mathvariant="normal">Σ</mi><mn>21</mn></msub><msubsup><mi mathvariant="normal">Σ</mi><mn>11</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>−</mo><msub><mi>μ</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi mathvariant="normal">Σ</mi><mrow><mn>22</mn><mo>⋅</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X_2|X_1\sim N(\mu_2+\Sigma_{21}\Sigma_{11}^{-1}(X_1-\mu_1), \Sigma_{22\cdot1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1205em;vertical-align:-0.2564em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.4436em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2564em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span><span class="mbin mtight">⋅</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><h2 id="Hotelling-T-2">Hotelling <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></h2><p>本节参考维基百科 <a href="https://en.wikipedia.org/wiki/Hotelling%27s_T-squared_distribution">Hotelling’s <em>T</em>-squared distribution</a>, 与 <a href="https://en.wikipedia.org/wiki/Wishart_distribution">Wishart distribution</a>.</p><h3 id="Wishart-分布">Wishart 分布</h3><p>首先介绍 Wishart 分布。 Wishart 分布是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 分布在多元正态情况下的推广。其定义为</p><p>令 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span> 为一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">p\times n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 的矩阵, 其每一列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">G_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为来自于多元正态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N_p(0,V)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span> 的相互独立的随机向量。则定义</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>W</mi><mo>=</mo><mi>G</mi><msup><mi>G</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>G</mi><mi>i</mi></msub><msubsup><mi>G</mi><mi>i</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>∼</mo><msub><mi>W</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>V</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W=GG&#x27;=\sum_{i=1}^n G_iG_i&#x27; \sim W_p(V,n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord mathnormal">G</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></p><p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>V</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W_p(V,n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 就是 Wishart 分布，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 叫做自由度，V 是缩放矩阵。当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">V=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 的时候就是一元的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 分布。</p><h3 id="Hotelling’s-T-2">Hotelling’s <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></h3><p>Hotelling’s <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>, 顾名思义，就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 分布在多元正态情况下的推广。其定义为</p><p>若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>∼</mo><msub><mi>N</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>I</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d\sim N_p(0,I)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mclose">)</span></span></span></span>,  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span> 是一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">p\times p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的矩阵，与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> 独立，且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>∼</mo><msub><mi>W</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>I</mi><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M \sim W_p(I,m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span>，则如下的二次型</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><mo>=</mo><mi>m</mi><msup><mi>d</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>d</mi><mo>∼</mo><msup><mi>T</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X=md&#x27;M^{-1}d \sim T^2(p,m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord mathnormal">m</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></span></p><p>服从参数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 的 Hotelling <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 分布。</p><p>注意到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><msup><mi>d</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mi>M</mi><mi mathvariant="normal">/</mi><mi>m</mi><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>d</mi></mrow><annotation encoding="application/x-tex">X=d&#x27;(M/m)^{-1}d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord">/</span><span class="mord mathnormal">m</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">d</span></span></span></span>, 可以看出  Hotelling’s <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 分布是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mi>Z</mi><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><msup><mi>χ</mi><mn>2</mn></msup><mi mathvariant="normal">/</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t=Z/(\chi^2/n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mord">/</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord">/</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>在多元条件下的推广(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">t^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>).</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 分布与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span> 分布有关系 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t^2(n)=F(1,n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>, Hotelling’s <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 也与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span> 分布有关系</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup><mo>∼</mo><msup><mi>T</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><mi>n</mi><mo>−</mo><mi>p</mi></mrow></mfrac><mi>F</mi><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo>−</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T^2 \sim T^2(p,n-1) =\frac{p(n-1)}{n-p}F(p,n-p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3074em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span></span></p><h3 id="Hotelling’s-t-2-统计量">Hotelling’s <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">t^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 统计量</h3><p>令 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">i=1,2,\cdots,n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span> 为独立同分布来自于多元正态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N_p(\mu,\Sigma)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mclose">)</span></span></span></span> 的随机向量，样本均值为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\bar x=\frac{1}{n}\sum_{i=1}^nx_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5678em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>样本方差为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mtext>’</mtext></mrow><annotation encoding="application/x-tex">S=\frac{1}{n-1}\sum_{i=1}^n (x_i-\bar x)(x_i-\bar x)’</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">’</span></span></span></span></span></p><p>则有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\bar x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5678em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span></span></span></span> 与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> 独立，且</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>t</mi><mn>2</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><mi>μ</mi><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi>S</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><mi>μ</mi><mo stretchy="false">)</mo><mo>∼</mo><msup><mi>T</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t^2=(\bar x-\mu)&#x27;S^{-1}(\bar x-\mu) \sim T^2(p,n-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">μ</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">μ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p><h3 id="Hotelling’s-T-2-检验与-似然比检验的等价性。">Hotelling’s <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 检验与 似然比检验的等价性。</h3><p>本部分参考 <a href="https://www.stat.ncsu.edu/people/bloomfield/courses/st784/twa-05-1.pdf">https://www.stat.ncsu.edu/people/bloomfield/courses/st784/twa-05-1.pdf</a></p><p>注意到上述的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">t^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 统计量可以用于检验总体均值是否为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span>.</p><p>假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">i=1,\cdots,n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span> 为独立同分布来自于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N_p(\mu, \Sigma)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mclose">)</span></span></span></span>  的随机样本，我们要检验</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><mi>μ</mi><mo>=</mo><msub><mi>μ</mi><mn>0</mn></msub><mspace width="2em"/><mtext>vs.</mtext><mspace width="2em"/><msub><mi>H</mi><mn>1</mn></msub><mo>:</mo><mi>μ</mi><mo mathvariant="normal">≠</mo><msub><mi>μ</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">H_0: \mu=\mu_0\qquad \text{vs.} \qquad H_1:\mu\neq \mu_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:2em;"></span><span class="mord text"><span class="mord">vs.</span></span><span class="mspace" style="margin-right:2em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>我们可以使用似然比检验或者 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 检验，这两者是等价的。</p><h4 id="T-2-检验"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>T</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">T^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 检验</h4><p>统计量为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>t</mi><mn>2</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi>S</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>∼</mo><msup><mi>T</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t^2=(\bar x-\mu_0)&#x27;S^{-1}(\bar x-\mu_0) \sim T^2(p,n-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p><h4 id="似然比检验-（Likelihood-ratio-test）">似然比检验 （Likelihood ratio test）</h4><p>似然函数为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">Σ</mi><mi mathvariant="normal">∣</mi><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow></msup><mi>exp</mi><mo>⁡</mo><mo stretchy="false">{</mo><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mi>μ</mi><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi mathvariant="normal">Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mi>μ</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">L(\mu,\Sigma)=\prod_{i=1}^nf(x_i)=(2\pi|\Sigma|)^{-\frac{n}{2}}\exp\{-\frac{1}{2}\sum_{i=1}^n (x_i-\mu)&#x27;\Sigma^{-1}(x-\mu)\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord">∣Σ∣</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8971em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">exp</span><span class="mopen">{</span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">μ</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">μ</span><span class="mclose">)}</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Λ</mi><mo>=</mo><mfrac><mrow><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mi mathvariant="normal">Σ</mi></munder><mi>L</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo></mrow><mrow><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mi>μ</mi><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi></mrow></munder><mi>L</mi><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\Lambda=\frac{\max_{\Sigma}L(\mu_0,\Sigma)}{\max_{\mu,\Sigma}L(\mu,\Sigma)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Λ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3991em;vertical-align:-0.9721em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop">max</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">μ</span><span class="mpunct mtight">,</span><span class="mord mtight">Σ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop">max</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Σ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">H_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 成立的条件下， 对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(\mu_0,\Sigma)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mclose">)</span></span></span></span>, 有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi></msub><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">\hat \Sigma_{\omega}=\frac{1}{n}\sum_{i=1}^n(x_i-\mu_0)(x_i-\mu_0)&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0968em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>从而 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(\mu_0,\hat \Sigma_{\omega})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1968em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 的指数部分为(忽略常系数)</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>D</mi><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msubsup><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi mathvariant="normal">tr</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi mathvariant="normal">tr</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi mathvariant="normal">tr</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msubsup><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi mathvariant="normal">tr</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mi>n</mi><msup><mrow><mo fence="true">[</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo fence="true">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo fence="true">[</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo fence="true">]</mo></mrow><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi mathvariant="normal">tr</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mi>n</mi><msub><mi>I</mi><mi>p</mi></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>n</mi><mi>p</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}D=&amp;\sum_{i=1}^n(x_i-\mu_0)&#x27;\hat\Sigma^{-1}_{\omega}(x_i-\mu_0)\\=&amp;\operatorname{tr}(D)\\=&amp;\operatorname{tr}\left(\sum_{i=1}^n\hat\Sigma_{\omega}^{-1}(x_i-\mu_0)(x_i-\mu_0)&#x27;\right)\\=&amp;\operatorname{tr}\left(\hat\Sigma_{\omega}^{-1}\sum_{i=1}^n(x_i-\mu_0)(x_i-\mu_0)&#x27;\right)\\=&amp;\operatorname{tr}\left(n\left[\sum_{i=1}^n(x_i-\mu_0)(x_i-\mu_0)&#x27;\right]^{-1}\left[\sum_{i=1}^n(x_i-\mu_0)(x_i-\mu_0)&#x27;\right]\right)\\=&amp;\operatorname{tr}\left(nI_{p}\right)\\=&amp;np\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:18.2844em;vertical-align:-8.8922em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:9.3922em;"><span style="top:-11.7908em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span><span style="top:-9.3731em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-6.9631em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-3.6354em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-0.0078em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:2.6822em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:4.1822em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mrel">=</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:8.8922em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:9.3922em;"><span style="top:-11.7908em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-9.3731em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mord mathrm">tr</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span></span></span><span style="top:-6.9631em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mord mathrm">tr</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span><span style="top:-3.6354em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mord mathrm">tr</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span><span style="top:-0.0078em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mord mathrm">tr</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,-36,557 l0,84c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189l0,-92c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.954em;"><span style="top:-4.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,9c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558l0,-144c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span><span style="top:2.6822em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mord mathrm">tr</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:4.1822em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:8.8922em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>第二个等号是因为注意到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> 是一个数,所以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mi mathvariant="normal">tr</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D=\operatorname{tr}(D)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">tr</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span></span></span></span>，第三个等号是因为注意到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">tr(AB)</mi><mo>⁡</mo><mo>=</mo><mi mathvariant="normal">tr(BA)</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\operatorname{tr(AB)}=\operatorname{tr(BA)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">tr(AB)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">tr(BA)</span></span></span></span></span>, 对于任意的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo separator="true">,</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">A,B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> 矩阵成立（只要可以相乘），再令</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">A=(x_i-\mu_0)&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><msubsup><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B=\hat\Sigma^{-1}_{\omega}(x_i-\mu_0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1968em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.</p><p>因此</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi mathvariant="normal">∣</mi><msub><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi></msub><mi mathvariant="normal">∣</mi><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow></msup><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mfrac><mrow><mi>p</mi><mi>n</mi></mrow><mn>2</mn></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(\mu_0,\hat \Sigma_{\omega})=(2\pi|\hat\Sigma_{\omega}|)^{-\frac{n}{2}} \exp(-\frac{pn}{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1968em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord">∣</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8971em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">exp</span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p><p>同理， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(\mu,\Sigma)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Σ</span><span class="mclose">)</span></span></span></span>的参数估计为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>μ</mi><mo>^</mo></mover><mo>=</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\hat \mu=\bar x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">μ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5678em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span></span></span></span>,</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">\hat \Sigma=\frac{1}{n}\sum_{i=1}^n(x_i-\bar x)(x_i-\bar x)&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9468em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>并且</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo separator="true">,</mo><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi mathvariant="normal">∣</mi><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow></msup><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mfrac><mrow><mi>p</mi><mi>n</mi></mrow><mn>2</mn></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(\bar x,\hat \Sigma)=(2\pi|\hat\Sigma|)^{-\frac{n}{2}} \exp(-\frac{pn}{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1968em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mord">∣</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8971em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">exp</span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p><p>因而有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Λ</mi><mo>=</mo><mfrac><mrow><mi>L</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mi>L</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo separator="true">,</mo><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><msub><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi></msub><msup><mi mathvariant="normal">∣</mi><mrow><mo>−</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow></msup></mrow><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><msup><mi mathvariant="normal">∣</mi><mrow><mo>−</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow></msup></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><msup><mi mathvariant="normal">∣</mi><mfrac><mi>n</mi><mn>2</mn></mfrac></msup></mrow><mrow><mi mathvariant="normal">∣</mi><msub><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi></msub><msup><mi mathvariant="normal">∣</mi><mfrac><mi>n</mi><mn>2</mn></mfrac></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\Lambda=\frac{L(\mu_0,\hat\Sigma_{\omega})}{L(\bar x,\hat \Sigma)}=\frac{|\hat \Sigma_{\omega}|^{-\frac{n}{2}}}{|\hat \Sigma|^{-\frac{n}{2}}}=\frac{|\hat \Sigma|^{\frac{n}{2}}}{|\hat \Sigma_{\omega}|^{\frac{n}{2}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Λ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7105em;vertical-align:-1.0868em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6238em;"><span style="top:-2.1632em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.0868em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7105em;vertical-align:-1.0868em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6238em;"><span style="top:-2.1632em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8326em;"><span style="top:-3.3486em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8471em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.0868em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7105em;vertical-align:-1.0868em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6238em;"><span style="top:-2.1632em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8326em;"><span style="top:-3.3486em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8471em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.0868em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>从而，有（注意到我们丢掉了系数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac1n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>）</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi mathvariant="normal">Λ</mi><mfrac><mn>2</mn><mi>n</mi></mfrac></msup><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi mathvariant="normal">∣</mi></mrow><mrow><mi mathvariant="normal">∣</mi><msub><mover accent="true"><mi mathvariant="normal">Σ</mi><mo>^</mo></mover><mi>ω</mi></msub><mi mathvariant="normal">∣</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">∣</mi></mrow><mrow><mi mathvariant="normal">∣</mi><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\Lambda^{\frac{2}{n}}=\frac{|\hat \Sigma|}{|\hat\Sigma_{\omega}|}=\frac{|\sum_{i=1}^n(x_i-\bar x)(x_i-\bar x)&#x27;|}{|\sum_{i=1}^n(x_i-\mu_0)(x_i-\mu_0)&#x27;|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.004em;"></span><span class="mord"><span class="mord">Λ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7105em;vertical-align:-1.0868em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6238em;"><span style="top:-2.1632em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord">Σ</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.0868em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.488em;vertical-align:-0.994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.494em;"><span style="top:-2.3057em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>注意到</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>+</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>+</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><mi>n</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><mo>+</mo><mi>n</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><mrow><mo fence="true">[</mo><msub><mi>I</mi><mi>p</mi></msub><mo>+</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><msup><mo stretchy="false">]</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>n</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo fence="true">]</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}&amp;\sum_{i=1}^n(x_i-\mu_0)(x_i-\mu_0)&#x27;\\=&amp;\sum_{i=1}^n(x_i-\bar x+\bar x-\mu_0)(x_i-\bar x+\bar x-\mu_0)&#x27;\\=&amp; \sum_{i=1}^n(x_i-\bar x)(x_i-\bar x)&#x27;+n(\bar x-\mu_0)(\bar x-\mu_0)&#x27;\\=&amp;(n-1)S+n(\bar x-\mu_0)(\bar x-\mu_0)&#x27;\\=&amp;(n-1)S\left[I_p+[(n-1)S]^{-1}n(\bar x-\mu_0)(\bar x-\mu_0)&#x27;\right]\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:12.7113em;vertical-align:-6.1057em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.6057em;"><span style="top:-8.6057em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"></span></span><span style="top:-5.3766em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-2.1475em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:0.2701em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:1.7943em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mrel">=</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:6.1057em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.6057em;"><span style="top:-8.6057em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-5.3766em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.1475em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:0.2701em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mord"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:1.7943em;"><span class="pstrut" style="height:3.6514em;"></span><span class="mord"><span class="mord"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:6.1057em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>根据 <a href="https://en.wikipedia.org/wiki/Weinstein%E2%80%93Aronszajn_identity">Weinstein–Aronszajn identity</a>,</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">det</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>I</mi><mi>m</mi></msub><mo>+</mo><mi>A</mi><mi>B</mi><mo fence="true">)</mo></mrow><mo>=</mo><mi mathvariant="normal">det</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>I</mi><mi>n</mi></msub><mo>+</mo><mi>B</mi><mi>A</mi><mo fence="true">)</mo></mrow></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\operatorname{det}\left(I_{m}+A B\right)=\operatorname{det}\left(I_{n}+B A\right)\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mord mathrm">det</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop"><span class="mord mathrm">det</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">A</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p><p>这个等式的证明过程跟我们证明多元正态的条件分布时候对角化方差的过程基本一致。构造辅助矩阵</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>M</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>I</mi><mi>m</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>A</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>B</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>I</mi><mi>n</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}M=\left(\begin{array}{cc}I_{m} &amp; -A \\B &amp; I_{n}\end{array}\right)\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathnormal">A</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span></span></p><p>然后通过两种方式算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span> 的行列式，一种是把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> 所在位置化成0， 另一种是把  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> 所在位置化成0。</p><p>下面回到我们的证明，令 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><msup><mo stretchy="false">]</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>n</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A=[(n-1)S]^{-1}n(\bar x-\mu_0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">B=(\bar x-\mu_0)&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, 有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">∣</mi><msub><mi>I</mi><mi>p</mi></msub><mo>+</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><msup><mo stretchy="false">]</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>n</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">∣</mi><mo>=</mo><mi mathvariant="normal">∣</mi><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><msup><mo stretchy="false">]</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>n</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><mo>=</mo><mn>1</mn><mo>+</mo><mfrac><msup><mi>T</mi><mn>2</mn></msup><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">|I_p+[(n-1)S]^{-1}n(\bar x-\mu_0)(\bar x-\mu_0)&#x27;|=|1+(\bar x-\mu_0)&#x27;[(n-1)S]^{-1}n(\bar x-\mu_0)|=1+\frac{T^2}{(n-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">[(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4271em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>我们有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msup><mi mathvariant="normal">Λ</mi><mfrac><mn>2</mn><mi>n</mi></mfrac></msup><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mfrac><mrow><mi mathvariant="normal">∣</mi><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">∣</mi></mrow><mrow><mi mathvariant="normal">∣</mi><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mfrac><mrow><mi mathvariant="normal">∣</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><mi mathvariant="normal">∣</mi></mrow><mrow><mi mathvariant="normal">∣</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msub><mi>I</mi><mi>p</mi></msub><mo>+</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><msup><mo stretchy="false">]</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>n</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mfrac><mn>1</mn><mrow><mi mathvariant="normal">∣</mi><msub><mi>I</mi><mi>p</mi></msub><mo>+</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>S</mi><msup><mo stretchy="false">]</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>n</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mfrac><msup><mi>T</mi><mn>2</mn></msup><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mfrac></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\Lambda^{\frac{2}{n}}=&amp;\frac{|\sum_{i=1}^n(x_i-\bar x)(x_i-\bar x)&#x27;|}{|\sum_{i=1}^n(x_i-\mu_0)(x_i-\mu_0)&#x27;|}\\=&amp;\frac{|(n-1)S|}{|(n-1)S||I_p+[(n-1)S]^{-1}n(\bar x-\mu_0)(\bar x-\mu_0)&#x27;|}\\=&amp;\frac{1}{|I_p+[(n-1)S]^{-1}n(\bar x-\mu_0)(\bar x-\mu_0)&#x27;|}\\=&amp;\frac{1}{1+\frac{T^2}{(n-1)}}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:11.0285em;vertical-align:-5.2643em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.7643em;"><span style="top:-7.7643em;"><span class="pstrut" style="height:3.494em;"></span><span class="mord"><span class="mord"><span class="mord">Λ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span><span style="top:-5.0433em;"><span class="pstrut" style="height:3.494em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-2.4497em;"><span class="pstrut" style="height:3.494em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:0.1438em;"><span class="pstrut" style="height:3.494em;"></span><span class="mord"><span class="mrel">=</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.2643em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.7643em;"><span style="top:-7.7643em;"><span class="pstrut" style="height:3.494em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.494em;"><span style="top:-2.3057em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-5.0433em;"><span class="pstrut" style="height:3.494em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">∣∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.4497em;"><span class="pstrut" style="height:3.494em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:0.1438em;"><span class="pstrut" style="height:3.494em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.1936em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9164em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3264em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.2643em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>到这里，我们的结论就证明完了，这两种检验确实互相等价。整理一下，有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi mathvariant="normal">Λ</mi><mrow><mo>−</mo><mfrac><mn>2</mn><mi>n</mi></mfrac></mrow></msup><mo>=</mo><mn>1</mn><mo>+</mo><mfrac><msup><mi>T</mi><mn>2</mn></msup><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\Lambda^{-\frac{2}{n}}=1+\frac{T^2}{n-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.004em;"></span><span class="mord"><span class="mord">Λ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2604em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>]]></content>
    
    
    <categories>
      
      <category>统计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>多元统计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 vscode 上编写 Rnw 文档</title>
    <link href="/2021/09/28/rnw-on-vscode/"/>
    <url>/2021/09/28/rnw-on-vscode/</url>
    
    <content type="html"><![CDATA[<h1>引言</h1><p>最近要开始写时间序列的作业了，作业里面既有代码，又有公式，没法轻易用 LaTeX 搞定了，就回到以前用的 <code>R+knitr</code> ，写 <code>rnw</code> 了。以前是在 Rstudio 上面写，基本不用配置什么，但是 Rstudio 的 LaTeX 支持真的一般。现在切换到了 vscode, 用 LaTeX Workshop 写，还支持 <code>rnw</code> 跟 <code>jnw</code>。为了配置好 <code>rnw</code> 我真的踩了很多坑，到现在其实也还没有完全配置好。</p><h2 id="配置方案">配置方案</h2><p>以前写 LaTeX 的时候，我是特别喜欢用 magic comments 的，因为特别方便，只要在主文档开头加上</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-meta">%!TEX program=xelatex</span><br><span class="hljs-meta">%!BIB program=biber</span><br></code></pre></td></tr></table></figure><p>就能设置 <code>xelatex</code> 和 <code>biber</code>。但是，在 rnw 里面不能这么干，否则自动编译会出问题，因为默认情况下，在 没有 magic comments 的时候，自动构建<code>rnw</code> 会使用第一个含有 <code>rnw</code> 的 Recipe, 具体来说就是</p><p><code>Recipe: Compile Rnw files</code>，但是，<strong>有了 magic comments, 就会使用 magic comments 去构建！</strong></p><h3 id="例子">例子</h3><p>下面是一个例子，去掉首行，一切正常，但是带上它，你会发现 R 代码不会被自动编译。第一次手动编译一切正常，但是当你把 <code>2*x</code> 改成 <code>3*x</code> ，触发自动编译，结果 pdf 确实会刷新，但是pdf 里面还是 <code>2*x</code>。</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-meta">%!TEX program=xelatex</span><br><span class="hljs-keyword">\documentclass</span>&#123;article&#125;<br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br>&lt;&lt;&gt;&gt;=<br>x=c(1:5)<br>x<br>2*x<br>@<br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure><h2 id="配置">配置</h2><p>如果你的文档不需要中文，那当然直接把首行的 magic comments 删除就好啦。如果需要中文，这时候可以通过 <code>latexmk</code> 来实现，<code>latexmk</code>的文档可以通过 <code>texdoc latexmk</code> 来查看（如果你装了 texlive 的话）。</p><p>具体到我们的例子，我们需要一个 <code>.latexmkrc</code> 文件，与我们的 <code>rnw</code> 文件在同一目录下。但是 CTAN 给我们提供了一些模板 <code>latexmkrc</code>，可以下载 <a href="http://mirrors.ctan.org/support/latexmk/example_rcfiles/knitr-latexmkrc"><code>knitr-latexmkrc</code></a>，改名为 <code>.latexmkrc</code>，并修改它里面 <code>$pdflatex</code> 的定义：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-$pdflatex = &quot;pdflatex -interaction=nonstopmode -synctex=1 %O %B ;&quot;</span><br><span class="hljs-addition">+$pdflatex = &quot;xelatex -interaction=nonstopmode -synctex=1 %O %B ;&quot;</span><br></code></pre></td></tr></table></figure><p>其他的行不变。</p><p>另外，需要注意，此后我们的 <code>rnw</code> 文件需要把拓展名改为 <code>Rnw</code>，而不是 <code>rnw</code>。</p><p>之后就可以愉快的在 vscode 里面写 <code>rnw</code> 了。</p><h2 id="已知问题">已知问题</h2><p><code>rnw</code> 文件中，<code>R</code> 代码的格式化不可用，会全部左对齐，<strong>影响最后生成的 pdf</strong>。<code>R</code> 的代码补全也不可用。</p><p>不过可以使用 <code>R</code> 的 <code>styler</code> 包来手动格式化。</p><h2 id="参考资料">参考资料</h2><ol><li><p><a href="https://github.com/James-Yu/LaTeX-Workshop/issues/2880">AutoBuild for rnw not working with <code>%!TEX program=xelatex</code></a></p></li><li><p><a href="https://tex.stackexchange.com/questions/27450/how-to-make-latexmk-work-with-xelatex-and-biber">How to make LaTeXmk work with XeLaTeX and biber</a></p></li><li><p><a href="https://ctan.org/tex-archive/support/latexmk">latexmk documentation</a></p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>knitr</tag>
      
      <tag>R</tag>
      
      <tag>vscode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 Steam pronton 游戏中无法输入中文</title>
    <link href="/2021/09/06/proton-CJK/"/>
    <url>/2021/09/06/proton-CJK/</url>
    
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>我在linux 上用 steam 通过 proton 打游戏时，游戏内无法输入中文，经过寻找，找到了这篇文章，做一个备份。</p><h2 id="解决方案">解决方案</h2><ol><li><p>在 steam 库中找到要输入中文的游戏，右键<strong>属性</strong>找到<strong>启动选项</strong>，</p></li><li><p>添加如下命令 <code>PROTON_DUMP_DEBUG_COMMANDS=1 %command%</code></p></li><li><p>运行游戏，然后退出。</p></li><li><p>在 <code>/tmp</code> 找到类似于如下的文件夹：<code>/tmp/proton_usuario$</code></p></li><li><p>在该文件夹下，运行 ：<code>./run regedit</code></p></li><li><p>找到 <code>HKEY_CURRENT_USER\Software\Wine</code></p></li><li><p>右键选择 <code>new &gt; key</code>, 命名为 <code>X11 Driver</code></p></li><li><p>右键刚刚建好的 <code>X11 Driver</code>， 选择 <code>new &gt; string value</code>, 名称为 <code>UseXIM</code>,值为 <code>y</code>. 可见图 <img src="https://bu.dusays.com/2022/04/16/0fa5edeb8de2a.png" alt=""></p></li><li><p>现在可以移除游戏的 <code>PROTON_DUMP_DEBUG_COMMANDS=1 %command%</code> 启动选项，</p></li><li><p>下次重启系统后，这个文件夹会消失，因为 <code>/tmp</code> 是<code>tmpfs</code>.</p></li></ol><h2 id="参考资料">参考资料</h2><p>1.<a href="https://github.com/ValveSoftware/Proton/issues/3791#issuecomment-670811393">Unable to type letters with accents in any game that runs with Proton</a></p>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>steam</tag>
      
      <tag>fcitx5</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 ArchLinux 服务器上搭建 sub-web</title>
    <link href="/2021/04/09/sub-web-on-archlinux/"/>
    <url>/2021/04/09/sub-web-on-archlinux/</url>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/CareyWang/sub-web">sub-web</a> 是一个基于 vue-cli 与 <a href="https://github.com/tindy2013/subconverter">tindy2013/subconverter</a> 后端实现的配置自动生成工具。我以前一直用的别人搭建的网站进行转换，但是总觉得不安全，因此今天心血来潮想要自己搭建一个 sub-web 来进行 clash 订阅链接转换。</p><h1>构建 sub-web</h1><p>根据 Github 上的说明，我们只需要把仓库克隆下来，然后安装依赖，再 build 就行了。</p><p>先克隆仓库到本地并进入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/CareyWang/sub-web.git/<br><span class="hljs-built_in">cd</span> sub-web/<br></code></pre></td></tr></table></figure><p>安装依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yarn install<br></code></pre></td></tr></table></figure><p>结果突然就报错了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">error /home/sukanka/Downloads/sub-web/node_modules/node-sass: Command failed.<br>Exit code: 1<br>Command: node scripts/build.js<br>Arguments: <br>Directory: /home/sukanka/Downloads/sub-web/node_modules/node-sass<br>Output:<br>Building: /usr/bin/node /home/sukanka/Downloads/sub-web/node_modules/node-gyp/bin/node-gyp.js rebuild --verbose --libsass_ext= --libsass_cflags= --libsass_ldflags= --libsass_library=<br>gyp info it worked <span class="hljs-keyword">if</span> it ends with ok<br>gyp verb cli [<br>gyp verb cli   <span class="hljs-string">&#x27;/usr/bin/node&#x27;</span>,<br>gyp verb cli   <span class="hljs-string">&#x27;/home/sukanka/Downloads/sub-web/node_modules/node-gyp/bin/node-gyp.js&#x27;</span>,<br>gyp verb cli   <span class="hljs-string">&#x27;rebuild&#x27;</span>,<br>gyp verb cli   <span class="hljs-string">&#x27;--verbose&#x27;</span>,<br>gyp verb cli   <span class="hljs-string">&#x27;--libsass_ext=&#x27;</span>,<br>gyp verb cli   <span class="hljs-string">&#x27;--libsass_cflags=&#x27;</span>,<br>gyp verb cli   <span class="hljs-string">&#x27;--libsass_ldflags=&#x27;</span>,<br>gyp verb cli   <span class="hljs-string">&#x27;--libsass_library=&#x27;</span><br>gyp verb cli ]<br>gyp info using node-gyp@3.8.0<br>gyp info using node@15.14.0 | linux | x64<br>gyp verb <span class="hljs-built_in">command</span> rebuild []<br>gyp verb <span class="hljs-built_in">command</span> clean []<br>gyp verb clean removing <span class="hljs-string">&quot;build&quot;</span> directory<br>gyp verb <span class="hljs-built_in">command</span> configure []<br>gyp verb check python checking <span class="hljs-keyword">for</span> Python executable <span class="hljs-string">&quot;python2&quot;</span> <span class="hljs-keyword">in</span> the PATH<br>gyp verb `<span class="hljs-built_in">which</span>` failed Error: not found: python2<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at getNotFoundError (/home/sukanka/Downloads/sub-web/node_modules/which/which.js:13:12)<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at F (/home/sukanka/Downloads/sub-web/node_modules/which/which.js:68:19)<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at E (/home/sukanka/Downloads/sub-web/node_modules/which/which.js:80:29)<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at /home/sukanka/Downloads/sub-web/node_modules/which/which.js:89:16<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at /home/sukanka/Downloads/sub-web/node_modules/isexe/index.js:42:5<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at /home/sukanka/Downloads/sub-web/node_modules/isexe/mode.js:8:5<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at FSReqCallback.oncomplete (node:fs:193:21)<br>gyp verb `<span class="hljs-built_in">which</span>` failed  python2 Error: not found: python2<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at getNotFoundError (/home/sukanka/Downloads/sub-web/node_modules/which/which.js:13:12)<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at F (/home/sukanka/Downloads/sub-web/node_modules/which/which.js:68:19)<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at E (/home/sukanka/Downloads/sub-web/node_modules/which/which.js:80:29)<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at /home/sukanka/Downloads/sub-web/node_modules/which/which.js:89:16<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at /home/sukanka/Downloads/sub-web/node_modules/isexe/index.js:42:5<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at /home/sukanka/Downloads/sub-web/node_modules/isexe/mode.js:8:5<br>gyp verb `<span class="hljs-built_in">which</span>` failed     at FSReqCallback.oncomplete (node:fs:193:21) &#123;<br>gyp verb `<span class="hljs-built_in">which</span>` failed   code: <span class="hljs-string">&#x27;ENOENT&#x27;</span><br>gyp verb `<span class="hljs-built_in">which</span>` failed &#125;<br>gyp verb check python checking <span class="hljs-keyword">for</span> Python executable <span class="hljs-string">&quot;python&quot;</span> <span class="hljs-keyword">in</span> the PATH<br>gyp verb `<span class="hljs-built_in">which</span>` succeeded python /usr/bin/python<br>gyp ERR! configure error <br>gyp ERR! stack Error: Command failed: /usr/bin/python -c import sys; <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;%s.%s.%s&quot;</span> % sys.version_info[:3];<br>gyp ERR! stack   File <span class="hljs-string">&quot;&lt;string&gt;&quot;</span>, line 1<br>gyp ERR! stack     import sys; <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;%s.%s.%s&quot;</span> % sys.version_info[:3];<br>gyp ERR! stack                       ^<br>gyp ERR! stack SyntaxError: invalid syntax<br>gyp ERR! stack <br>gyp ERR! stack     at ChildProcess.exithandler (node:child_process:326:12)<br>gyp ERR! stack     at ChildProcess.emit (node:events:369:20)<br>gyp ERR! stack     at maybeClose (node:internal/child_process:1067:16)<br>gyp ERR! stack     at Process.ChildProcess._handle.onexit (node:internal/child_process:301:5)<br>gyp ERR! System Linux 5.11.11-arch1-1<br>gyp ERR! <span class="hljs-built_in">command</span> <span class="hljs-string">&quot;/usr/bin/node&quot;</span> <span class="hljs-string">&quot;/home/sukanka/Downloads/sub-web/node_modules/node-gyp/bin/node-gyp.js&quot;</span> <span class="hljs-string">&quot;rebuild&quot;</span> <span class="hljs-string">&quot;--verbose&quot;</span> <span class="hljs-string">&quot;--libsass_ext=&quot;</span> <span class="hljs-string">&quot;--libsass_cflags=&quot;</span> <span class="hljs-string">&quot;--libsass_ldflags=&quot;</span> <span class="hljs-string">&quot;--libsass_library=&quot;</span><br>gyp ERR! cwd /home/sukanka/Downloads/sub-web/node_modules/node-sass<br>gyp ERR! node -v v15.14.0<br></code></pre></td></tr></table></figure><p>挺突然的，不过看日志好像和 <code>node-sass</code> 和 <code>python2</code> 有关。可以尝试安装 <code>python2</code> (经尝试确实可以，但是很慢)。但是既然 Arch 都默认 <code>python3</code> 了，我们肯定不能再装回 <code>python2</code>，那就在 <code>node-sass</code> 上找原因。</p><p>找到 <code>node-sass</code> 的<a href="https://www.npmjs.com/package/node-sass">主页</a>，发现最新版已经是 <code>5.0.0</code> 了，但是依赖的是 <code>4.13.0</code>。直接在 <code>package.json</code> 中进行修改</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-- &quot;node-sass&quot;: &quot;^4.13.0&quot;,</span><br><span class="hljs-addition">++ &quot;node-sass&quot;: &quot;^5.0.0&quot;,</span><br></code></pre></td></tr></table></figure><p>然后删除 <code>node_modules</code>,重新进行 <code>yarn install</code> 就没问题了。</p><p>然后就可以运行 <code>yarn build</code> 来构建用于线上环境的版本了。</p><p>我将 <code>build/dist</code> 中的文件全部上传到 <code>/var/www/sub-web/</code>中，按照 github 上的说明就配置好了前端。</p><h1>配置后端</h1><p>首先安装 <code>subconverter-bin</code></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">yay -S subconverter-bin</span><br></code></pre></td></tr></table></figure><p>但是这个包不带 <code>systemd</code> 服务，我们自己写一个服务,往 <code>/etc/systemd/system/subconverter.service</code> 写入如下内容：</p><p><strong>记得把 <code>YOUR_USER</code> 改成你的用户名。</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Sub Converter<br><span class="hljs-attr">StartLimitIntervalSec</span>=<span class="hljs-number">0</span><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=simple<br><span class="hljs-attr">Restart</span>=always<br><span class="hljs-attr">RestartSec</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">User</span>=YOUR_USER <br><span class="hljs-attr">ExecStart</span>=/usr/bin/subconverter<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p>然后运行如下命令以启动（并开机自启）服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl daemon-reload<br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now subconverter.service<br></code></pre></td></tr></table></figure><h2 id="配置域名">配置域名</h2><p>按照 <a href="https://github.com/CareyWang/sub-web">github 上的说明</a>可以配置好前端，但是我们还需要配置后端。我是这样写的</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">server_name</span> sub.example.com; <span class="hljs-comment"># 注意替换域名</span><br><br>    <span class="hljs-attribute">root</span> /var/www/sub-web/;<br>    <span class="hljs-attribute">index</span> index.html index.htm;<br><br>    <span class="hljs-attribute">error_page</span> <span class="hljs-number">404</span> /index.html;<br><br>    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>; <span class="hljs-comment">#开启gzip压缩</span><br>    <span class="hljs-attribute">gzip_min_length</span> <span class="hljs-number">1k</span>; <span class="hljs-comment">#设置对数据启用压缩的最少字节数</span><br>    <span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">4</span> <span class="hljs-number">16k</span>;<br>    <span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>; <span class="hljs-comment">#设置数据的压缩等级,等级为1-9，压缩比从小到大</span><br>    <span class="hljs-attribute">gzip_types</span> text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml; <span class="hljs-comment">#设置需要压缩的数据格式</span><br>    <span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;<br><br><span class="hljs-comment"># 这里是代理到后端端口</span><br>    <span class="hljs-section">location</span> /sub &#123;<br>    <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> Upgrade         <span class="hljs-variable">$http_upgrade</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> Connection      <span class="hljs-string">&quot;Upgrade&quot;</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> Host            <span class="hljs-variable">$http_host</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Real-IP       <span class="hljs-variable">$remote_addr</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Forward-For   <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Forward-Proto <span class="hljs-variable">$scheme</span>;<br>    <span class="hljs-attribute">proxy_redirect</span> <span class="hljs-literal">off</span>;<br>    <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:25500;<br><br>    &#125;<br>    <span class="hljs-section">location</span> <span class="hljs-regexp">~* \.(css|js|png|jpg|jpeg|gif|gz|svg|mp4|ogg|ogv|webm|htc|xml|woff)$</span> &#123;<br>        <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;<br>        <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&quot;public,max-age=30*24*3600&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/sub.sukanka.com/fullchain.pem; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/sub.sukanka.com/privkey.pem; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="hljs-comment"># managed by Certbot</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>其中， <code>https</code> 是用 <code>certbot</code> 自动管理的， 具体参见 <a href="https://wiki.archlinux.org/index.php/Certbot">ArchWiki-Certbot</a>。</p><p>至此，我们就配置好了前端和后端，可以正常使用了，但是我发现生成的链接特别长（需要配置短链），同时，规则特别少，不如别人的舒服（需要配置 远程配置）。</p><h1>短链</h1><p>基于 <a href="https://github.com/CareyWang/MyUrls">MyUrls</a>， 参考 <a href="https://agwa5783.gitbook.io/sub-web/kuo-zhan-yi-myurls-duan-lian-fu-wu-da-jian/untitled">MyUrls 短链服务部署</a>。先空着。</p><h1>远程配置</h1><p>暂时没搞明白，先放着，参考 <a href="https://github.com/ACL4SSR/ACL4SSR/tree/master">ACL4SSR</a>，与 <a href="https://www.v2rayssr.com/sub-web.html">https://www.v2rayssr.com/sub-web.html</a></p>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>archlinux</tag>
      
      <tag>clash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>高级微观总结：从支出函数到效用函数</title>
    <link href="/2021/01/07/adv-micro/"/>
    <url>/2021/01/07/adv-micro/</url>
    
    <content type="html"><![CDATA[<p>这学期在学高级微观经济学，学了如何由效用函数出发得到支出函数，但一直不会反过来计算。直到期末考试复习的时候看到了如何由成本函数推导生产函数。</p><h1>从成本函数到生产函数</h1><p>假设有生产函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="bold">x</mi><mo>∈</mo><msubsup><mi mathvariant="double-struck">R</mi><mo>+</mo><mi>n</mi></msubsup></mrow><annotation encoding="application/x-tex">f(\mathbf{x}),\mathbf{x}\in \mathbb{R}^n_+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathbf">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9942em;vertical-align:-0.3053em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3053em;"><span></span></span></span></span></span></span></span></span></span>,要素价格是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">w</mi><mo>∈</mo><msubsup><mi mathvariant="double-struck">R</mi><mo>+</mo><mi>n</mi></msubsup><mo separator="true">,</mo><mi mathvariant="double-struck">w</mi><mo>≫</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\mathbf{w}\in \mathbb{R}^n_+, \mathbb{w}\gg 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9942em;vertical-align:-0.3053em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3053em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≫</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>, 要求成本函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(\mathbf{w}, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>, 是如下求解</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>max</mi><mo>⁡</mo><mi>C</mi><mo stretchy="false">(</mo><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi mathvariant="bold">w</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="bold">x</mi><mspace linebreak="newline"></mspace><mi>s</mi><mi mathvariant="normal">.</mi><mi>t</mi><mi mathvariant="normal">.</mi><mspace width="1em"/><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo>≥</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">\max C(\mathbf{w}, y)=\mathbf{w}&#x27; \mathbf{x}\\s.t. \quad f(\mathbf{x}) \geq y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathbf">x</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord">.</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathbf">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></p><p>反过来，假设我们已经有成本函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(\mathbf{w}, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> 了，要求生产函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(\mathbf{x})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathbf">x</span><span class="mclose">)</span></span></span></span>, 按如下步骤进行：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo>≡</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>q</mi><mo>≥</mo><mn>0</mn><mo>∣</mo><mi mathvariant="bold">w</mi><mo>⋅</mo><mi mathvariant="bold">x</mi><mo>≥</mo><mi>c</mi><mo stretchy="false">(</mo><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="normal">∀</mi><mi mathvariant="bold">w</mi><mo>≫</mo><mn>0</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">f(\mathbf{x}) \equiv \max \{q \geq 0 \mid \mathbf{w} \cdot \mathbf{x} \geq c(\mathbf{w}, q), \forall \mathbf{w} \gg 0\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathbf">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">(</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∀</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≫</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">}</span></span></span></span></span></p><ol><li><p>计算生产可行性集合 PPS,</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold">Y</mi><mrow><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi mathvariant="bold">x</mi></mrow></msub><mo>≡</mo><mo stretchy="false">{</mo><mi>q</mi><mo>:</mo><mi>c</mi><mo stretchy="false">(</mo><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo><mo>≤</mo><mi mathvariant="bold">w</mi><mo>⋅</mo><mi mathvariant="bold">x</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathbf{Y}_{\mathbf{w}, \mathbf{x}} \equiv\{q: c(\mathbf{w}, q) \leq \mathbf{w} \cdot \mathbf{x}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9722em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.02875em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1611em;"><span style="top:-2.55em;margin-left:-0.0288em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="mpunct mtight">,</span><span class="mord mathbf mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">(</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbf">x</span><span class="mclose">}</span></span></span></span></span></p></li><li><p>计算所有生产可能性集合的交集（关于价格 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">w</mi></mrow><annotation encoding="application/x-tex">\mathrm{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">w</span></span></span></span> 取交集）</p></li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold">Y</mi><mi mathvariant="bold">x</mi></msub><mo>≡</mo><munder><mo>⋂</mo><mi mathvariant="bold">w</mi></munder><msub><mi mathvariant="bold">Y</mi><mrow><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi mathvariant="bold">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{Y}_{\mathbf{x}} \equiv \bigcap_{\mathbf{w}} \mathbf{Y}_{\mathbf{w}, \mathbf{x}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8361em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.02875em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1611em;"><span style="top:-2.55em;margin-left:-0.0288em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3em;vertical-align:-1.25em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.9em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">⋂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.02875em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1611em;"><span style="top:-2.55em;margin-left:-0.0288em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight" style="margin-right:0.01597em;">w</span><span class="mpunct mtight">,</span><span class="mord mathbf mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><ol start="3"><li>找到其中最大的元素<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>q</mi><mo>=</mo><mi>max</mi><mo>⁡</mo><msub><mi mathvariant="bold">Y</mi><mi mathvariant="bold">x</mi></msub></mrow><annotation encoding="application/x-tex">f(\mathbf{x})=q=\max \mathbf{Y}_{\mathbf{x}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathbf">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8361em;vertical-align:-0.15em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.02875em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1611em;"><span style="top:-2.55em;margin-left:-0.0288em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p></li></ol><p>这样我们就从成本函数推导出了生产函数。</p><h1>从支出函数到效用函数</h1><p>从效用函数到支出函数很容易，从支出函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo stretchy="false">(</mo><mi mathvariant="bold">p</mi><mo separator="true">,</mo><mi>u</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e(\mathbf{p},u)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathbf">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span></span></span></span> 到效用函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">u(\mathbf{x})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mopen">(</span><span class="mord mathbf">x</span><span class="mclose">)</span></span></span></span> 的过程就和上述过程差不多，具体如下</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo>≡</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>v</mi><mo>≥</mo><mn>0</mn><mi mathvariant="normal">∣</mi><msup><mi mathvariant="bold">p</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="bold">x</mi><mo>≥</mo><mi>e</mi><mo stretchy="false">(</mo><mi mathvariant="bold">p</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">u({\bf x})\equiv \max \{v\geq 0| {\bf p}&#x27;{\bf x} \geq  e(\mathbf{p},v)\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord">0∣</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathbf">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)}</span></span></span></span></span></p><ol><li>计算可行的集合</li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold">U</mi><mrow><mi mathvariant="bold">p</mi><mo separator="true">,</mo><mi mathvariant="bold">x</mi></mrow></msub><mo>=</mo><mo stretchy="false">{</mo><mi>v</mi><mi mathvariant="normal">∣</mi><mrow><msup><mi mathvariant="bold">p</mi><mo mathvariant="bold" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="bold">x</mi></mrow><mo>≥</mo><mi>e</mi><mo stretchy="false">(</mo><mi mathvariant="bold">p</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">{\bf U_{p,x}}=\{v|{\bf p &#x27;x} \geq  e(\mathbf{p},v) \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9722em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1611em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">p</span><span class="mpunct mtight">,</span><span class="mord mathbf mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord">∣</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathbf">x</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathbf">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)}</span></span></span></span></span></p><ol start="2"><li><p>计算所有可能性集合的交集 （关于价格 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">p</mi></mrow><annotation encoding="application/x-tex">\mathbf{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.1944em;"></span><span class="mord mathbf">p</span></span></span></span> 取交集）</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold">U</mi><mi mathvariant="bold">x</mi></msub><mo>=</mo><munder><mo>⋂</mo><mi mathvariant="bold">p</mi></munder><msub><mi mathvariant="bold">U</mi><mrow><mi mathvariant="bold">p</mi><mo separator="true">,</mo><mi mathvariant="bold">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">{\bf U_x}=\bigcap_{\mathbf{p}} {\bf U_{p,x}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8361em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1611em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4361em;vertical-align:-1.3861em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.9em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">p</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">⋂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3861em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1611em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">p</span><span class="mpunct mtight">,</span><span class="mord mathbf mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></p></li><li><p>找到其中最大的元素</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>max</mi><mo>⁡</mo><msub><mi mathvariant="bold">U</mi><mi mathvariant="bold">x</mi></msub></mrow><annotation encoding="application/x-tex">u(\mathbf{x})=\max {\bf U_x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mopen">(</span><span class="mord mathbf">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8361em;vertical-align:-0.15em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1611em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></p></li></ol><h2 id="例子">例子</h2><p>例子来源于 JR 5.16, 题目如下：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mo stretchy="false">(</mo><mi mathvariant="bold">p</mi><mo separator="true">,</mo><mi>u</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.16em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac><mrow><mo fence="true">(</mo><msub><mi>p</mi><mn>1</mn></msub><mo>+</mo><msub><mi>p</mi><mn>2</mn></msub><mo fence="true">)</mo></mrow><mi>u</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> for </mtext><msub><mi>p</mi><mn>2</mn></msub><mi mathvariant="normal">/</mi><mn>2</mn><mo>&lt;</mo><msub><mi>p</mi><mn>1</mn></msub><mo>&lt;</mo><mn>2</mn><msub><mi>p</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>u</mi><msub><mi>p</mi><mn>2</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> for </mtext><msub><mi>p</mi><mn>1</mn></msub><mo>≥</mo><mn>2</mn><msub><mi>p</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>u</mi><msub><mi>p</mi><mn>1</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> for </mtext><msub><mi>p</mi><mn>1</mn></msub><mo>≤</mo><msub><mi>p</mi><mn>2</mn></msub><mi mathvariant="normal">/</mi><mn>2</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">e(\mathbf{p}, u)=\left\{\begin{array}{ll}\frac{1}{3}\left(p_{1}+p_{2}\right) u &amp; \text { for } p_{2} / 2&lt;p_{1}&lt;2 p_{2} \\u p_{2} &amp; \text { for } p_{1} \geq 2 p_{2} \\u p_{1} &amp; \text { for } p_{1} \leq p_{2} / 2\end{array}\right.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathbf">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6051em;vertical-align:-1.5526em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.5em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-2.492em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.016em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="0.016em" style="width:0.8889em" viewBox="0 0 888.89 16" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V16 H384z M384 0 H504 V16 H384z"/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.016em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="0.016em" style="width:0.8889em" viewBox="0 0 888.89 16" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V16 H384z M384 0 H504 V16 H384z"/></svg></span></span><span style="top:-4.3em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0526em;"><span style="top:-4.2074em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span></span></span><span style="top:-3.0074em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.8074em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.5526em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0526em;"><span style="top:-4.2074em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord"> for </span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.0074em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord"> for </span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.8074em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord"> for </span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.5526em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>这里的支出函数是分段的，就很不好看出效用函数。我们按照上面的方法，再进行分类讨论。</p><ol><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>2</mn></msub><mi mathvariant="normal">/</mi><mn>2</mn><mo>&lt;</mo><msub><mi>p</mi><mn>1</mn></msub><mo>&lt;</mo><mn>2</mn><msub><mi>p</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">p_{2} / 2&lt;p_{1}&lt;2 p_{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 时，我们有</li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mo stretchy="false">(</mo><mi mathvariant="bold">p</mi><mo separator="true">,</mo><mi>u</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mo stretchy="false">(</mo><msub><mi>p</mi><mn>1</mn></msub><mo>+</mo><msub><mi>p</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mi>u</mi><mo>≤</mo><msub><mi>p</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>p</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">e(\mathbf{p}, u)=\frac{1}{3}(p_1+p_2)u \leq p_1x_1+p_2x_2.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathbf">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span></p><p>也就是</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><mfrac><mrow><mn>3</mn><mo stretchy="false">(</mo><msub><mi>p</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>p</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><mrow><msub><mi>p</mi><mn>1</mn></msub><mo>+</mo><msub><mi>p</mi><mn>2</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">u\leq \frac{3(p_1x_1+p_2x_2)}{p_1+p_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3074em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>令 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><msub><mi>p</mi><mn>1</mn></msub><mi mathvariant="normal">/</mi><msub><mi>p</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">t=p_1/p_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, 则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\frac12 \leq t \leq 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>, 从而</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><mfrac><mrow><mn>3</mn><mo stretchy="false">(</mo><mi>t</mi><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mn>3</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mfrac><mrow><mn>3</mn><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo separator="true">,</mo><mspace width="1em"/><mi mathvariant="normal">∀</mi><mi>t</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0.5</mn><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">u\leq \frac{3(tx_1+x_2)}{t+1}=3x_1+\frac{3(x_2-x_1)}{t+1}, \quad \forall t \in [0.5,2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">3</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∀</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mclose">]</span></span></span></span></span></p><ul><li>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x_2-x_1&gt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 时，有</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><mn>3</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mn>2</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">u \leq 3x_1+x_2-x_1=2x_1+x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">3</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x_2-x_1&lt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>时，有<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><mn>3</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mn>2</mn><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mn>2</mn><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">u\leq 3x_1+2(x_2-x_1)=x_1+2x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">3</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>综合上述两种情况，有<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">u\leq x_1+x_2+\min\{x_1,x_2\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span></p></li></ul><ol start="2"><li><p>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub><mo>&gt;</mo><mn>2</mn><msub><mi>p</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">p_1&gt;2p_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 时， 有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><msub><mi>p</mi><mn>2</mn></msub><mo>≤</mo><msub><mi>p</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>p</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">up_2 \leq p_1x_1+p_2x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>也就是</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><mfrac><msub><mi>p</mi><mn>1</mn></msub><msub><mi>p</mi><mn>2</mn></msub></mfrac><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mspace width="1em"/><mi mathvariant="normal">∀</mi><mfrac><msub><mi>p</mi><mn>1</mn></msub><msub><mi>p</mi><mn>2</mn></msub></mfrac><mo>&gt;</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">u \leq \frac{p_1}{p_2}x_1+x_2,\quad  \forall \frac{p_1}{p_2}&gt;2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.988em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.988em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∀</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span></p><p>从而，对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">p</mi></mrow><annotation encoding="application/x-tex">\mathbf{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.1944em;"></span><span class="mord mathbf">p</span></span></span></span>取交集下确界之后有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><mn>2</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">u \leq 2x_1+x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p></li><li><p>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>p</mi><mn>2</mn></msub><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">p_1&lt;p_2/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/2</span></span></span></span> 时，有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><msub><mi>p</mi><mn>1</mn></msub><mo>≤</mo><msub><mi>p</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>p</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">up_1\leq p_1x_1+p_2x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>从而</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mfrac><msub><mi>p</mi><mn>2</mn></msub><msub><mi>p</mi><mn>1</mn></msub></mfrac><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mspace width="1em"/><mi mathvariant="normal">∀</mi><mfrac><msub><mi>p</mi><mn>1</mn></msub><msub><mi>p</mi><mn>2</mn></msub></mfrac><mo>&lt;</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">u \leq x_1+\frac{p_2}{p_1}x_2,\quad  \forall \frac{p_1}{p_2}&lt;\frac12.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.988em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∀</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span></span></span></span></span></p><p>因此，</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mn>2</mn><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">u\leq x_1+2x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p></li></ol><p>综合1，2与3， 有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo>≤</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">u \leq x_1+x_2+\min\{x_1, x_2\}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mord">.</span></span></span></span></span></p><p>再取最大值，有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>u</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">}</mo><mo>=</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">}</mo><mo>+</mo><mn>2</mn><mi>min</mi><mo>⁡</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">u(\mathbf{x})=x_1+x_2+\min\{x_1, x_2\}=\max\{x_1,x_2\}+2\min\{x_1,x_2\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mopen">(</span><span class="mord mathbf">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span></p><p>聪明的你，是否学会了呢？</p>]]></content>
    
    
    <categories>
      
      <category>经济学</category>
      
    </categories>
    
    
    <tags>
      
      <tag>高级微观经济学</tag>
      
      <tag>效用函数</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>fix-kdeconnect</title>
    <link href="/2020/10/23/fix-kdeconnect/"/>
    <url>/2020/10/23/fix-kdeconnect/</url>
    
    <content type="html"><![CDATA[<p>本文记录了使用 <code>cgproxy</code> 配合 <code>qv2ray</code> 进行透明代理时导致的 <code>kdeconnect</code> 无法传输文件的问题的解决方案。</p><h1>系统信息</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">OS:</span> <span class="hljs-string">Arch</span> <span class="hljs-string">Linux</span> <span class="hljs-string">x86_64</span> <br><span class="hljs-attr">Host:</span> <span class="hljs-string">TUF</span> <span class="hljs-string">Gaming</span> <span class="hljs-string">FA506IV_FA506IV</span> <span class="hljs-number">1.0</span> <br><span class="hljs-attr">Kernel:</span> <span class="hljs-number">5.9</span><span class="hljs-number">.1</span><span class="hljs-string">-arch1-1</span> <br><span class="hljs-attr">Uptime:</span> <span class="hljs-number">3</span> <span class="hljs-string">hours,</span> <span class="hljs-number">51</span> <span class="hljs-string">mins</span> <br><span class="hljs-attr">Packages:</span> <span class="hljs-number">1372</span> <span class="hljs-string">(pacman)</span> <br><span class="hljs-attr">Shell:</span> <span class="hljs-string">zsh</span> <span class="hljs-number">5.8</span> <br><span class="hljs-attr">Resolution:</span> <span class="hljs-string">1920x1080</span> <br><span class="hljs-attr">DE:</span> <span class="hljs-string">Plasma</span> <br><span class="hljs-attr">WM:</span> <span class="hljs-string">KWin</span> <br><span class="hljs-attr">WM Theme:</span> <span class="hljs-string">Breeze</span> <br><span class="hljs-attr">Theme:</span> <span class="hljs-string">Breeze</span> [<span class="hljs-string">Plasma</span>]<span class="hljs-string">,</span> <span class="hljs-string">Breeze</span> [<span class="hljs-string">GTK2/3</span>] <br><span class="hljs-attr">Icons:</span> [<span class="hljs-string">Plasma</span>]<span class="hljs-string">,</span> <span class="hljs-string">breeze</span> [<span class="hljs-string">GTK2/3</span>] <br><span class="hljs-attr">Terminal:</span> <span class="hljs-string">yakuake</span> <br><span class="hljs-attr">CPU:</span> <span class="hljs-string">AMD</span> <span class="hljs-string">Ryzen</span> <span class="hljs-number">7</span> <span class="hljs-string">4800H</span> <span class="hljs-string">with</span> <span class="hljs-string">Radeon</span> <span class="hljs-string">Graphics</span> <span class="hljs-string">(16)</span> <span class="hljs-string">@</span> <span class="hljs-number">2.</span><span class="hljs-string">900GHz</span> <br><span class="hljs-attr">GPU:</span> <span class="hljs-string">AMD</span> <span class="hljs-string">ATI</span> <span class="hljs-number">06</span><span class="hljs-string">:00.0</span> <span class="hljs-string">Renoir</span> <br></code></pre></td></tr></table></figure><p>qv2ray 版本： 2.6.3:5841<br>cgproxy 版本：cgproxy-git v0.19.r3.gaaa628a-1</p><h1>具体描述</h1><p>使用手机的 kdeconnect 传文件给电脑时，进度一直是0，传输速度大概在 10B/s 左右。剪贴板，媒体控制正常。</p><p><img src="https://bu.dusays.com/2022/04/16/56ba0cc76135f.png" alt="image"></p><p>关闭 <code>cgproxy.service</code> 后 <code>kdeconnect</code> 传输文件正常。尝试过将</p><p><code>kdeconnect-app kdeconnect-cli kdeconnect-handler kdeconnect-indicator kdeconnect-settings kdeconnect-sms kdecp5</code></p><p>全部加入到 <code>program_noproxy</code> 里面，重启 <code>cgproxy</code>, 仍然无法传输文件。</p><p>也尝试过将上图的 <code>kdeconnectd</code> 加入到<code>program_noproxy</code>里面， 仍然无效， 也尝试过以 <code>cgnoproxy kdeconnect</code> 运行，发现仍然无效。</p><p>在提交 issue 的前一刻，我想到了路径的问题， 所以尝试了  <code>/usr/lib/kdeconnectd</code>， 结果成功了。</p><p>顺便，我把 aria2 也添加到不走代理了，免得跑完流量</p><h1>配置文件</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;comment&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;For usage, see https://github.com/springzfx/cgproxy&quot;</span><span class="hljs-punctuation">,</span><br><br>    <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12345</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;program_noproxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;v2ray&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;qv2ray&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;clash&quot;</span>，<span class="hljs-string">&quot;/usr/lib/kdeconnectd&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;program_proxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;cgroup_noproxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;/system.slice/v2ray.service&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;/system.slice/system-clash.slice/clash@sukanka.service&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;/system.slice/aria2c.service&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;cgroup_proxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;/&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;enable_gateway&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;enable_dns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;enable_udp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;enable_tcp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;enable_ipv4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;enable_ipv6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;table&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10007</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fwmark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">39283</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>kdeconnect</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>为 localhost 启用 https</title>
    <link href="/2020/08/03/localhost-https/"/>
    <url>/2020/08/03/localhost-https/</url>
    
    <content type="html"><![CDATA[<h1>引言</h1><p>我一直使用 <a href="http://ariang.mayswind.net/latest/#!/settings/ariang">AriaNG</a> 作为 aria2 的图形界面，同时使用 <a href="http://yacd.haishan.me/">yacd</a> 作为 clash 的控制面板，但是这两个网站最近我都打不开了。因此想在我自己的服务器上部署这两个面板。但是我的服务器使用了 https, 不支持 http. 因而会无法连接到本地的 aria2 和clash. 后来查到可以使用 <code>mkcert</code> 为<code>localhost</code> 颁发证书从而启用本地 https。</p><h1>具体步骤</h1><ol><li>安装 <code>mkcert</code>： <code>sudo pacman -S mkcert</code></li><li>生成证书：<code>mkcert localhost</code></li><li>安装证书。在浏览器里面导入生成的证书。可以参见 <a href="https://jingyan.baidu.com/article/ce43664919d1383773afd39f.html">浏览器导入数字证书：[2]Chrome</a>.</li></ol><h1>结语</h1><p>现在就可以使用 https 的 <a href="https://clash.razord.top/#/settings">clash-dashboard</a> 和 ariang 了.</p>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>clash</tag>
      
      <tag>AriaNg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux 系统安装 TeXLive 之后的事</title>
    <link href="/2020/05/17/texlive-postinstallation/"/>
    <url>/2020/05/17/texlive-postinstallation/</url>
    
    <content type="html"><![CDATA[<p>在回到学校隔离之后觉得十分无聊，又翻了翻刘海洋老师的 《LaTeX 入门》。发现我的 TeXLive 安装得并不完整，至少字体没有被系统用上。本文大部分内容摘自《LaTeX 入门》第8页至第9页。</p><p>**Windows 系统没有必要看本文！ ** 因为安装时应该已经配置好了。</p><h1>为 XeTeX 配置字体</h1><p>为 XeTeX 配置字体目的是让操作系统的 fontconfig 库能够找到 TeXLive 附带的大量字体。下面是具体步骤：</p><ol><li><p>将 <code>TEXMFSYSVAR/fonts/conf/texlive-fontconfig.conf</code> 链接到 <code>/etc/fonts/conf.d/09-texlive.conf</code>。 其中 <code>TEXMFSYSVAR</code> 是一个变量，在安装时指定，我使用的是 TeXLive 2020, 安装于 <code>/opt/texlive</code>.我使用的命令为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">ln</span> -s /opt/texlive/2020/texmf-var/fonts/conf/texlive-fontconfig.conf  /etc/fonts/conf.d/09-texlive.conf<br></code></pre></td></tr></table></figure></li><li><p>刷新字体缓存。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> fc-cache -fsv<br></code></pre></td></tr></table></figure></li></ol><h1>让 XeTeX 能按字体文件名找到系统字体</h1><p>有时候字体的名称和字体名并不相同，字体的名称并不容易看到。但是可以通过修改 TeXLive 安装目录下的 <code>texmf.cnf</code>, 在里面修改 <code>OSFONTDIR</code> 的值， 如</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">OSFONTDIR</span> <span class="hljs-operator">=</span> /usr/share/fonts//<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LaTeX</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>TeXLive</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>利用Oracle免费VPS 搭建Aria2+Caddy+Filebrowser 文件下载器</title>
    <link href="/2020/05/07/ariaAndCaddy/"/>
    <url>/2020/05/07/ariaAndCaddy/</url>
    
    <content type="html"><![CDATA[<p>本文介绍利用甲骨文的免费VPS 搭建 Aria2+Caddy+filebrowser 的下载平台。给自己留一个备份。等到<a href="https://github.com/helloxz/ccaa">ccaa2.0</a>版本支持caddy 也许本文就没有必要了。</p><h1>获取免费服务器</h1><p>甲骨文(Oracle) 公司提供免费服务器，需要外币卡（信用卡储蓄卡均可），如 Visa, MasterCard, JCB, AE 等，单标银联卡不行。具体见 <a href="https://51.ruyo.net/14138.html">申请Oracle Cloud永久免费服务+300美元试用额度</a>.</p><h1>绑定域名</h1><p>以下我们假定域名为 <strong><a href="http://example.com">example.com</a></strong>, 用于 ariaNg面板的域名为 <strong><a href="http://aria.example.com">aria.example.com</a></strong>, 用于 filebrowser 的域名为 <strong><a href="http://file.example.com">file.example.com</a></strong>. 假设服务器ip地址为 <strong>132.145.123.159</strong>。</p><p>首先在域名提供商处将域名解析到对应的ip 地址 （A记录）。</p><h1>搭建下载平台</h1><p>在获取到免费服务器后，用 ssh 登录上去，准备安装 Aria2 等。</p><p>这部分根据 <a href="https://github.com/helloxz/ccaa">https://github.com/helloxz/ccaa</a> 改编。</p><p>由于2.0版本去除了caddy, 本文使用的是1.0版本的脚本。</p><p>注意：FileBrowser 2.1.0 版本有 Bug, 无法编辑文件，建议使用 2.0.16版本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#####一键安装Caddy + Aria2 + AriaNg#####</span><br><span class="hljs-comment">#####作者：xiaoz.me#####</span><br><span class="hljs-comment">#####更新时间：2019-05-15#####</span><br><br><span class="hljs-comment">#导入环境变量</span><br>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/bin:/sbin<br><span class="hljs-built_in">export</span> PATH<br>aria_ver=1.35.0<br>caddy_ver=2.0.0<br>ariang_ver=1.1.6<br><span class="hljs-comment">#安装之前的准备</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">setout</span></span>()&#123;<br><span class="hljs-keyword">if</span> [ -e <span class="hljs-string">&quot;/usr/bin/yum&quot;</span> ]<br><span class="hljs-keyword">then</span><br>yum -y install curl gcc gcc+ make bzip2<br><span class="hljs-keyword">else</span><br><span class="hljs-comment">#更新软件，否则可能make命令无法安装</span><br><span class="hljs-built_in">sudo</span> apt-get update<br><span class="hljs-built_in">sudo</span> apt-get install -y curl make<br><span class="hljs-keyword">fi</span><br>&#125;<br><span class="hljs-comment">#安装Aria2</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">install_aria2</span></span>()&#123;<br><span class="hljs-comment">#yum -y update</span><br><span class="hljs-comment">#安装aria2静态编译版本，来源于https://github.com/q3aql/aria2-static-builds/</span><br>wget -c https://github.com/q3aql/aria2-static-builds/releases/download/v<span class="hljs-variable">$&#123;aria_ver&#125;</span>/aria2-<span class="hljs-variable">$&#123;aria_ver&#125;</span>-linux-gnu-64bit-build1.tar.bz2<br>tar jxvf aria2-<span class="hljs-variable">$&#123;aria_ver&#125;</span>-linux-gnu-64bit-build1.tar.bz2<br><span class="hljs-built_in">cd</span> aria2-<span class="hljs-variable">$&#123;aria_ver&#125;</span>-linux-gnu-64bit-build1<br>make install<br><span class="hljs-built_in">cd</span> ..<br>&#125;<br><span class="hljs-comment">#安装caddy</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">install_caddy</span></span>()&#123;<br><span class="hljs-comment">#一键安装https://caddyserver.com/download/linux/amd64?plugins=http.filemanager&amp;license=personal&amp;telemetry=off</span><br><span class="hljs-comment">#curl https://getcaddy.com | bash -s personal http.filemanager</span><br><span class="hljs-comment">#安装caddy</span><br>wget https://github.com/caddyserver/caddy/releases/download/v<span class="hljs-variable">$&#123;caddy_ver&#125;</span>/caddy_<span class="hljs-variable">$&#123;caddy_ver&#125;</span>_linux_amd64.tar.gz -O caddy.tar.gz<br>tar -zxvf caddy.tar.gz<br><span class="hljs-built_in">mv</span> caddy /usr/sbin/<br><span class="hljs-built_in">chmod</span> +x /usr/sbin/caddy<br><span class="hljs-comment">#添加服务</span><br><span class="hljs-comment">#mv init/linux-systemd/caddy.service /lib/systemd/system</span><br><span class="hljs-comment">#chmod +x /lib/systemd/system/caddy.service</span><br><span class="hljs-comment">#开机启动</span><br><span class="hljs-comment">#systemctl enable caddy.service</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">install_file_browser</span></span>()&#123;<br><span class="hljs-comment">#下载File Browser</span><br>wget https://github.com/filebrowser/filebrowser/releases/download/v2.0.16/linux-amd64-filebrowser.tar.gz<br><span class="hljs-comment">#解压</span><br>tar -zxvf linux-amd64-filebrowser.tar.gz<br><span class="hljs-comment">#移动位置</span><br><span class="hljs-built_in">mv</span> filebrowser /usr/sbin<br><span class="hljs-built_in">cd</span><br>&#125;<br><span class="hljs-comment">#处理配置文件</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">dealconf</span></span>()&#123;<br><span class="hljs-comment">#创建目录和文件</span><br><span class="hljs-built_in">mkdir</span> -p /etc/ccaa/<br><span class="hljs-built_in">touch</span> /etc/ccaa/aria2.session<br><span class="hljs-built_in">touch</span> /etc/ccaa/aria2.<span class="hljs-built_in">log</span><br><span class="hljs-built_in">touch</span> /etc/ccaa/caddy.log<br><span class="hljs-built_in">cp</span> aria2.conf /etc/ccaa/<br><span class="hljs-built_in">cp</span> caddy.conf /etc/ccaa/<br><span class="hljs-built_in">cp</span> upbt.sh /etc/ccaa/<br><span class="hljs-built_in">chmod</span> +x /etc/ccaa/upbt.sh<br><span class="hljs-built_in">chmod</span> +x ccaa<br><span class="hljs-built_in">cp</span> ccaa /usr/sbin<br>&#125;<br><span class="hljs-comment">#自动放行端口</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">chk_firewall</span></span>()&#123;<br><span class="hljs-keyword">if</span> [ -e <span class="hljs-string">&quot;/etc/sysconfig/iptables&quot;</span> ]<br><span class="hljs-keyword">then</span><br>iptables -I INPUT -p tcp --dport 6080 -j ACCEPT<br>iptables -I INPUT -p tcp --dport 6800 -j ACCEPT<br>iptables -I INPUT -p tcp --dport 6998 -j ACCEPT<br>iptables -I INPUT -p tcp --dport 51413 -j ACCEPT<br>service iptables save<br>service iptables restart<br><span class="hljs-keyword">elif</span> [ -e <span class="hljs-string">&quot;/etc/firewalld/zones/public.xml&quot;</span> ]<br><span class="hljs-keyword">then</span><br>firewall-cmd --zone=public --add-port=6080/tcp --permanent<br>firewall-cmd --zone=public --add-port=6800/tcp --permanent<br>firewall-cmd --zone=public --add-port=6998/tcp --permanent<br>firewall-cmd --zone=public --add-port=51413/tcp --permanent<br>firewall-cmd --reload<br><span class="hljs-keyword">elif</span> [ -e <span class="hljs-string">&quot;/etc/ufw/before.rules&quot;</span> ]<br><span class="hljs-keyword">then</span><br><span class="hljs-built_in">sudo</span> ufw allow 6080/tcp<br><span class="hljs-built_in">sudo</span> ufw allow 6800/tcp<br><span class="hljs-built_in">sudo</span> ufw allow 6998/tcp<br><span class="hljs-built_in">sudo</span> ufw allow 51413/tcp<br><span class="hljs-keyword">fi</span><br>&#125;<br><span class="hljs-comment">#删除端口</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">del_post</span></span>() &#123;<br><span class="hljs-keyword">if</span> [ -e <span class="hljs-string">&quot;/etc/sysconfig/iptables&quot;</span> ]<br><span class="hljs-keyword">then</span><br>sed -i <span class="hljs-string">&#x27;/^.*6080.*/&#x27;</span>d /etc/sysconfig/iptables<br>sed -i <span class="hljs-string">&#x27;/^.*6800.*/&#x27;</span>d /etc/sysconfig/iptables<br>sed -i <span class="hljs-string">&#x27;/^.*6998.*/&#x27;</span>d /etc/sysconfig/iptables<br>sed -i <span class="hljs-string">&#x27;/^.*51413.*/&#x27;</span>d /etc/sysconfig/iptables<br>service iptables save<br>service iptables restart<br><span class="hljs-keyword">elif</span> [ -e <span class="hljs-string">&quot;/etc/firewalld/zones/public.xml&quot;</span> ]<br><span class="hljs-keyword">then</span><br>firewall-cmd --zone=public --remove-port=6080/tcp --permanent<br>firewall-cmd --zone=public --remove-port=6800/tcp --permanent<br>firewall-cmd --zone=public --remove-port=6998/tcp --permanent<br>firewall-cmd --zone=public --remove-port=51413/tcp --permanent<br>firewall-cmd --reload<br><span class="hljs-keyword">elif</span> [ -e <span class="hljs-string">&quot;/etc/ufw/before.rules&quot;</span> ]<br><span class="hljs-keyword">then</span><br><span class="hljs-built_in">sudo</span> ufw delete 6080/tcp<br><span class="hljs-built_in">sudo</span> ufw delete 6800/tcp<br><span class="hljs-built_in">sudo</span> ufw delete 6998/tcp<br><span class="hljs-built_in">sudo</span> ufw delete 51413/tcp<br><span class="hljs-keyword">fi</span><br>&#125;<br><span class="hljs-comment">#设置账号密码</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">setting</span></span>()&#123;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;-------------------------------------------------------------&#x27;</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;设置下载路径（请填写绝对地址，默认/data/ccaaDown）:&quot;</span> downpath<br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Aria2 RPC 密钥:(字母或数字组合，不要含有特殊字符):&quot;</span> secret<br><span class="hljs-comment">#如果Aria2密钥为空</span><br><span class="hljs-keyword">while</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;secret&#125;</span>&quot;</span> ]<br><span class="hljs-keyword">do</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Aria2 RPC 密钥:(字母或数字组合，不要含有特殊字符):&quot;</span> secret<br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># read -p &quot;设置Caddy用户名:&quot; caddyuser</span><br><span class="hljs-comment"># while [ -z &quot;$&#123;caddyuser&#125;&quot; ]</span><br><span class="hljs-comment"># do</span><br><span class="hljs-comment"># read -p &quot;设置Caddy用户名:&quot; caddyuser</span><br><span class="hljs-comment"># done</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># read -p &quot;设置Caddy密码:&quot; caddypass</span><br><span class="hljs-comment"># while [ -z &quot;$&#123;caddypass&#125;&quot; ]</span><br><span class="hljs-comment"># do</span><br><span class="hljs-comment"># read -p &quot;设置Caddy密码:&quot; caddypass</span><br><span class="hljs-comment"># done</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Filebrowser 域名地址：(filebrowser.example.com):&quot;</span> filebrowser_domain<br><span class="hljs-keyword">while</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;filebrowser_domain&#125;</span>&quot;</span> ]<br><span class="hljs-keyword">do</span> <br>        <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Filebrowser 域名地址：(filebrowser.example.com):&quot;</span> filebrowser_domain<br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;AriaNg 面板域名地址：(aria.example.com):&quot;</span> ariang_domain<br><span class="hljs-keyword">while</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ariang_domain&#125;</span>&quot;</span> ]<br><span class="hljs-keyword">do</span><br>        <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;AriaNg 面板域名地址：(aria.example.com):&quot;</span> ariang_domain<br>    <span class="hljs-keyword">done</span><br><br><br><span class="hljs-comment">#如果下载路径为空，设置默认下载路径</span><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;downpath&#125;</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>downpath=<span class="hljs-string">&#x27;/data/ccaaDown&#x27;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">#执行替换操作</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$&#123;downpath&#125;</span><br>sed -i <span class="hljs-string">&quot;s%dir=%dir=<span class="hljs-variable">$&#123;downpath&#125;</span>%g&quot;</span> /etc/ccaa/aria2.conf<br>sed -i <span class="hljs-string">&quot;s/rpc-secret=/rpc-secret=<span class="hljs-variable">$&#123;secret&#125;</span>/g&quot;</span> /etc/ccaa/aria2.conf<br><span class="hljs-comment"># sed -i &quot;s/username/$&#123;caddyuser&#125;/g&quot; /etc/ccaa/caddy.conf</span><br><span class="hljs-comment"># sed -i &quot;s/password/$&#123;caddypass&#125;/g&quot; /etc/ccaa/caddy.conf</span><br><span class="hljs-comment"># sed -i &quot;s%/home%$&#123;downpath&#125;%g&quot; /etc/ccaa/caddy.conf</span><br><span class="hljs-comment"># sed -i &quot;s%/admin%/admin $&#123;downpath&#125;%g&quot; /etc/ccaa/caddy.conf</span><br><span class="hljs-comment">#更新tracker</span><br>bash ./upbt.sh<br><br><span class="hljs-comment">#安装AriaNg</span><br>wget -O AriaNg.zip https://github.com/mayswind/AriaNg/releases/download/<span class="hljs-variable">$&#123;ariang_ver&#125;</span>/AriaNg-<span class="hljs-variable">$&#123;ariang_ver&#125;</span>.zip<br>unzip AriaNg.zip<br>sed -i <span class="hljs-string">&#x27;s|&lt;/ul&gt;&lt;/section&gt;&lt;/aside&gt;|&lt;li&gt;&lt;a class=&quot;toolbar&quot; title=&quot;文件管理&quot; href=&quot;https://_filebrowser.example.com&quot; target=&quot;_blank&quot;&gt;&lt;i class=&quot;fa fa-folder-o&quot;&gt;&lt;/i&gt; 文件管理&lt;/a&gt;&lt;/li&gt;&amp;|&#x27;</span> AriaNg/index.html<br>sed -i <span class="hljs-string">&quot;s/_filebrowser.example.com/<span class="hljs-variable">$&#123;filebrowser_domain&#125;</span>/g&quot;</span>  AriaNg/index.html<br><span class="hljs-built_in">cp</span> -a AriaNg /etc/ccaa<br><br><span class="hljs-comment">#启动服务</span><br><span class="hljs-built_in">nohup</span> aria2c --conf-path=/etc/ccaa/aria2.conf &gt; /etc/ccaa/aria2.<span class="hljs-built_in">log</span> 2&gt;&amp;1 &amp;<br><span class="hljs-built_in">nohup</span> caddy -conf=<span class="hljs-string">&quot;/etc/ccaa/caddy.conf&quot;</span> &gt; /etc/ccaa/caddy.log 2&gt;&amp;1 &amp;<br><br><span class="hljs-comment">#获取ip</span><br>osip=$(curl -4s https://api.ip.sb/ip)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;-------------------------------------------------------------&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;大功告成，请访问: http://<span class="hljs-variable">$&#123;osip&#125;</span>:6080/&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;用户名:&#x27;</span> <span class="hljs-variable">$&#123;caddyuser&#125;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;密码:&#x27;</span> <span class="hljs-variable">$&#123;caddypass&#125;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Aria2 RPC 密钥:&#x27;</span> <span class="hljs-variable">$&#123;secret&#125;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;帮助文档: https://dwz.ovh/ccaa （必看）&#x27;</span> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;-------------------------------------------------------------&#x27;</span><br>&#125;<br><span class="hljs-comment">#清理工作</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">cleanup</span></span>()&#123;<br><span class="hljs-built_in">rm</span> -rf *.zip<br><span class="hljs-built_in">rm</span> -rf *.gz<br><span class="hljs-built_in">rm</span> -rf *.txt<br><span class="hljs-built_in">rm</span> -rf aria2-1.3*<br><span class="hljs-comment">#rm -rf *.conf</span><br><span class="hljs-built_in">rm</span> -rf init<br>&#125;<br><br><span class="hljs-comment">#卸载</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">uninstall</span></span>()&#123;<br><span class="hljs-comment">#停止所有服务</span><br><span class="hljs-built_in">kill</span> -9 $(pgrep <span class="hljs-string">&#x27;aria2c&#x27;</span>)<br><span class="hljs-built_in">kill</span> -9 $(pgrep <span class="hljs-string">&#x27;caddy&#x27;</span>)<br><br><span class="hljs-comment">#删除服务</span><br><span class="hljs-comment">#systemctl disable caddy.service</span><br><span class="hljs-comment">#rm -rf /lib/systemd/system/caddy.service</span><br><span class="hljs-comment">#删除文件</span><br><span class="hljs-built_in">rm</span> -rf /etc/ccaa<br><span class="hljs-built_in">rm</span> -rf /usr/sbin/caddy<br><span class="hljs-built_in">rm</span> -rf /usr/sbin/ccaa<br><span class="hljs-built_in">rm</span> -rf /usr/bin/aria2c<br><span class="hljs-built_in">rm</span> -rf aria2-1.*<br><span class="hljs-built_in">rm</span> -rf AriaNg*<br><br><br><span class="hljs-built_in">rm</span> -rf /usr/share/man/man1/aria2c.1<br><span class="hljs-built_in">rm</span> -rf /etc/ssl/certs/ca-certificates.crt<br><span class="hljs-comment">#删除端口</span><br>del_post<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;------------------------------------------------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;卸载完成！&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;------------------------------------------------&quot;</span><br>&#125;<br><br><span class="hljs-comment">#选择安装方式</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;------------------------------------------------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Linux + Caddy + Aria2 + AriaNg一键安装脚本(CCAA)&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1) 安装CCAA&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;2) 卸载CCAA&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;3) 更新bt-tracker&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;q) 退出！&quot;</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;:&quot;</span> istype<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$istype</span> <span class="hljs-keyword">in</span><br>    1) <br>    setout<br>    install_aria2 &amp;&amp; \<br>    install_caddy &amp;&amp; \<br>    dealconf &amp;&amp; \<br>    chk_firewall &amp;&amp; \<br>    setting &amp;&amp; \<br>    cleanup<br>    ;;<br>    2) <br>    uninstall<br>    ;;<br>    3) <br>    bash ./upbt.sh<br>    ;;<br>    q) <br>    <span class="hljs-built_in">exit</span><br>    ;;<br>    *) <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;参数错误！&#x27;</span><br><span class="hljs-keyword">esac</span><br></code></pre></td></tr></table></figure><h2 id="使用方式">使用方式</h2><p>下载 <a href="https://github.com/helloxz/ccaa/archive/v1.0.zip">https://github.com/helloxz/ccaa/archive/v1.0.zip</a> 然后解压，将<code>ccaa.sh</code> 的内容修改为上述内容。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> su <span class="hljs-comment"># 切换为root</span><br>wget https://github.com/helloxz/ccaa/archive/v1.0.zip<br>unzip v1.0.zip<br><span class="hljs-comment"># 然后修改 ccaa.sh 的内容并加上执行权限。</span><br><span class="hljs-comment"># 然后运行 ccaa.sh选择安装</span><br></code></pre></td></tr></table></figure><p>安装完 ccaa 之后， 我们需要手动配置 <code>filebrowser</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> /etc/ccaa/filebrowser.db<br><span class="hljs-built_in">chmod</span> 0777 -R /etc/ccaa/ <span class="hljs-comment"># 用于解决权限问题</span><br></code></pre></td></tr></table></figure><h3 id="配置-filebrowser">配置 filebrowser</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#创建并初始化数据库</span><br>filebrowser -d <span class="hljs-string">/etc/ccaa/filebrowser.db</span> config init<br><br><span class="hljs-comment">#设置filebrowser监听地址</span><br>filebrowser -d <span class="hljs-string">/etc/ccaa/filebrowser.db</span> config <span class="hljs-keyword">set</span> <span class="hljs-params">--address</span> 0.0.0.0<br><br><span class="hljs-comment">#设置filebrowser监听端口,自己改(8099)</span><br>filebrowser -d <span class="hljs-string">/etc/ccaa/filebrowser.db</span> config <span class="hljs-keyword">set</span> <span class="hljs-params">--port</span> 8099<br><br><span class="hljs-comment">#设置filebrowser语言环境</span><br>filebrowser -d <span class="hljs-string">/etc/ccaa/filebrowser.db</span> config <span class="hljs-keyword">set</span> <span class="hljs-params">--locale</span> zh-cn<br><br><span class="hljs-comment">#设置filebrowser日志文件位置</span><br>filebrowser -d <span class="hljs-string">/etc/ccaa/filebrowser.db</span> config <span class="hljs-keyword">set</span> <span class="hljs-params">--log</span> <span class="hljs-string">/var/log/filebrowser.log</span><br><br><span class="hljs-comment">#设置filebrowser Web控制台界面账号和密码 (root, 123456)</span><br>filebrowser -d <span class="hljs-string">/etc/ccaa/filebrowser.db</span> users add root 123456 <span class="hljs-params">--perm</span>.admin<br></code></pre></td></tr></table></figure><h3 id="修改网站配置">修改网站配置</h3><p>如果你有域名，可以配置 https 访问。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /etc/ccaa/caddy.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs perl">aria.example.com &#123; <span class="hljs-comment"># 你的 ariaNg 控制面板的域名</span><br>        root /etc/ccaa/AriaNg<br>        gzip<br>        <span class="hljs-comment">#超时时间</span><br>        timeouts <span class="hljs-number">0</span><br>        <span class="hljs-comment">#访问口令</span><br>        tls your_email<span class="hljs-variable">@example</span>.com <span class="hljs-comment"># 你的邮件地址</span><br>&#125;<br>filebrowser.example.com &#123; <span class="hljs-comment"># filebrowser 管理界面域名</span><br>        gzip<br>        tls your_email<span class="hljs-variable">@example</span>.com <span class="hljs-comment"># 你的邮件地址</span><br>        proxy / http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">8099</span> <span class="hljs-comment"># 注意端口号改成之前设置的 filebrowser 的端口号</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>配置好之后，输入</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/sbin/caddy -log stdout <span class="hljs-attribute">-agree</span>=<span class="hljs-literal">true</span> <span class="hljs-attribute">-conf</span>=/etc/ccaa/caddy.conf <span class="hljs-attribute">-root</span>=/var/tmp -quic<br></code></pre></td></tr></table></figure><p>查看 输出，会给你一个类似于 <code>https://acme-v02.api.letsencrypt.org/acme/authz-v3/440733xxx</code>的地址。复制里面的 <code>token</code> 的内容（不含引号），添加到域名的txt 记录里面,如</p><p><img src="https://sukanka-figure-bed.oss-cn-chengdu.aliyuncs.com/blog/202020200507034356.png" alt=""></p><p>其中，我的ariang 面板域名是 <code>aria.mydomain.suffix</code></p><p>再次运行</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/sbin/caddy -log stdout <span class="hljs-attribute">-agree</span>=<span class="hljs-literal">true</span> <span class="hljs-attribute">-conf</span>=/etc/ccaa/caddy.conf <span class="hljs-attribute">-root</span>=/var/tmp -quic<br></code></pre></td></tr></table></figure><p>看是否正常运行。</p><h3 id="修改-AriaNg-面板">修改 AriaNg 面板</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">sed -i &#x27;s|Aria2 Status&lt;<span class="hljs-string">/span</span>&gt;&lt;<span class="hljs-string">/a</span>&gt;&lt;<span class="hljs-string">/li</span>&gt;|&amp;&lt;li&gt;&lt;a class=<span class="hljs-string">&quot;toolbar&quot;</span> title=<span class="hljs-string">&quot;文件管理&quot;</span> href=<span class="hljs-string">&quot;http://server_ip:6081/&quot;</span> target=<span class="hljs-string">&quot;_blank&quot;</span>&gt;      &lt;i class=<span class="hljs-string">&quot;fa fa-folder-o&quot;</span>&gt;&lt;<span class="hljs-string">/i</span>&gt; 文件管理    &lt;<span class="hljs-string">/a</span>&gt;&lt;<span class="hljs-string">/li</span>&gt;|&#x27; <span class="hljs-string">/etc/ccaa/AriaNg/index.html</span><br>sed -i &#x27;s|http:<span class="hljs-string">//server_ip</span><span class="hljs-function">:6081</span>/|https:<span class="hljs-string">//prefix.yourdomain.suffix</span>|g&#x27; <span class="hljs-string">/etc/ccaa/AriaNg/index.html</span> <span class="hljs-comment"># 注意修改域名</span><br></code></pre></td></tr></table></figure><h4 id="filebrowser-自启动文件">filebrowser 自启动文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/systemd/system/filebrowser.service<br></code></pre></td></tr></table></figure><p>输入以下内容</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Filebrowser<br><span class="hljs-attr">After</span>=network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">ExecStart</span>=/usr/sbin/filebrowser -d /etc/ccaa/filebrowser.db<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><h3 id="caddy-自启动">caddy 自启动</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>filebrowser.service<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Caddy HTTP/<span class="hljs-number">2</span> web server<br><span class="hljs-attr">Documentation</span>=https://caddyserver.com/docs<br><span class="hljs-attr">After</span>=network-<span class="hljs-literal">on</span>line.target<br><span class="hljs-attr">Wants</span>=network-<span class="hljs-literal">on</span>line.target systemd-networkd-wait-<span class="hljs-literal">on</span>line.service<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-abnormal<br><br><span class="hljs-comment">; User and group the process will run as.</span><br><span class="hljs-attr">User</span>=caddy<br><span class="hljs-attr">Group</span>=caddy<br><br><span class="hljs-comment">; Letsencrypt-issued certificates will be written to this directory.</span><br><span class="hljs-attr">Environment</span>=CADDYPATH=/etc/ssl/caddy<br><br><span class="hljs-comment">; Always set &quot;-root&quot; to something safe in case it gets forgotten in the Caddyfile.</span><br><span class="hljs-attr">ExecStart</span>=/sbin/caddy -log stdout -agree=<span class="hljs-literal">true</span> -conf=/etc/ccaa/caddy.conf -root=/var/tmp -quic<br><br><span class="hljs-comment">; Use graceful shutdown with a reasonable timeout</span><br><span class="hljs-attr">KillMode</span>=mixed<br><span class="hljs-attr">KillSignal</span>=SIGQUIT<br><span class="hljs-attr">TimeoutStopSec</span>=<span class="hljs-number">5</span>s<br><br><span class="hljs-comment">; Limit the number of file descriptors; see `man systemd.exec` for more limit settings.</span><br><span class="hljs-attr">LimitNOFILE</span>=<span class="hljs-number">1048576</span><br><span class="hljs-comment">; Unmodified caddy is not expected to use more than that.</span><br><span class="hljs-attr">LimitNPROC</span>=<span class="hljs-number">512</span><br><br><span class="hljs-comment">; Use private /tmp and /var/tmp, which are discarded after caddy stops.</span><br><span class="hljs-attr">PrivateTmp</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment">; Use a minimal /dev</span><br><span class="hljs-attr">PrivateDevices</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment">; Hide /home, /root, and /run/user. Nobody will steal your SSH-keys.</span><br><span class="hljs-attr">ProtectHome</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment">; Make /usr, /boot, /etc and possibly some more folders read-only.</span><br><span class="hljs-attr">ProtectSystem</span>=full<br><span class="hljs-comment">; … except /etc/ssl/caddy, because we want Letsencrypt-certificates there.</span><br><span class="hljs-comment">;   This merely retains r/w access rights, it does not add any new. Must still be writable on the host!</span><br><span class="hljs-attr">ReadWriteDirectories</span>=/etc/ssl/caddy<br><br><span class="hljs-comment">; The following additional security directives only work with systemd v229 or later.</span><br><span class="hljs-comment">; They further retrict privileges that can be gained by caddy. Uncomment if you like.</span><br><span class="hljs-comment">; Note that you may have to add capabilities required by any plugins in use.</span><br><span class="hljs-attr">CapabilityBoundingSet</span>=CAP_NET_BIND_SERVICE<br><span class="hljs-attr">AmbientCapabilities</span>=CAP_NET_BIND_SERVICE<br><span class="hljs-attr">NoNewPrivileges</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><h4 id="aria2-自启动">aria2 自启动</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>aria2.service <br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">Description</span>=aria2<br><span class="hljs-attr">After</span>=network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">ExecStart</span>=/usr/bin/aria2c --conf-path=/etc/ccaa/aria2.conf<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><h3 id="加载自启动文件">加载自启动文件</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl daemon-reload <br><span class="hljs-params">system</span>ctl start aria2.service<br><span class="hljs-params">system</span>ctl start caddy.service<br><span class="hljs-params">system</span>ctl start filebrowser.service<br><br><span class="hljs-params">system</span>ctl enable aria2.service<br><span class="hljs-params">system</span>ctl enable caddy.service<br><span class="hljs-params">system</span>ctl enable filebrowser.service<br></code></pre></td></tr></table></figure><p>可以使用 <code>systemctl status aria2 </code>来查看 aria2 的运行状态。</p><h1>附录</h1><h2 id="我的aria2-conf">我的<code>aria2.conf</code></h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">## Manjaro</span><br><span class="hljs-comment">## &#x27;#&#x27;开头为注释内容, 选项都有相应的注释说明, 根据需要修改 ##</span><br><span class="hljs-comment">## 被注释的选项填写的是默认值, 建议在需要修改时再取消注释  ##</span><br><br><span class="hljs-comment">## 文件保存相关 ##</span><br><br><span class="hljs-comment"># 文件的保存路径(可使用绝对路径或相对路径), 默认: 当前启动位置</span><br>dir=/Downloads<br><span class="hljs-comment"># 启用磁盘缓存, 0为禁用缓存, 需1.16以上版本, 默认:16M</span><br>disk-cache=<span class="hljs-number">32</span>M<br><span class="hljs-comment"># 文件预分配方式, 能有效降低磁盘碎片, 默认:prealloc</span><br><span class="hljs-comment"># 预分配所需时间: none &lt; falloc ? trunc &lt; prealloc</span><br><span class="hljs-comment"># falloc和trunc则需要文件系统和内核支持</span><br><span class="hljs-comment"># NTFS建议使用falloc, EXT3/4建议trunc, MAC 下需要注释此项</span><br>file-allocation=trunc<br><span class="hljs-comment"># 断点续传</span><br><span class="hljs-keyword">continue</span>=true<br><span class="hljs-comment">#日志位置</span><br>log=stdout<br>log-level=warn<br><br><span class="hljs-comment">## 下载连接相关 ##</span><br><br><span class="hljs-comment"># 最大同时下载任务数, 运行时可修改, 默认:5</span><br>max-concurrent-downloads=<span class="hljs-number">10</span><br><span class="hljs-comment"># 同一服务器连接数, 添加时可指定, 默认:1</span><br>max-connection-per-server=<span class="hljs-number">16</span><br><span class="hljs-comment"># 最小文件分片大小, 添加时可指定, 取值范围1M -1024M, 默认:20M</span><br><span class="hljs-comment"># 假定size=10M, 文件为20MiB 则使用两个来源下载; 文件为15MiB 则使用一个来源下载</span><br>min-split-size=<span class="hljs-number">20</span>M<br><span class="hljs-comment"># 单个任务最大线程数, 添加时可指定, 默认:5</span><br>split=<span class="hljs-number">16</span><br><span class="hljs-comment"># 整体下载速度限制, 运行时可修改, 默认:0</span><br><span class="hljs-comment">#max-overall-download-limit=0</span><br><span class="hljs-comment"># 单个任务下载速度限制, 默认:0</span><br><span class="hljs-comment">#max-download-limit=0</span><br><span class="hljs-comment"># 整体上传速度限制, 运行时可修改, 默认:0</span><br><span class="hljs-comment">#max-overall-upload-limit=1024K</span><br><span class="hljs-comment"># 单个任务上传速度限制, 默认:0</span><br><span class="hljs-comment">#max-upload-limit=0</span><br><span class="hljs-comment"># 禁用IPv6, 默认:false</span><br><span class="hljs-comment">#disable-ipv6=true</span><br>check-certificate=false<br><span class="hljs-comment">#自动重命名</span><br><span class="hljs-comment">#auto-file-renaming</span><br><span class="hljs-comment"># 连接超时时间, 默认:60</span><br><span class="hljs-comment">#timeout=60</span><br><span class="hljs-comment"># 最大重试次数, 设置为0表示不限制重试次数, 默认:5</span><br><span class="hljs-comment">#max-tries=5</span><br><span class="hljs-comment"># 设置重试等待的秒数, 默认:0</span><br><span class="hljs-comment">#retry-wait=0</span><br><br><br><span class="hljs-comment">#HTTP 代理服务器</span><br><span class="hljs-comment">#http-proxy=http://127.0.0.1:12333</span><br><span class="hljs-comment">#HTTPS 代理服务器</span><br><span class="hljs-comment">#https-proxy=http://127.0.0.1:12333</span><br><br><span class="hljs-comment">## 进度保存相关 ##</span><br><br><span class="hljs-comment"># 从会话文件中读取下载任务</span><br>input-file=<span class="hljs-regexp">/etc/</span>ccaa/aria2.session<br>save-session=<span class="hljs-regexp">/etc/</span>ccaa/aria2.session<br><span class="hljs-comment"># 定时保存会话, 0为退出时才保存, 需1.16.1以上版本, 默认:0</span><br>save-session-interval=<span class="hljs-number">30</span><br><br><span class="hljs-comment">## RPC相关设置 ##</span><br><br><span class="hljs-comment"># 启用RPC, 默认:false</span><br>enable-rpc=true<br><span class="hljs-comment"># 允许所有来源, 默认:false</span><br>rpc-allow-origin-all=true<br><span class="hljs-comment"># 允许非外部访问, 默认:false</span><br>rpc-listen-all=true<br><span class="hljs-comment"># 事件轮询方式, 取值:[epoll, kqueue, port, poll, select], 不同系统默认值不同</span><br><span class="hljs-comment">#event-poll=select</span><br><span class="hljs-comment"># RPC监听端口, 端口被占用时可以修改, 默认:6800</span><br>rpc-listen-port=<span class="hljs-number">6800</span><br><span class="hljs-comment"># 设置的RPC授权令牌, v1.18.4新增功能, 取代 --rpc-user 和 --rpc-passwd 选项</span><br>rpc-secret=mypassword<br><span class="hljs-comment"># 设置的RPC访问用户名, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span><br><span class="hljs-comment">#rpc-user=&lt;USER&gt;</span><br><span class="hljs-comment"># 设置的RPC访问密码, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span><br><span class="hljs-comment">#rpc-passwd=&lt;PASSWD&gt;</span><br><span class="hljs-comment"># 是否启用 RPC 服务的 SSL/TLS 加密,</span><br><span class="hljs-comment"># 启用加密后 RPC 服务需要使用 https 或者 wss 协议连接</span><br>rpc-secure=true<br><span class="hljs-comment"># 在 RPC 服务中启用 SSL/TLS 加密时的证书文件,</span><br><span class="hljs-comment"># 使用 PEM 格式时，您必须通过 --rpc-private-key 指定私钥</span><br>rpc-certificate=<span class="hljs-regexp">/root/</span>.caddy<span class="hljs-regexp">/acme/</span>acme-v02.api.letsencrypt.org<span class="hljs-regexp">/sites/</span>aria.example.com/aria.example.com.crt<br><span class="hljs-comment"># 在 RPC 服务中启用 SSL/TLS 加密时的私钥文件</span><br>rpc-private-key=<span class="hljs-regexp">/root/</span>.caddy<span class="hljs-regexp">/acme/</span>acme-v02.api.letsencrypt.org<span class="hljs-regexp">/sites/</span>aria.example.com/aria.example.com.key<br><br><span class="hljs-comment">## BT/PT下载相关 ##</span><br><br><span class="hljs-comment"># 当下载的是一个种子(以.torrent结尾)时, 自动开始BT任务, 默认:true</span><br>follow-torrent=true<br><span class="hljs-comment"># BT监听端口, 当端口被屏蔽时使用, 默认:6881-6999</span><br>listen-port=<span class="hljs-number">51413</span><br><span class="hljs-comment">#强制加密, 防迅雷必备</span><br>bt-require-crypto=true<br><span class="hljs-comment"># 单个种子最大连接数, 默认:55</span><br>bt-max-peers=<span class="hljs-number">110</span><br><span class="hljs-comment"># 打开DHT功能, PT需要禁用, 默认:true</span><br>enable-dht=true<br><span class="hljs-comment"># 打开IPv6 DHT功能, PT需要禁用</span><br>enable-dht6=true<br><span class="hljs-comment"># DHT网络监听端口, 默认:6881-6999</span><br>dht-listen-port=<span class="hljs-number">6881</span>-<span class="hljs-number">6999</span><br><span class="hljs-comment"># 本地节点查找, PT需要禁用, 默认:false</span><br>bt-enable-lpd=true<br><span class="hljs-comment"># 种子交换, PT需要禁用, 默认:true</span><br>enable-peer-exchange=true<br><span class="hljs-comment"># 每个种子限速, 对少种的PT很有用, 默认:50K</span><br><span class="hljs-comment">#bt-request-peer-speed-limit=50K</span><br><span class="hljs-comment"># 客户端伪装, PT需要</span><br>peer-id-prefix=-TR2770-<br>user-agent=Transmission/<span class="hljs-number">2.77</span><br><span class="hljs-comment"># 当种子的分享率达到这个数时, 自动停止做种, 0为一直做种, 默认:1.0</span><br>seed-ratio=<span class="hljs-number">0</span><br><span class="hljs-comment">#分离做种，做种的时候不算在任务里</span><br>bt-detach-seed-only=true<br><span class="hljs-comment">#下载完自动删除.aria2文件</span><br><span class="hljs-comment">#on-download-complete=&quot;rm -f &quot;$3.aria2&quot;</span><br><span class="hljs-comment"># 强制保存会话, 即使任务已经完成, 默认:false</span><br><span class="hljs-comment"># 较新的版本开启后会在任务完成后依然保留.aria2文件</span><br>force-save=false<br><span class="hljs-comment"># BT校验相关, 默认:true</span><br><span class="hljs-comment">#bt-hash-check-seed=true</span><br><span class="hljs-comment"># 继续之前的BT任务时, 无需再次校验, 默认:false</span><br><span class="hljs-comment">#bt-seed-unverified=true</span><br><span class="hljs-comment"># 保存磁力链接元数据为种子文件(.torrent文件), 默认:false</span><br>bt-save-metadata=true<br><span class="hljs-comment"># trackers</span><br>bt-tracker=udp:<span class="hljs-regexp">//</span><span class="hljs-number">93.158</span>.<span class="hljs-number">213.92</span>:<span class="hljs-number">1337</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/93.158.213.92:1337/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">188.241</span>.<span class="hljs-number">58.209</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/62.210.97.59:1337/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">62.210</span>.<span class="hljs-number">97.59</span>:<span class="hljs-number">1337</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/151.80.120.114:2710/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">151.80</span>.<span class="hljs-number">120.115</span>:<span class="hljs-number">2710</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/208.83.20.20:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">185.181</span>.<span class="hljs-number">60.67</span>:<span class="hljs-number">80</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/194.182.165.153:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">37.235</span>.<span class="hljs-number">174.46</span>:<span class="hljs-number">2710</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/5.206.13.166:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">89.234</span>.<span class="hljs-number">156.205</span>:<span class="hljs-number">451</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/92.223.105.178:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">176.113</span>.<span class="hljs-number">71.60</span>:<span class="hljs-number">6961</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/176.113.71.60:6961/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">207.241</span>.<span class="hljs-number">226.111</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/51.15.40.114:80/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">207.241</span>.<span class="hljs-number">231.226</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/184.105.151.164:6969/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">184.105</span>.<span class="hljs-number">151.164</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/212.47.227.58:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">31.210</span>.<span class="hljs-number">170.169</span>:<span class="hljs-number">2710</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/46.148.18.250:2710/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">51.15</span>.<span class="hljs-number">55.204</span>:<span class="hljs-number">1337</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/91.149.192.31:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">5.226</span>.<span class="hljs-number">148.20</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/217.76.183.53:80/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">51.81</span>.<span class="hljs-number">46.170</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/46.148.18.254:2710/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">51.15</span>.<span class="hljs-number">55.204</span>:<span class="hljs-number">1337</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/51.81.46.170:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">207.246</span>.<span class="hljs-number">121.172</span>:<span class="hljs-number">2000</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/62.171.179.41:80/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">212.1</span>.<span class="hljs-number">226.176</span>:<span class="hljs-number">2710</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/173.82.240.104:6969/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">95.107</span>.<span class="hljs-number">48.115</span>:<span class="hljs-number">80</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/94.224.67.24:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">51.158</span>.<span class="hljs-number">23.91</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/78.46.225.225:2710/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">194.26</span>.<span class="hljs-number">183.158</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/159.89.208.145:8866/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">78.46</span>.<span class="hljs-number">225.225</span>:<span class="hljs-number">2710</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/159.89.208.145:8866/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">103.196</span>.<span class="hljs-number">36.31</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/167.179.77.133:1/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">165.227</span>.<span class="hljs-number">0.51</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/222.84.65.27:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">49.12</span>.<span class="hljs-number">75.231</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/78.30.254.12:2710/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">218.5</span>.<span class="hljs-number">41.129</span>:<span class="hljs-number">2710</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/80.211.26.119:9696/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">122.116</span>.<span class="hljs-number">144.108</span>:<span class="hljs-number">80</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/165.227.0.51:6969/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">149.129</span>.<span class="hljs-number">63.70</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/222.84.65.27:6969/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">116.203</span>.<span class="hljs-number">120.203</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/177.139.10.157:6969/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">51.38</span>.<span class="hljs-number">230.101</span>:<span class="hljs-number">80</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/54.39.179.91:6699/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">78.30</span>.<span class="hljs-number">254.12</span>:<span class="hljs-number">2710</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/51.79.71.167:80/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">182.150</span>.<span class="hljs-number">53.61</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/163.172.209.40:2710/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">176.113</span>.<span class="hljs-number">68.67</span>:<span class="hljs-number">6961</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/75.127.14.224:2710/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">52.58</span>.<span class="hljs-number">128.163</span>:<span class="hljs-number">6969</span><span class="hljs-regexp">/announce,udp:/</span><span class="hljs-regexp">/51.15.3.74:6969/</span>announce,udp:<span class="hljs-regexp">//</span><span class="hljs-number">139.99</span>.<span class="hljs-number">100.97</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/182.150.53.61:8080/</span>announce,http:<span class="hljs-regexp">//</span><span class="hljs-number">176.113</span>.<span class="hljs-number">68.67</span>:<span class="hljs-number">6961</span><span class="hljs-regexp">/announce,http:/</span><span class="hljs-regexp">/54.37.106.164:80/</span>announce<br><br></code></pre></td></tr></table></figure><p>使用 https 时注意以下几行</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># 启用加密后 RPC 服务需要使用 https 或者 wss 协议连接</span><br><span class="hljs-attr">rpc-secure</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment"># 在 RPC 服务中启用 SSL/TLS 加密时的证书文件,</span><br><span class="hljs-comment"># 使用 PEM 格式时，您必须通过 --rpc-private-key 指定私钥</span><br><span class="hljs-attr">rpc-certificate</span>=/root/.caddy/acme/acme-v02.api.letsencrypt.org/sites/aria.example.com/aria.example.com.crt<br><span class="hljs-comment"># 在 RPC 服务中启用 SSL/TLS 加密时的私钥文件</span><br><span class="hljs-attr">rpc-private-key</span>=/root/.caddy/acme/acme-v02.api.letsencrypt.org/sites/aria.example.com/aria.example.com.key<br></code></pre></td></tr></table></figure><p>这几行是 aria2 的口令</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># 设置的RPC授权令牌, v1.18.4新增功能, 取代 --rpc-user 和 --rpc-passwd 选项</span><br><span class="hljs-attr">rpc-secret</span>=mypassword<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>VPS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>aria2</tag>
      
      <tag>caddy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>华硕天选R7-4800H+RTX2060 安装 ArchLinux</title>
    <link href="/2020/04/28/ArchLinux-installation/"/>
    <url>/2020/04/28/ArchLinux-installation/</url>
    
    <content type="html"><![CDATA[<h1>配置</h1><p>我有幸以6599返100E卡抢到了一台4800H+2060的天选，之前想要安装 Manjaro, 但是LiveCD始终进入不了图形界面，因而放弃，转而选择了ArchLinux. 详细配置如下</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs scss">$ neofetch   <br>--------------------------------------------------------------------------------------<br>                   -`                    sukanka<span class="hljs-keyword">@asustx</span> <br>                  .o+`                   -------------- <br>                 `ooo/                   <span class="hljs-attribute">OS</span>: Arch Linux x86_64 <br>                `+<span class="hljs-attribute">oooo</span>:                  <span class="hljs-attribute">Host</span>: TUF Gaming FA506IV_FA506IV <span class="hljs-number">1.0</span> <br>               `+<span class="hljs-attribute">oooooo</span>:                 <span class="hljs-attribute">Kernel</span>: <span class="hljs-number">5.6</span>.<span class="hljs-number">7</span>-arch1-<span class="hljs-number">1</span> <br>               -+oooooo+:                <span class="hljs-attribute">Uptime</span>: <span class="hljs-number">2</span> hours, <span class="hljs-number">10</span> mins <br>             `/:<span class="hljs-attribute">-</span>:++oooo+:               <span class="hljs-attribute">Packages</span>: <span class="hljs-number">970</span> (pacman) <br>            `/++++/+++++++:              <span class="hljs-attribute">Shell</span>: zsh <span class="hljs-number">5.8</span> <br>           `/++++++++++++++:             <span class="hljs-attribute">Resolution</span>: <span class="hljs-number">1920</span>x1080 <br>          `/+++ooooooooooooo/`           <span class="hljs-attribute">DE</span>: Plasma <br>         ./ooosssso++osssssso+`          <span class="hljs-attribute">WM</span>: KWin <br>        .oossssso-````/ossssss+`         WM <span class="hljs-attribute">Theme</span>: 微风 <br>       -osssssso.      :ssssssso.        <span class="hljs-attribute">Theme</span>: Breeze [Plasma], Breeze [GTK2/<span class="hljs-number">3</span>] <br>      :osssssss/        osssso+++.       <span class="hljs-attribute">Icons</span>: breeze [Plasma], breeze [GTK2/<span class="hljs-number">3</span>] <br>     /ossssssss/        +ssssooo/-       <span class="hljs-attribute">Terminal</span>: yakuake <br>   `/ossssso+/:-        <span class="hljs-attribute">-</span>:/+osssso+-     <span class="hljs-attribute">CPU</span>: AMD Ryzen <span class="hljs-number">7</span> <span class="hljs-number">4800</span>H with Radeon Graphics (<span class="hljs-number">16</span>) @ <span class="hljs-number">2.900</span>GHz <br>  `+sso+:-`                 `.-/+<span class="hljs-attribute">oso</span>:    <span class="hljs-attribute">GPU</span>: AMD ATI <span class="hljs-number">06</span>:<span class="hljs-number">00.0</span> Renoir <br> `++:.                           `-/+/   <span class="hljs-attribute">GPU</span>: NVIDIA <span class="hljs-number">01</span>:<span class="hljs-number">00.0</span> NVIDIA Corporation Device <span class="hljs-number">1</span>f15 <br> .`                                 `/   <span class="hljs-attribute">Memory</span>: <span class="hljs-number">2492</span>MiB / <span class="hljs-number">31594</span>MiB <br></code></pre></td></tr></table></figure><p>首先我参考了<a href="https://www.viseator.com/2017/05/17/arch_install/">以官方Wiki的方式安装ArchLinux</a></p><p>安装上了 ArchLinux, 需要注意的是，天选是 nvme的固态硬盘，因而没有<code>/dev/sda</code> 之类的，而是 <code>/dev/nvme0n1</code></p><h1>图形界面</h1><p>参照 <a href="https://www.viseator.com/2017/05/19/arch_setup/">ArchLinux安装后的必须配置与图形界面安装教程</a></p><h2 id="常用软件">常用软件</h2><p>这部分记录自己常用的软件。其中 <code>texlive</code> 实际安装的是从<a href="https://tug.org/">TeX Users Group</a> 下载的最新版本，之后安装<code>texlive-dummy</code>让 Arch 认为 <code>texlive</code> 已经安装。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ yay -Qeqt<br>-----------------------------------------------------------------------------------<br>acpi<br>amd-ucode<br>anaconda<br><span class="hljs-keyword">android-sdk-build-tools</span><br><span class="hljs-keyword"></span>archlinuxcn-keyring<br>aria2<br>ark<br>autoconf<br>automake<br><span class="hljs-keyword">base</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">bison</span><br><span class="hljs-keyword"></span>calibre-python3<br>clash<br>cuda<br>deepin.com.qq.im<br><span class="hljs-keyword">dialog</span><br><span class="hljs-keyword"></span>dolphin<br>fakeroot<br>fcitx5-chinese-<span class="hljs-keyword">addons</span><br><span class="hljs-keyword"></span>fcitx5-configtool<br>fcitx5-gtk<br>fcitx5-material-color<br>fcitx5-pinyin-moegirl<br>fcitx5-pinyin-zhwiki<br>filelight<br>flameshot<br>flex<br>flutter<br>gimp<br>glfw-x11<br>go<br>google-chrome<br>grub<br>gwenview<br>inetutils<br>inkscape<br>inxi<br><span class="hljs-keyword">julia</span><br><span class="hljs-keyword"></span>kamoso<br>kate<br>kcron<br>kde-gtk-<span class="hljs-built_in">config</span><br>kdenlive<br>kdeplasma-<span class="hljs-keyword">addons</span><br><span class="hljs-keyword"></span>kgamma5<br>khotkeys<br>kinfocenter<br>krdc<br>krfb<br>ksystemlog<br>kwallet-pam<br>kwayland-integration<br>kwrited<br>latte-dock<br>mathpix-snipping-tool<br>mkcert<br>mpv<br>namcap<br>neofetch<br>network-manager-applet<br>nvidia<br>oh-my-zsh-git<br>okular<br>optimus-manager-amd-git<br>oxygen<br>pamac-aur<br>perl-log-<span class="hljs-keyword">dispatch</span><br><span class="hljs-keyword"></span>perl-log-log4perl<br>perl-namespace-autoclean<br>perl-params-validationcompiler<br>perl-specio<br>perl-tk<br>perl-unicode-linebreak<br>perl-yaml-tiny<br>picgo-appimage<br>pkgconf<br>plasma-<span class="hljs-keyword">browser-integration</span><br><span class="hljs-keyword"></span>plasma-pa<br>plasma-sdk<br>plasma-thunderbolt<br>plasma-vault<br>proxychains-ng<br>python-aiohttp<br>qtcreator<br>rstudio-desktop-<span class="hljs-keyword">bin</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">scrcpy</span><br><span class="hljs-keyword"></span>sddm-kcm<br>simplescreenrecorder<br>spectacle<br>spotify<br>strace<br>systemd-kcm<br>tlp-rdw<br>typora<br>user-manager<br>vim<br>virt-manager<br>visual-studio-code-<span class="hljs-keyword">bin</span><br><span class="hljs-keyword"></span>wget<br>wps-office-cn<br>xdg-desktop-portal-kde<br>xf86-video-ati<br>xf86-video-fbdev<br>xf86-video-vesa<br><span class="hljs-keyword">xorg-bdftopcf</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-docs</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-font-util</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-fonts-100dpi</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-fonts-75dpi</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-iceauth</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-luit</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-server-xephyr</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-server-xnest</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-server-xvfb</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-server-xwayland</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-sessreg</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-smproxy</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-x11perf</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xbacklight</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xcmsdb</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xcursorgen</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xdriinfo</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xev</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xgamma</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xhost</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xinput</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xkbevd</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xkbutils</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xkill</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xlsatoms</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xlsclients</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xmodmap</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xpr</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xrefresh</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xvinfo</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xwd</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">xorg-xwud</span><br><span class="hljs-keyword"></span>yakuake<br>yay<br>zotero<br></code></pre></td></tr></table></figure><h2 id="双显卡方案">双显卡方案</h2><p>我以前用的 <code>Bumblebee</code> 但是听说性能不行，后来换了 <code>optimus-manager</code> 由于是 AMD处理器，应该使用 <code>optimus-manager-amd-git</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mtext>AUR</mtext></msup></mrow><annotation encoding="application/x-tex">^{\text{AUR}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">AUR</span></span></span></span></span></span></span></span></span></span></span></span></span> ，同时该包依赖的 <code>bbswitch</code> 也需要换成 <code>bbswitch-ati-git</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mtext>AUR</mtext></msup></mrow><annotation encoding="application/x-tex">^{\text{AUR}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">AUR</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>具体配置可以看 <a href="https://blog.edward-p.xyz/optimus-manager/">使用 optimus-manager 来管理显卡切换</a>。</p><h2 id="屏幕撕裂问题">屏幕撕裂问题</h2><p>我的各种驱动装好后，开机过了一会儿之后，屏幕左下角会出现闪屏，在设置里面将屏幕刷新率设置成60Hz 之后就好了。</p><h2 id="屏幕亮度无法调节问题">屏幕亮度无法调节问题</h2><p>我的 ArchLinux 一直无法调节屏幕亮度，按快捷键调节虽然屏幕亮度条在变，但是实际u亮度并没有改变，一直是最高亮度。昨天晚上觉得太亮了，决定搞定它。</p><p>参考了 ArchWiki 的 <a href="https://wiki.archlinux.org/index.php/backlight">Backlight</a> 部分，但是当我按照 ACPI 小节的指示输入时，居然有两个！</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /sys/class/backlight/<br>----------------------------------------------------------------------<br>amdgpu_bl0 asus-nb-wmi<br></code></pre></td></tr></table></figure><p>而且当我尝试使用 root 修改 brightness 文件时，居然无法修改(改了之后还是原来的值)。</p><p>后来看到 Wiki 里面有一句</p><blockquote><p>If you find that changing the <code>acpi_video0</code> backlight does not actually change the brightness, you may need to use <code>acpi_backlight=none</code>.</p></blockquote><p>于是尝试修改内核参数为 <code>acpi_backlight=none</code>，关于如何修改内核参数可见 <a href="https://wiki.archlinux.org/index.php/Kernel_parameters_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">内核参数</a>.</p><p>改好后就一切正常了，我还突然有点不习惯了。</p>]]></content>
    
    
    <categories>
      
      <category>archlinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AMD</tag>
      
      <tag>KDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Word 论文写作小技巧</title>
    <link href="/2020/04/18/My-Word-academic-suite/"/>
    <url>/2020/04/18/My-Word-academic-suite/</url>
    
    <content type="html"><![CDATA[<p>本文主要介绍使用在 Windows 系统中 MS Word 配合 Citavi 进行论文写作和文献管理的小技巧。</p><h2 id="图表的交叉引用">图表的交叉引用</h2><p>对于 Word 中插入的图表，在正文写作时可能需要对图表进行交叉引用，比如“由图 1 知”、“由表 2 可得”。此时，我们可以运用 Word 主菜单栏「引用」中的「插入题注」功能。在写作完成后，我们只需要选中相应区域，点击更新域（或者按快捷键「F9」），图表的编号会自动更新。如果想要对所有域进行更新，可以先按「Ctrl + A」，再按「F9」。</p><p><img src="https://bu.dusays.com/2022/04/16/712903e069a2f.gif" alt=""></p><h2 id="公式编号及交叉引用">公式编号及交叉引用</h2><p>除了图表，我们往往还需要对公式进行交叉引用。对于公式的编号及交叉引用，「MathType」或「AxMath」等插件非常好用，但如果你的合作者没有下载相应的软件，则对方可能无法编辑，并且有些情况下（比如部分学校的毕业论文）要求你必须使用 Word 自带公式编辑器，此时外部插件就不香了。因此，这里主要介绍如何使用 Word 自带公式编辑器进行公式编号及交叉引用。</p><p>网上有许多关于公式编号及交叉引用的方法，不过要同时实现<strong>编号右对齐</strong>、<strong>自动更新编号</strong>、<strong>方便交叉引用</strong>三种功能，个人更习惯使用以下方式。</p><p>Word 的公式编辑器可以选择「Unicode」和「LaTeX」两种方式，下面的例子使用后者进行公式编写，具体步骤如下：</p><ol><li><p>使用快捷键「Alt + =」，进入公式编辑状态；</p></li><li><p>输入公式后，在公示编辑框內输入「#()」，将光标停留在括号中，点击主菜单栏「插入」中「文档部件」下拉菜单的「域」，选择「AutoNum」，格式为「1,2,3,…」，点击「确定」，此时「#()」中自动生成了数字「1」，其他公式的编号自动更新（若未更新，可选中相应区域，按快捷键「F9」更新域）；</p><p><img src="https://bu.dusays.com/2022/04/16/6bd839c4e9e2a.png" alt=""></p></li><li><p>选中生成的数字「1」，点击主菜单栏「插入」中的「书签」，在「书签名」中输入公式的标签（如 “Eq1”），点击「添加」；</p><p><img src="https://bu.dusays.com/2022/04/16/081fde116104e.png" alt=""></p></li><li><p>使用快捷键「Ctrl + =」，将线性公式转换为专业格式；</p></li><li><p>在正文需要引用公式的位置，点击主菜单栏「插入」中的「交叉引用」，在「引用类型」下拉菜单中选择「书签」，再选择对应的公式标签即可；</p></li><li><p>在写作完成后，类似地，选中相应区域，点击更新域（或者按快捷键「F9」），公式的编号会自动更新。</p></li></ol><p><img src="https://bu.dusays.com/2022/04/16/3f7b1a4279c5f.gif" alt=""></p><h2 id="文献管理软件：Citavi-6">文献管理软件：Citavi 6</h2><p>市面上常用文献管理软件的对比可以参考<a href="https://www.softhead-citavi.com/blog/2314">此链接</a>。每个软件都有其自身的优点，每个用户都有自身的使用习惯，适合自己的才是最好的。本人亲身使用过 <strong>EndNote X9</strong> 和 <strong>Citavi 6</strong> 两款文献管理软件进行过论文写作，同时了解对比过若干个其他文献管理软件，不得不承认 <strong>Citavi 6</strong> 的确是文献管理软件中的战斗机，其<a href="https://www.softhead-citavi.com/features">主要特点</a>参见官网。个人最终选择了 <strong>Citavi 6</strong> 作为主要的文献管理工具，主要有以下几个原因：</p><ul><li>基础功能完善，拓展功能强大，兼具完备性和灵活性；</li><li>可以选择将项目保存在本地或云端（德国本地服务器，数据安全性有保障）；</li><li>社区用户活跃，<a href="http://forum.softhead-citavi.com/">官方论坛</a>能够解决 90% 以上的软件使用问题，并且能在客户服务 QQ 群向管理员提问，亲测服务态度贼棒。</li></ul><p>当然，<strong>Citavi 6</strong> 也有一些缺陷，个人认为主要有以下几点：</p><ul><li>初期学习成本较大（相对于其他文献管理软件而言），但学会之后显著提高科研效率；</li><li>启动程序较慢（成功启动之后运行流畅）；</li><li>个别情况下遇到云端服务器维护时，无法打开云端项目让人崩溃（鉴于教训，本人将最近正在写作的论文项目存放在了本地，已完成或者不紧急的项目放在云端，云端和本地项目可以相互转换）；</li><li>个别用户的在 Word 中不显示 Citavi 插件（可以在<a href="http://forum.softhead-citavi.com/t/159?ip=1">官方论坛</a>或者客服服务 QQ 群寻求帮助，但也存在用户的 Word 本身有问题的情况）。</li></ul><p>如果大家对 <strong>Citavi 6</strong> 比较陌生，可以参考 <a href="https://www.softhead-citavi.com/citavi6_user_guide"><strong>Citavi 6 入门指南</strong></a>进行学习，下面主要介绍几个常用的 <strong>Citavi 6</strong> 小技巧</p><h3 id="导入文献">导入文献</h3><p><strong>Citavi 6</strong> 提供了若干种导入文献的方法，根据个人使用经验，最常用的主要有以下三种：</p><ul><li><p>利用 <strong>Citavi Picker</strong> 插件：Citavi Picker 是 Chrome，Firefox 和 Internet Explorer 的免费扩展浏览器插件，它能在网页上标识 ISBN 和 DOI 号，并将参考信息发送到用户的项目，也可以发送网页和网页内容到用户项目，<a href="http://forum.softhead-citavi.com/t/205?ip=2">该链接以谷歌学术文献搜索为例</a>；</p></li><li><p>利用 <strong>ISBN, DOI, other ID</strong> 功能：点击菜单栏「ISBN, DOI, other ID」选项，输入文献的识别码（ISBN, DOI, or PubMed ID），在线搜索成功后，点击「Add to project」即可；</p><p><img src="https://bu.dusays.com/2022/04/16/383044fdf7147.png" alt=""></p></li><li><p>利用<strong>多种格式文件</strong>导入：<strong>Citavi</strong> 具有良好的兼容性，能够以 RIS，BibTeX 和 ENW 等格式导入参考文献，当我们从谷歌学术或者百度学术下载相应格式的文件后，可以直接拖动该文件到 <strong>Citavi</strong> 相应区域。</p><p><img src="https://bu.dusays.com/2022/04/16/245f229e0225d.gif" alt=""></p></li></ul><h3 id="文內引用">文內引用</h3><p>在理工科领域，文內引用（in-text citation）多使用数字编号，而在社科领域，文內引用（in-text citation）常常要求丰富的格式变换，比如“张三(2020)”、“(张三, 2020)”、“张三”等格式。该功能在 Word 中使用 Citavi 插件可以轻松实现。</p><p><img src="https://bu.dusays.com/2022/04/16/c0af5db6791a4.gif" alt=""></p><h3 id="参考文献格式">参考文献格式</h3><p><strong>Citavi</strong> 目前提供几乎所有的英文期刊参考文献格式。如果搜索不到某些期刊要求的参考文献格式，可以给工作人员发邮件，工作人员会为你制作相应的期刊论文格式。</p><p>但由于 <strong>Citavi</strong> 开发人员目前只支持德语和英语，所以中文期刊只能自己制作或改编现有参考文献格式的 ccs 文件。比如，<strong>Citavi</strong> 提供了 GB/T 7714-2015 格式，绝大多数中文期刊格式可以在此基础上进行微小改动，这也体现了 <strong>Citavi</strong> 的灵活性，具体实现方法可以参照客服服务 QQ 群中的相关帮助文档。</p><p>据我所知，大多数文献管理软件并不能同时较好地管理中文和英文的参考文献：比如有时候要求中英文的参考文献格式相互独立；再如许多现有的文献格式英文在前，中文在后，而学位论文、中文期刊要求中文在前，英文在后。而 <strong>Citavi</strong> 可以完美地解决上述问题，下图展示了本人在 GB/T 7714-2015 的基础上进行参考文献格式修改，以满足本校本科生毕业论文的参考文献格式的全部要求。在修改时，各个修改成分的修改效果可以在最右边的方框中动态呈现。</p><p><img src="https://bu.dusays.com/2022/04/16/fdea7fab29a9b.png" alt=""></p><h3 id="Word-导航窗格-Citavi-Pane-协同写作">Word 导航窗格 + Citavi Pane 协同写作</h3><p>在 <strong>Citavi</strong> 导入文献时，将文献进行分类，会为后续写作节省很多时间。在进行论文写作时，同时打开 Word 的导航窗格和 Citavi Pane，会使得写作思路更加清晰。尤其是在写作引言、文献综述和结论时，这些部分涉及的文献较多，如果没有事先的文献分类和清晰的写作框架，学者常常会因为在寻找合适的文内引用上耗费宝贵的时间，并且写作思路也容易被打乱。Word 导航窗格 + Citavi Pane 协同写作能够较好地解决这个问题，让我们更加专注于写作本身。</p><p><img src="https://bu.dusays.com/2022/04/16/c6c3830373c3d.png" alt=""></p><h2 id="结语">结语</h2><p>本文到这里就结束了，如果大家对 Word 论文写作和文献管理有什么心得，欢迎一起讨论。</p>]]></content>
    
    
    <categories>
      
      <category>Office</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Word</tag>
      
      <tag>论文写作</tag>
      
      <tag>文献管理</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>我的LaTeX学术套装</title>
    <link href="/2020/04/07/my-academic-suite/"/>
    <url>/2020/04/07/my-academic-suite/</url>
    
    <content type="html"><![CDATA[<p>在平时的论文写作中，如果能够事先将工具配置好能够节省非常多的精力。本文介绍 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 配合 VSCode 和 Zotero 进行论文写作和文献管理。</p><h1><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>TeX</mtext></mrow><annotation encoding="application/x-tex">\TeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> 套装配置</h1><h2 id="套装选择">套装选择</h2><p>Windows 和 Linux 推荐使用 TeXLive, 截至目前，最新的 TeXLive 2022版已于 4月4日发布。Mac 推荐使用MacTeX。 都推荐安装完整版，这样不用每次都去下载需要的包。安装教程可以看<a href="https://www.tug.org/texlive/doc/texlive-zh-cn/texlive-zh-cn.pdf"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>TeX</mtext></mrow><annotation encoding="application/x-tex">\TeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> <em>Live</em> 指南—2022</a>。</p><p>Archlinux 用户可以选择使用 AUR 的 <a href="https://aur.archlinux.org/packages/texlive-full">texlive-full</a>, 或者直接安装 <code>texlive-most</code></p><h2 id="VSCode-LaTeX-配置">VSCode LaTeX 配置</h2><h3 id="LaTeXWorkshop-插件">LaTeXWorkshop 插件</h3><p>编辑器个人推荐使用 VSCode, VSCode 是一款便捷强大的编辑器，界面也十分美观，它的 <a href="https://github.com/James-Yu/LaTeX-Workshop"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span>-WorkShop</a> 插件提供了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 支持，它提供了代码高亮、自动补全、自定义代码片段、编译链、正向跳转、逆向跳转等功能。</p><p>VSCode 还可以为不同的工作区应用不同的设置，因此在写 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 时，我们可以为工作区禁用 Python、CodeRunner 等不需要的插件。</p><p><img src="https://bu.dusays.com/2022/04/16/0611feaa0f945.gif" alt=""></p><p>编译链配置可以参考 <a href="https://zhuanlan.zhihu.com/p/38178015">使用VSCode编写LaTeX</a>。</p><p>在实际中经常用到的编译工具主要有编译文档的pdflatex, xelatex 和编译bib文件的 bibtex 和bier。 如果把各种常用情形都考虑在内至少需要6种编译链。实际上，在tex 文档设置好了编译工具之后，可以通过快捷键编译而不需要手动选择编译链。</p><p>在你的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>TeX</mtext></mrow><annotation encoding="application/x-tex">\TeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> 主文件的最开头设置好编译工具，如下面的命令指定了使用 xelatex 来编译文档，biber 来编译bib文件，然后在 tex 文档中使用 快捷键调起 <code>TeXMagicProgramWithArgs</code> 就可以编译。</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-meta">%!TEX program = xelatex</span><br><span class="hljs-meta">%!BIB program = biber</span><br></code></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2022/04/16/bebe513fc0646.png" alt=""></p><p>下面是我常用的一些快捷方式</p><ul><li>使用<code>TeXMagicProgramWithArgs</code>编译： Ctrl+Alt+B</li><li>正向跳转：Ctrl+Alt+J</li><li>逆向跳转（pdf 到 tex): Ctrl+Click</li></ul><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span>-WorkShop 插件还提供了各种各样的代码片段，例如可以使用 <code>\equation</code> 产生</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\begin</span>&#123;equation&#125;<br>    <br><span class="hljs-keyword">\end</span>&#123;equation&#125;<br></code></pre></td></tr></table></figure><p>此外还有 <code>\figure</code> 等代码片段用于插入图片。插入表格虽然有 <code>\table</code> 代码片段但是仍然比较麻烦，推荐先在 Excel 做好表格，然后使用 <a href="https://github.com/krlmlr/Excel2LaTeX">Excel2LaTeX</a> 或者 <a href="https://www.tablesgenerator.com/latex_tables">LaTeX Tables Generator 网站</a>将Excel 表格转换成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 表格并粘贴。</p><p><img src="https://bu.dusays.com/2022/04/16/dcd62af2d0201.gif" alt=""></p><h3 id="其他插件">其他插件</h3><ul><li><a href="https://github.com/tecosaur/LaTeX-Utilities">LaTeX Utilities</a>: 提供字数统计、zotero交互等功能</li><li><a href="https://github.com/valentjn/vscode-ltex">LTeX</a> : 为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 和 Markdown 提供拼写检查、语法检查等功能, 需要与 LTeX - Chinese support 、LTeX - English support 等语言扩展一起使用。</li></ul><h2 id="格式化代码">格式化代码</h2><p><strong>这部分仅适用于 ArchLinux!</strong> 其他系统仅作参考。</p><p>为了格式化代码，我们需要安装以下插件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S perl-log-log4perl perl-log-dispatch perl-namespace-autoclean \<br>perl-specio perl-eval-closure perl-params-validationcompiler \<br>perl-yaml-tiny perl-file-homedir perl-unicode-linebreak<br></code></pre></td></tr></table></figure><p>然后才能成功格式化代码。</p><h1>Zotero</h1><p><strong>Zotero</strong> <a href="https://zh.wikipedia.org/wiki/Help:%E8%8B%B1%E8%AA%9E%E5%9C%8B%E9%9A%9B%E9%9F%B3%E6%A8%99">/zoʊˈtɛroʊ/</a>是一款<a href="https://zh.wikipedia.org/wiki/%E8%87%AA%E7%94%B1%E5%8F%8A%E5%BC%80%E6%94%BE%E6%BA%90%E4%BB%A3%E7%A0%81%E8%BD%AF%E4%BB%B6">自由及开放源代码</a>的<a href="https://zh.wikipedia.org/wiki/%E6%96%87%E7%8C%AE%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6">文献管理软件</a>，管理书目信息（如作者、标题、出版社、摘要、阅读笔记等）及相关材料（如<a href="https://zh.wikipedia.org/wiki/PDF">PDF</a>文件等)。其最著名的特性是作为浏览器插件、在线同步、与文档编辑软件如<a href="https://zh.wikipedia.org/wiki/Microsoft_Word">Microsoft Word</a>、<a href="https://zh.wikipedia.org/wiki/LibreOffice">LibreOffice</a>、<a href="https://zh.wikipedia.org/wiki/OpenOffice.org_Writer">OpenOffice.org Writer</a>、<a href="https://zh.wikipedia.org/wiki/NeoOffice">NeoOffice</a>等集成，可生成<a href="https://zh.wikipedia.org/w/index.php?title=%E6%96%87%E5%86%85%E5%BC%95%E7%94%A8&amp;action=edit&amp;redlink=1">文内引用</a>、生成页面脚注或文后的参考文献（bibliographies）。</p><p><img src="https://bu.dusays.com/2022/04/16/dfedb8841c0fe.png" alt="Zotero"></p><p>Zotero 可以与浏览器集成实现自动抓取文献，如果你有下载权限还会自动下载pdf。</p><p><img src="https://bu.dusays.com/2022/04/16/404d7627706d1.gif" alt=""></p><p><img src="https://bu.dusays.com/2022/04/16/ffe67faaad599.png" alt="此处pdf 还未下载好"></p><h2 id="Zotero-插件">Zotero 插件</h2><p>zotero 最大的特点是可以使用各种各样的插件来满足你的需要，以下是我使用的一些插件。</p><p><img src="https://bu.dusays.com/2022/04/16/3d2e09ef4a3e1.png" alt="image-20220416122447752"></p><ul><li><a href="http://retorque.re/zotero-better-bibtex/">Better BibTeX</a> : 将 zotero 的文献导出为bib 文件。</li><li><a href="https://github.com/bwiernik/zotero-shortdoi">Zotero DOI Manager</a> 为参考文献查找、检验doi。</li><li><a href="https://github.com/l0o0/jasminum">Jasminum</a>: 茉莉花， Zotero 中文插件，适用于中国知网等。</li><li><a href="https://github.com/ethanwillis/zotero-scihub">Zotero Scihub</a> 为有DOI 信息的文献自动从 Scihub下载pdf</li><li><a href="http://zotfile.com/">ZotFile</a> : zotero pdf文件管理器。</li></ul><p>zotero 也有 Word 插件，可以在Word 中插入参考文献，但是由于我不怎么使用word, 此处不再介绍。</p><h1>公式输入</h1><p>如果需要将其他地方的公式输入到自己的 TeX 文件中，自己动手打一遍固然好，但是如果能够直接把别人的公式粘贴过来岂不美哉！ <a href="https://mathpix.com/">Mathpix</a> 就是这样一个工具，它可以将截图中的公式转换成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 代码。省去手动敲代码的时间。下面是其官网的一个例子。</p><p><img src="https://bu.dusays.com/2022/04/16/0f22314104152.png" alt=""></p><h1>用 Git 进行版本管理</h1><p>由于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 是纯文本文档，因此可以很方便的用git 进行版本管理。配合 git 还可以实现多人协作，批注修改等功能。在此不再赘述，git 教程可见 <a href="https://git-scm.com/book/zh/v2">Git Book</a> 。</p><p>但是，由于git 是以行为最小修改单位，而 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 的换行需要空一行，因此可以在写 tex文件时，每写一句话就换一行。这样通过git 可以很方便的看到每次修改了哪些地方。</p><p>当你需要给一个不会用git 的人看你相比于某次修改了什么内容时，可以使用 <a href="https://gitlab.com/git-latexdiff/git-latexdiff">git-latexdiff</a>, 它会产生一个包含修改的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 文档，对其进行编译即可生成修改内容的pdf. 它本质上是对 git 和 <a href="https://github.com/ftilmann/latexdiff/">latexdiff</a> 的一个包装。</p><p>latexdiff 能够将两个文件进行比较，然后得到一个新的可编译的tex文件，编译之后可以在pdf中查看文章的改动。</p><p><img src="https://bu.dusays.com/2022/04/16/e8f348e2dc469.png" alt=""></p><h1><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 转 Word</h1><p>目前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 转 word 主要有两种比较好的方式，但是都不完美，一种是使用 pandoc 转换，一个简单的教程见<a href="https://www.jianshu.com/p/dc62b915920e">怎么用Pandoc把Latex转换成MS Word文档</a> 优点是公式、表格都转换的比较好，缺点是参考文献部分会转换失败。也可以使用 Acrobat 将 生成的pdf 转换成 word, 这个各个方面都不错，就是公式转换的不好。两者可以互为补充。</p><h1>结语</h1><p>本文到这里就结束了，如果你也有想要分享的技巧或者插件，可以在下方留言。后面预计会找一位使用Word写论文的大佬分享他的写作和管理参考文献的经验。</p><p>最后是私货时间，欢迎大家使用<a href="https://github.com/sukanka/LaTeX-SWUFE-Bachelor-Thesis">西财的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 本科毕业论文模板</a>, 另外，我也想寻找几位同学接手模板的后续维护工作。</p>]]></content>
    
    
    <categories>
      
      <category>LaTeX</category>
      
    </categories>
    
    
    <tags>
      
      <tag>论文写作</tag>
      
      <tag>文献管理</tag>
      
      <tag>LaTeX</tag>
      
      <tag>Zotero</tag>
      
      <tag>VSCode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NFC刷公交、地铁、门禁</title>
    <link href="/2018/11/06/NFC%E5%88%B7%E9%97%A8%E7%A6%81/"/>
    <url>/2018/11/06/NFC%E5%88%B7%E9%97%A8%E7%A6%81/</url>
    
    <content type="html"><![CDATA[<p>前两天从锦江区坐公交回来,没有零钱,还是跟路人换零钱才回来的。之所以不办天府通是因为我之前掉过好几次公交卡了，不敢再办了，而且公交坐的不多，基本都是地铁，而地铁可以用微信。之后又在网上看到天府通开始支持NFC刷卡了。遂有了开卡的想法。还顺便搞了NFC模拟校园卡刷门禁，从此出宿舍不用带卡！</p><span id="more"></span><h1>前期准备</h1><ol><li><p>一部有NFC功能的Android 手机；</p></li><li><p>电信卡或者移动卡。必须是NFC-sim 卡，不是的可以去营业厅换，有的收钱，有的不收，不超过20块。</p></li></ol><p>#电信用户<br>电信用户下载天府通手机app,根据提示注册应该就可以了。（PS:我不是电信用户，所以不太清楚，捂脸）</p><h1>移动用户</h1><p>移动用户无法使用天府通app,需要使用移动的和包支付，没有注册过和包支付的新用户可以先参加充10元得20的活动</p><ol><li><p>微信搜索公众号  和包， 关注第一个， 中国移动和包<img src="https://bu.dusays.com/2022/04/16/ddc2644d43ff2.png" alt="1541517684715"></p></li><li><p>选择“热门活动”， 点击“领10元话费”<img src="https://bu.dusays.com/2022/04/16/1c48737c8b35c.png" alt="1541517667475"></p></li><li><p>输入手机号和验证码领优惠</p><p><img src="https://bu.dusays.com/2022/04/16/cef64563d33c6.png" alt="1541517629872"></p></li><li><p>下载和包支付，注册和包</p></li><li><p>绑定银行卡或者信用卡，</p></li></ol><p><img src="https://bu.dusays.com/2022/04/16/5371a1b558f17.png" alt="1541517815595"></p><ol start="6"><li>点击首页的充话费，金额自定义输入20，如果领取成功的话就是10元充20话费。</li></ol><h2 id="NFC天府通">NFC天府通</h2><h3 id="Android-7-1及之前">Android 7.1及之前</h3><p>如果你是Android 7.1及以前的操作系统（4.4~7.1），那么可以直接在**“生活-我的卡券包-NFC卡”<strong>下面查看，app会提示空中开卡，确认就是，之后选择</strong>添加新卡**</p><p><img src="https://bu.dusays.com/2022/04/16/d05cb396ea4d9.png" alt="1541518395813"></p><p>选择<strong>公交卡</strong> ，然后选择<strong>成都移动天府通</strong> 直接下载，然后开卡，开卡是不收开卡费的</p><p><img src="https://bu.dusays.com/2022/04/16/331f1d1b3b0ef.png" alt="1541518546855"></p><p>此后就可以用手机NFC刷公交地铁了，手机关机也可以刷（我还没试过）。</p><h3 id="Android-8-0-及8-1">Android 8.0 及8.1</h3><p>最简单的方法，去移动营业厅找一个android 7.1及以前版本的带NFC的手机，插卡，开通天府通，取卡，把卡插回自己手机，修复天府通，一气呵成。</p><p>其实只需要找一个8.0以前的支持NFC的手机就可以了，把卡插上去，按照上面的步骤开卡，再把卡换回去，再在和包里面下载一次公交卡就可以了。</p><p>有的8.0手机还有个问题，比如和包获取不到NFC权限，那么我们需要<strong>手动授权和包</strong> (<strong>需要Root权限</strong>） ，我用的是<strong>OnePlus NFC</strong> (因为我用的op3)<img src="https://bu.dusays.com/2022/04/16/e9c62caf52034.png" alt="1541519313057"></p><p>授权后发现和包支付的权限多了一个其他权限</p><p><img src="https://bu.dusays.com/2022/04/16/5800d1851f2ca.png" alt="1541519383919"></p><p><img src="https://bu.dusays.com/2022/04/16/2b807fdd37c75.png" alt="1541519397375"></p><p>之后进入和包正常操作就可以了。如果你没有Android8.0 以前的支持NFC的手机，可以看看https://www.coolapk.com/feed/8535898 。我根据那个教程没有成功，最后还是换手机搞定的。</p><h1>NFC 模拟校园卡刷门禁</h1><p><strong>Warning： 不建议使用此功能来薅社会主义羊毛!</strong>  需要ROOT 权限</p><p>使用switch NFC 或者其他软件,读取校园卡,然后卡模拟</p>]]></content>
    
    
    
    <tags>
      
      <tag>日常生活</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 Jupyterlab 上使用Julia</title>
    <link href="/2018/08/20/About-Julia/"/>
    <url>/2018/08/20/About-Julia/</url>
    
    <content type="html"><![CDATA[<p>昨天偶然看见了Julia 的一篇介绍,介绍中有一段话使我开始对Julia 感兴趣起来</p><blockquote><p>一群拥有各种语言丰富编程经验的Matlab高级用户，对现有的科学计算编程工具感到不满——这些软件对自己专长的领域表现得非常棒，但在其它领域却非常糟糕。他们想要的是一个开源的软件，它要像C语言一般快速而有拥有如同Ruby的动态性；要具有Lisp般真正的同像性而又有Matlab般熟悉的数学记号；要像Python般通用、像R般在统计分析上得心应手、像Perl般自然地处理字符串、像Matlab般具有强大的线性代数运算能力、像shell般胶水语言的能力，易于学习而又不让真正的黑客感到无聊；还有，它应该是交互式的，同时又是编译型的……</p></blockquote><span id="more"></span><p>2018-11-10 更新: 增加Julia 安装PyCall而不自动装Miniconda. bilibili 有个讲julia 的<a href="https://www.bilibili.com/video/av28178443/">视频</a>讲得挺好的,可惜没出第二期.</p><p>Julia 的快速、通用、还有强大的线性代数运算能力，以及熟悉的数学符号 吸引了我. （<s>其实我以前只接触过 Matlab, Python, 还有C++, 每个还都只是半吊子</s>）</p><p>因此我马上就去下载了Julia 的安装软件(最新的1.0.0稳定版），安装完毕之后当然是要让我最常用的Jupyter 支持Julia了.于是谷歌之，还发现了Jupyter名字的来源:   Julia, Python, R</p><blockquote><p>While Jupyter’s roots are in Python (it evolved from IPython Notebooks), it is now multi-lingual. The name itself comes from three languages: Ju(lia) + Py(thon) + (e)R.</p></blockquote><p>然后找到了<a href="https://github.com/JuliaLang/IJulia.jl">IJulia</a>, 根据说明文档来一步步安装Ijulia. 由于我已经安装了Anaconda, 自然是不想再多装一个jupyter.因此我的步骤是:</p><ol><li>打开 anaconda prompt, 输入 <code>where jupyter</code> 查询下我的jupyter 安装在哪了，得到<code>C:\ProgramData\Anaconda3\Scripts\jupyter.exe</code></li><li>复制得到的路径，先粘贴到记事本备用，将<code>\</code>改为<code>\\</code>，得到``C:\ProgramData\Anaconda3\Scripts\jupyter.exe`（<s>我用的是notepad++</s>）</li><li>打开 Julia,输入以下代码</li></ol><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Julia"><span class="hljs-keyword">import</span> Pkg <span class="hljs-comment">#Julia 下的包管理器，类似于python的pip</span><br><span class="hljs-literal">ENV</span>[<span class="hljs-string">&quot;JUPYTER&quot;</span>]=<span class="hljs-string">&quot;C:\\ProgramData\\Anaconda3\\Scripts\\jupyter&quot;</span> <br><span class="hljs-comment"># 刚刚得到的jupyter 路径，注意是\\,注意没有.exe</span><br><span class="hljs-comment"># 如果你将jupyter 加入到了系统路径，那么输入 ENV[&quot;JUPYTER&quot;]=&quot;jupyter&quot; 也可以</span><br>Pkg.add(<span class="hljs-string">&quot;IJulia&quot;</span>)<br>Pkg.build(<span class="hljs-string">&quot;IJulia&quot;</span>)<br><span class="hljs-keyword">using</span> IJulia<br>notebook()<br></code></pre></td></tr></table></figure><p>我按照上面的步骤弄好之后，进入到了jupyter 界面，新建一个Julia文档， 然后输入一个简单的计算<code>1+1</code> 结果一直没有反馈。当然，用jupyter lab 也不行，即使是kernel idle 状态也不能。</p><p><img src="https://bu.dusays.com/2022/04/16/a3d9880db2cc1.png" alt="jupyter notebook"></p><p>本着不服输的精神，我又开始疯狂搜索相关的提问，终于在Ijulia 的 issue里面找到了解决方案，原链接在<a href="https://github.com/JuliaLang/IJulia.jl/issues/693">这里</a></p><p>具体的做法是：</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Julia">julia&gt; <span class="hljs-keyword">import</span> Pkg<br>(v1<span class="hljs-number">.0</span>) pkg&gt; add IJulia<br>julia&gt; <span class="hljs-literal">ENV</span>[<span class="hljs-string">&quot;IJULIA_DEBUG&quot;</span>] = <span class="hljs-literal">true</span> <br>(v1<span class="hljs-number">.0</span>) pkg&gt; dev IJulia <br>(v1<span class="hljs-number">.0</span>) pkg&gt; build IJulia<br></code></pre></td></tr></table></figure><p>其中，在julia 的console 里面按<code>]</code>即可切换到 <code>(v1.0) pkg&gt;</code>,再按backspace 键即可切换回 <code>julia&gt;</code></p><p>最后输入</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Julia"><span class="hljs-keyword">using</span> IJulia<br>notebook()<br></code></pre></td></tr></table></figure><p>即可， 此后就可以通过powershell 直接输入 <code>jupyter lab</code> 打开jupyterlab 了, 并且可以正常使用julia 的功能。</p><p><img src="https://bu.dusays.com/2022/04/16/4753c19e78102.png" alt="julia in jupyterlab"></p><p>Julia 还可以调用Python, 这可以通过PyCall 库来实现,如果直接</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Julia"><span class="hljs-keyword">using</span> Pkg<br>Pkg.add(<span class="hljs-string">&quot;PyCall&quot;</span>)<br>Pkg.build(<span class="hljs-string">&quot;PyCall&quot;</span>)<br></code></pre></td></tr></table></figure><p>会安装一个MiniConda, 但是我已经有Anaconda 了,不需要miniconda</p><p>因此只需要事先指定python的路径就好了,查询python 路径得方法和查询jupyter 得方法是一样的.</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Julia"><span class="hljs-literal">ENV</span>[<span class="hljs-string">&quot;PYTHON&quot;</span>]=<span class="hljs-string">&quot;C:\\ProgramData\\Anaconda3\\python&quot;</span><br><span class="hljs-keyword">using</span> Pkg<br>Pkg.add(<span class="hljs-string">&quot;PyCall&quot;</span>)<br>Pkg.build(<span class="hljs-string">&quot;PyCall&quot;</span>)<br></code></pre></td></tr></table></figure><p>这样就不会安装miniconda了.</p><p>最后，希望我能 <s>学好Julia</s> 坚持学得久一点</p>]]></content>
    
    
    <categories>
      
      <category>Julia</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Julia</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fisher信息量学习笔记</title>
    <link href="/2018/04/20/Fisher-and-MLE/"/>
    <url>/2018/04/20/Fisher-and-MLE/</url>
    
    <content type="html"><![CDATA[<p>本文记录了Fisher 信息量的两种等价计算方式.</p><span id="more"></span><h1>说明</h1><p>本文积分以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∫</mo></mrow><annotation encoding="application/x-tex">\int</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1111em;vertical-align:-0.3061em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0006em;">∫</span></span></span></span>表示<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∫</mo><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow><mrow><mo>+</mo><mi mathvariant="normal">∞</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">\int_{-\infty}^{+\infty}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3804em;vertical-align:-0.4142em;"></span><span class="mop"><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0006em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9662em;"><span style="top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">∞</span></span></span></span><span style="top:-3.2579em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4142em;"><span></span></span></span></span></span></span></span></span></span> (主要原因是懒,请谅解.)</p><h1>Fisher 信息量</h1><h2 id="定义">定义</h2><p>设总体概率密度函数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>θ</mi><mo>∈</mo><mi mathvariant="double-struck">Θ</mi></mrow><annotation encoding="application/x-tex">p(x;\theta),\theta \in \mathbb{\Theta}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Θ</span></span></span></span>满足下列条件:</p><ol><li>参数空间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi></mrow><annotation encoding="application/x-tex">\Theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Θ</span></span></span></span>是直线上的一个开区间;</li><li>支撑<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">{</mo><mi>x</mi><mi mathvariant="normal">∣</mi><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">S=\{x|p(x;\theta)\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">x</span><span class="mord">∣</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)}</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span>无关;</li><li>导数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac></mstyle><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\dfrac{\partial }{\partial \theta}p(x;\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span>对一切<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow><annotation encoding="application/x-tex">\theta \in \Theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Θ</span></span></span></span>都存在;</li><li>对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(x;\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span>,积分与微分可以交换顺序,即:</li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo>∫</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi><mo>=</mo><mo>∫</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">\dfrac{\partial}{\partial \theta}\int p(x;\theta)\,\mathrm{d}x=\int \dfrac{\partial}{\partial \theta}p(x;\theta)\,\mathrm{d}x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2337em;vertical-align:-0.8622em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2337em;vertical-align:-0.8622em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span></span></span></p><ol start="5"><li>期望<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msup><mrow><mo fence="true">[</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac></mstyle><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E\left[\dfrac{\partial}{\partial \theta}\ln p(x;\theta)\right]^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.604em;vertical-align:-0.95em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>存在.</li></ol><p>则称</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mi>E</mi><msup><mrow><mo fence="true">[</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">I(\theta)=E\left[\dfrac{\partial}{\partial \theta}\ln p(x;\theta)\right]^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.604em;vertical-align:-0.95em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p><p>为总体分布的Fisher 信息量.</p><h2 id="另一种表示法">另一种表示法</h2><p>Fisher信息量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">I(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span>也可以表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mi>E</mi><mrow><mo fence="true">[</mo><mfrac><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mrow><mi mathvariant="normal">∂</mi><msup><mi>θ</mi><mn>2</mn></msup></mrow></mfrac><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">I(\theta)=-E\left[\dfrac{\partial ^2}{\partial \theta ^2}\ln p(x;\theta)\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4411em;vertical-align:-0.95em;"></span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>有时候这种计算方法更加方便</p><p><strong>证明</strong></p><p>首先,有:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>E</mi><mrow><mo fence="true">[</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mo>=</mo><mn>0</mn></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}E\left[\dfrac{\partial}{\partial \theta}\ln p(x;\theta)\right]=0\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span></span></p><p>这是因为:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>E</mi><mrow><mo fence="true">[</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>∫</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>∫</mo><mfrac><mn>1</mn><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>∫</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo>∫</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mn>0</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}&amp;E\left[\dfrac{\partial}{\partial \theta}\ln p(x;\theta)\right]\\ =&amp;\int \dfrac{\partial \ln p(x;\theta)}{\partial \theta} p(x;\theta)\, \mathrm{d}x \\=&amp;\int \dfrac{1}{p(x;\theta)}\dfrac{\partial p(x;\theta)}{\partial \theta} p(x;\theta)\, \mathrm{d}x\\=&amp;\int \dfrac{\partial p(x;\theta)}{\partial \theta} \, \mathrm{d}x\\=&amp;\dfrac{\partial }{\partial \theta}\int p(x;\theta)\, \mathrm{d}x\\=&amp;0\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:14.5752em;vertical-align:-7.0376em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:7.5376em;"><span style="top:-9.5376em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"></span></span><span style="top:-6.8606em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-4.2713em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-1.6083em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:0.9254em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:2.9276em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mrel">=</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:7.0376em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:7.5376em;"><span style="top:-9.5376em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span><span style="top:-6.8606em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-4.2713em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-1.6083em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span><span style="top:0.9254em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span><span style="top:2.9276em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:7.0376em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>然后,有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>E</mi><mrow><mo fence="true">[</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mo>=</mo><mn>0</mn></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\dfrac{\partial }{\partial \theta}E\left[\dfrac{\partial}{\partial \theta}\ln p(x;\theta)\right]=0\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span></span></p><p>又因为:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\dfrac{\partial \ln p(x;\theta)}{\partial \theta}=\frac{1}{p(x;\theta)}\frac{\partial p(x;\theta)}{\partial \theta}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>所以</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo>=</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\frac{\partial p(x;\theta)}{\partial \theta}=p(x;\theta) \dfrac{\partial \ln p(x;\theta)}{\partial \theta}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.8065em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3065em;"><span style="top:-3.3065em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8065em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3065em;"><span style="top:-3.3065em;"><span class="pstrut" style="height:3.427em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8065em;"><span></span></span></span></span></span></span></span></span></p><p>故,有:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>E</mi><mrow><mo fence="true">[</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo>∫</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>∫</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mrow><mo fence="true">(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo fence="true">)</mo></mrow><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>∫</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo>+</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>θ</mi><mn>2</mn></msup></mrow></mfrac><mo fence="true">)</mo></mrow><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>∫</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><msup><mrow><mo fence="true">(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi><mo>+</mo><mo>∫</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>θ</mi><mn>2</mn></msup></mrow></mfrac><mtext> </mtext><mi mathvariant="normal">d</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>E</mi><mrow><mo fence="true">[</mo><msup><mrow><mo fence="true">(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo fence="true">]</mo></mrow><mo>+</mo><mi>E</mi><mrow><mo fence="true">[</mo><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>θ</mi><mn>2</mn></msup></mrow></mfrac><mo fence="true">]</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mn>0</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}&amp;\dfrac{\partial }{\partial \theta}E\left[\dfrac{\partial}{\partial \theta}\ln p(x;\theta)\right]\\=&amp; \dfrac{\partial }{\partial \theta}\int \dfrac{\partial \ln p(x;\theta)}{\partial \theta} p(x;\theta) \, \mathrm{d}x\\=&amp; \int \dfrac{\partial }{\partial \theta}\left(\dfrac{\partial \ln p(x;\theta)}{\partial \theta} p(x;\theta)\right) \, \mathrm{d}x\\=&amp; \int \left(\dfrac{\partial p(x;\theta) }{\partial \theta}\dfrac{\partial \ln p(x;\theta)}{\partial \theta}+ p(x;\theta)\dfrac{\partial^2 \ln p(x;\theta)}{\partial \theta^2}\right)  \, \mathrm{d}x\\=&amp; \int p(x;\theta) \left(\dfrac{\partial \ln p(x;\theta)}{\partial \theta}\right)^2\, \mathrm{d}x %+ \int p(x;\theta) \dfrac{\partial^2 \ln p(x;\theta)}{\partial \theta^2}\,\mathrm{d}x\\=&amp;E\left[\left(\dfrac{\partial \ln p(x;\theta)}{\partial \theta}\right)^2\right]+E\left[\dfrac{\partial^2 \ln p(x;\theta)}{\partial \theta^2}\right]\\=&amp;0\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:18.4345em;vertical-align:-8.9673em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:9.4673em;"><span style="top:-11.7673em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"></span></span><span style="top:-9.0902em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-6.478em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-3.7368em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-0.8328em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:2.1672em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:4.5573em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mrel">=</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:8.9673em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:9.4673em;"><span style="top:-11.7673em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span><span style="top:-9.0902em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-6.478em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.7368em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-0.8328em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">x</span></span></span><span style="top:2.1672em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span><span style="top:4.5573em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:8.9673em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>所以</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mrow><mo fence="true">[</mo><msup><mrow><mo fence="true">(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>θ</mi></mrow></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo fence="true">]</mo></mrow><mo>=</mo><mo>−</mo><mi>E</mi><mrow><mo fence="true">[</mo><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>θ</mi><mn>2</mn></msup></mrow></mfrac><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">E\left[\left(\dfrac{\partial \ln p(x;\theta)}{\partial \theta}\right)^2\right]=-E\left[\dfrac{\partial^2 \ln p(x;\theta)}{\partial \theta^2}\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.654em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4411em;vertical-align:-0.95em;"></span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>即:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mi>E</mi><mrow><mo fence="true">[</mo><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>ln</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>θ</mi><mn>2</mn></msup></mrow></mfrac><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">I(\theta)=-E\left[\dfrac{\partial^2 \ln p(x;\theta)}{\partial \theta^2}\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4411em;vertical-align:-0.95em;"></span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p>]]></content>
    
    
    <categories>
      
      <category>学习笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数理统计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>我的第一个LINGO程序</title>
    <link href="/2018/04/19/my-first-LINGO-program/"/>
    <url>/2018/04/19/my-first-LINGO-program/</url>
    
    <content type="html"><![CDATA[<p>背景:班主任下周要开一个一对一见面会,要根据同学们的时间安排先后顺序.</p><span id="more"></span><h1>收集数据</h1><ul><li>首先建一个excel表格,将93个候选时间排成一行,38个同学按学号排成一列,得到一个38$\times$93的矩阵.</li><li>将表格共享,每个同学在自己有空的时间填1,无空的时间填0.</li><li>回收表格.将得到的38$\times$93矩阵在Excel中命名为<code>data</code></li></ul><h1>建立模型</h1><p>本模型只有约束条件,无目标函数.最终的安排也为一个38$\times$93矩阵</p><ul><li>每个同学只去一次,也必须去一次.</li><li>每个时间最多只有一个同学去.</li><li>每个同学只在自己有空的时间去.</li><li>去或不去是0,1变量,1表示去,0表示不去.</li><li>(目标函数)期望同学们尽早去见面会.</li></ul><h1>数学化表达</h1><h2 id="符号约定">符号约定</h2><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">C</mi><mo>=</mo><mo stretchy="false">(</mo><mi>c</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow><mo stretchy="false">)</mo><mi mathvariant="normal">_</mi><mrow><mn>38</mn><mo>×</mo><mn>93</mn></mrow></mrow><annotation encoding="application/x-tex">\mathbf{C}=(c\_{ij})\_{38\times93}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"></span><span class="mord mathbf">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span><span class="mclose">)</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord">38</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">93</span></span></span></span></span> 表示收集到的数据,其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">c\_{ij}\in \{0,1\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9695em;vertical-align:-0.31em;"></span><span class="mord mathnormal">c</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">X</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow><mo stretchy="false">)</mo><mi mathvariant="normal">_</mi><mrow><mn>38</mn><mo>×</mo><mn>93</mn></mrow></mrow><annotation encoding="application/x-tex">\mathbf{X}=(x\_{ij})\_{38\times93}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"></span><span class="mord mathbf">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span><span class="mclose">)</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord">38</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">93</span></span></span></span></span> 表示最终的安排,其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">x\_{ij}\in \{0,1\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9695em;vertical-align:-0.31em;"></span><span class="mord mathnormal">x</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span></span></li></ul><h2 id="约束条件">约束条件</h2><ul><li><p>每个人只去一次,也必须去一次:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>∑</mo><mi mathvariant="normal">_</mi><msup><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mn>93</mn></msup><mi>x</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum\_{j=1}^{93}x\_{ij}=1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.6em;vertical-align:-0.55em;"></span><span class="mop op-symbol large-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">93</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p></li><li><p>每个时间最多只有一个同学去:</p></li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>∑</mo><mi mathvariant="normal">_</mi><msup><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mn>38</mn></msup><mi>x</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow><mo>⩽</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum\_{i=1}^{38}x\_{ij}\leqslant 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.6em;vertical-align:-0.55em;"></span><span class="mop op-symbol large-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord"><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">38</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p><ul><li><p>每个同学只在自己有空的时间去:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>x</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow><mo>⩽</mo><mi>c</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow></mrow><annotation encoding="application/x-tex">x\_{ij}\leqslant c\_{ij} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9695em;vertical-align:-0.31em;"></span><span class="mord mathnormal">x</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9695em;vertical-align:-0.31em;"></span><span class="mord mathnormal">c</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span></span></span></span></span></p></li><li><p>目标函数,尽量早去</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo>∑</mo><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mi>x</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mi>j</mi></mrow><mo>∗</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">\min \sum\_{i,j}x\_{ij}*j </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.6em;vertical-align:-0.55em;"></span><span class="mop">min</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span><span class="mord mathnormal">x</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span></p></li></ul><h2 id="一些说明">一些说明</h2><ul><li>LINGO不区分大小写</li><li>LINGO 不区分&lt;和&lt;=,不区分&gt;和&gt;=,都视为包含等号.</li><li>我事前把矩阵<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">C</mi></mrow><annotation encoding="application/x-tex">\mathbf{C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"></span><span class="mord mathbf">C</span></span></span></span>对应的区域在EXCEL中取名为<code>data</code></li><li>同时将另一个空白的38行,93列的区域命名为<code>data2</code> ,用于导出结果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">X</mi></mrow><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"></span><span class="mord mathbf">X</span></span></span></span></li></ul><h2 id="LINGO-代码">LINGO 代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs LINGO">!模型:见面会安排;<br>sets:<br>time/1..93/;<br>student/1..38/;<br>!Student 为行,time为列;<br>timetable(student,time):c,x;<br>endsets<br>data:<br>!导入数据将data的数据传输给C;<br>c=@ole(&#x27;D:\Users\ASUS\Desktop\data.xlsx&#x27;,&#x27;data&#x27;);<br>!输出结果输出X到data2;<br>@ole(&#x27;D:\Users\ASUS\Desktop\data.xlsx&#x27;,&#x27;data2&#x27;)=x;<br>enddata<br>!期望尽早安排完;<br>min= @sum(timetable(i,j):j*x(i,j));<br>!只在有空的时间去;<br>@for(timetable(i,j):x(i,j)&lt;= c(i,j));<br>!每个人只去一次;<br>@for(student(i):@sum(time(j):x(i,j))=1);<br>!每个时间最多有一个人;<br>@for(time(j):@sum(student(i):x(i,j))&lt;=1);<br>!去或不去为0,1变量;<br>@for(timetable(i,j):@bin(x(i,j)));<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LINGO学习记录</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LINGO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>教育优惠</title>
    <link href="/2018/03/07/students_resources/"/>
    <url>/2018/03/07/students_resources/</url>
    
    <content type="html"><![CDATA[<p>当你成为大学生，拿到@edu.cn邮箱或者拿到学生证的时候，你就能享受到许多的教育优惠。当然高校老师也能享受很多优惠。</p><span id="more"></span><h1>说明</h1><p>本文转自 <a href="https://github.com/ivmm/Student-resources">https://github.com/ivmm/Student-resources</a> 并基于其进行了修改。</p><h1>注意点</h1><ul><li>一切官方的助学资金等，请咨询学校领导、辅导员、班主任，请勿向陌生账户转账！</li><li>校园借贷风险极高，请谨慎尝试。</li><li>对需要出示身份证、手持身份证的资源请保持谨慎。</li><li>保管好自己的学生证、身份证，不要随意丢弃。</li></ul><h1>前言</h1><p>高考已经过去，你们也将迎来不同于以往的大学生活，大学或许对之前的12年管制式生活来说是解放了，不过你也知道的，解放后面是什么，脱离了父母和老师的管束以及适当的财务自主，你的生活并不会就无比精彩。</p><p>让自己的大学生活过得积极而精彩：</p><ol><li>多参加校级、省级、国家级的比赛，你的比较对象就不会是同班同学了而是同龄人，视野更大。</li><li>多上台讲讲，第一次第二次第三次可能会小心脏砰砰跳，后面真的就见怪不怪了，会自信很多。</li><li>不要再默默无闻了，让老师们注意到你，都大学了上课还不敢举个手？</li><li>做点义工，为社会做点贡献，工作了就真没时间了。</li><li>做人做事记得留个证据，留个发票，留个单子。</li><li>多向长辈们问候问候，偶尔放个长假了就去看看。</li></ol><p>那么就期待着9月开启你的上当受骗之旅吧，不过可能在6月买电脑买手机的时候就已经上当受骗。（逃～）</p><h1>学生包</h1><p>各类学生优惠项目经过许多年的发展，很多学生包已经不单单只通过 edu 邮箱验证身份了，而且使用 @edu.cn 反而会降低申请成功率。 建议使用学生证、入学通知书等有学院官方标志和日期的工具来证明自己的身份。</p><ul><li><strong><a href="https://education.github.com/pack">Github 学生包</a></strong>，高质量的开发工具集合，并提供 DIgitalocean 的 50美元代金券，免费域名一枚。</li><li><strong><a href="https://azure.microsoft.com/zh-cn/free/students/">Microsoft Azure 学生包</a></strong>，免费使用微软的开发软件，包括 Windows Server 系统，以及 Azure 学生订阅。</li><li><strong><a href="https://aws.amazon.com/cn/education/awseducate/">AWS 学生包</a></strong>，亚马逊云计算的学生包，可以获得至少 $40 的优惠和教育培训。</li><li><strong><a href="http://www.autodesk.com.cn/education/home">Autodesk 学生包</a></strong>，旗下 AutoCAD , 3DMAX , Maya 等软件，其（教育版）免费试用期可延长至三年。此优惠不需要学生证或者@edu.cn邮箱。</li><li><strong><a href="https://www.jetbrains.com/student/">JetBrains 学生包</a></strong>，免费使用各类开发工具和集成工具。</li><li><strong><a href="https://edu.google.com/products/productivity-tools/">G Suite for Education</a></strong>，为教育用户提供的谷歌生产力工具套件（大陆不在申请区之内）。</li><li><strong><a href="http://www.lindo.com/index.php?option=com_content&amp;view=article&amp;id=120&amp;Itemid=45">LINGO Educational Research License</a></strong>, LINGO 教育授权，著名线性与非线性求解器，求解优化模型的最佳选择，数学建模必备。</li></ul><h1>教育优惠</h1><ul><li><strong><a href="http://shop.edu.cn/">赛尔校园先锋</a></strong>，以绝对优惠的价格获得 Adobe 软件、Win、Office 正版授权。</li><li><strong><a href="https://products.office.com/en-us/student?tab=students">Office in Education</a></strong>，微软家提供的免费 Office 365 教育优惠，中国大多数学校无缘申请。</li><li><strong><a href="https://promotion.aliyun.com/ntms/campus2017.html">阿里云 云翼计划</a></strong>，118元/年，阿里云ECS+OSS+域名+机器学习API+Clouder认证。</li><li><strong><a href="https://www.qcloud.com/act/campus">腾讯云+校园计划</a></strong>，10元一个月的云服务器租用，免费域名、云储存，需要抢购。</li><li><strong><a href="https://www.mtyun.com/activity-school">美团云 云帆校园</a></strong>，8.8元，1C1G1M + 50数据盘。<br><del><ul><li><strong><a href="https://www.jcloud.com/activity/leapCloud">京东云 跃云计划</a></strong>，8.8元，1C2G1M + 30数据盘，年付送 com 域名。</li></ul></del></li><li><strong><a href="http://www.apple.com/cn-k12/shop">苹果教育商店</a></strong>，苹果设备优惠，Music和 Pro APP 优惠，暑假还会有学生优惠大促销。</li><li><strong><a href="https://www.microsoftstore.com.cn/student?Icid=StoreNavi_EDU">微软教育商店</a></strong>，9折购买微软旗下的各种硬件设备。</li><li><strong><a href="http://www.onthehub.com/">OnTheHub 教育商店</a></strong>，PD 和 VMware 的虚拟机优惠，以及更多软件优惠。</li><li><strong><a href="https://www.siteground.com/student-hosting.htm">SiteGroud 学生计划</a></strong>，WP 官方推荐的主机托管商提供 $1.99/月 高性能 CP 托管。</li><li><strong><a href="https://www.spotify.com/hk-zh/student/">Spotify 学生优惠</a></strong>，Spotify Premium学生订阅半价优惠。</li><li><strong><a href="https://pantheon.io/edu">Pantheon 学生版</a></strong>，专业高性能网站托管的学生优惠。</li><li><strong><a href="http://coupon.dji.com/cn/edu">大疆教育优惠</a></strong>，大疆产品的教育折扣。</li><li><strong><a href="http://cn.mikecrm.com/BrUWPMy">幕布笔记教育优惠</a></strong>，幕布面向学生、公益组织和教育机构推出的专属优惠措施，高级版八折优惠。</li><li>**[SPSS]，(<a href="https://www.ibm.com/us-en/marketplace/spss-statistics-gradpack/details">https://www.ibm.com/us-en/marketplace/spss-statistics-gradpack/details</a>)**实用统计软件,最新版premium 99美元一年。</li></ul><h1>实用干货</h1><ul><li><strong><a href="https://creativemarket.com/free-goods">CreativeMarket Free Goods</a></strong>，每周免费六款设计资源，电商、前端必备。</li><li><strong><a href="https://www.axure.com/edu">Axure</a></strong>， 原型设计工具，产品、运营必备，学生、教师免费。</li><li><strong><a href="http://education.minecraft.net/get-started">Minecraft</a></strong>， 我的世界教育免费版 ，仅支持邮箱。</li><li><strong><a href="http://www.wolfram.com/mathematica/pricing/students-individuals.php">Mathematica</a></strong>， 现代科学计算软件，3折优惠 50刀，添加购物车后显示。</li><li><strong><a href="https://www.tableau.com/zh-cn/academic">Tableau</a></strong>， 数据可视化分析软件，对学生、教室以及教育组织提供免费使用。（只能使用学生证申请）</li></ul><h1>推荐软件</h1><ul><li><strong><a href="https://cloudconvert.com/">CloudConvert</a></strong>，转码神器，格式齐全的在线转码利器。</li><li><strong><a href="https://smallpdf.com/">Smallpdf</a></strong>，专业文档转PDF，PDF转文档神器。</li></ul><h1>相关推荐</h1><p><strong>买电脑：</strong>《<a href="http://www.toutiao.com/i6430265970773721602/">或许是最详细的学生购买笔记本购买参考</a>》</p><p><strong>如何科学提问：</strong>《<a href="http://git.oschina.net/mifar/How-To-Ask-Questions-The-Smart-Way">提问的智慧</a>》</p><p><strong>搜索引擎：</strong> 为了你的身体健康、事业有成，请尽量<strong>减少使用百度</strong>的频率。</p><p><strong>PPT 制作：</strong>《<a href="https://www.mf8.biz/ppt-tips/">放 PPT 之前，请你注意这一些！</a>》<br>作者博客：<a href="https://www.mf8.biz/">https://www.mf8.biz/</a></p>]]></content>
    
    
    <categories>
      
      <category>优惠信息</category>
      
    </categories>
    
    
    <tags>
      
      <tag>教育优惠</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mathematica 激活指北</title>
    <link href="/2018/02/10/mma/"/>
    <url>/2018/02/10/mma/</url>
    
    <content type="html"><![CDATA[<p>Wolfram Mathematica （简称：Mathematica）是一款符号计算软件，有时候也被称为计算机代数系统，广泛使用于科学、工程、数学、计算等领域。本文主要介绍如何获取正版和激活盗版 Mathematica.</p><span id="more"></span><h1>简介</h1><p><strong>本文根据<a href="https://tiebamma.github.io/InstallTutorial/">Mathematica激活指南</a>修改而来</strong> .</p><p>Archlinux 用户可以去 <a href="https://pacman.ltd/">Clansty’s Archlinux Repository</a> 下载打包好的软件包。</p><p>Mathematica 是由英国科学家斯蒂芬·沃尔夫勒姆提出构想，并且由他所领导的沃尔夫勒姆研究公司（位于美国伊利诺伊州香槟市）开发的一款广泛使用的科学计算软件。它拥有强大的数值计算和符号运算能力，是目前为止使用最广泛的数学软件之一。</p><h1>获取正版 Mathematica</h1><p>用盗版是迫不得已，有能力的还是去支持一下正版吧，需要 VISA 或者 MasterCard 卡。购买链接在<a href="https://www.wolfram.com/mathematica/pricing/">这里</a> 根据自己所在的行业选择不同的版本。另外 Wolfram 公司为学生和老师提供教育版软件。其中学生版低至3折，售价 $50。<br>虽然点进 Students 栏，显示的是标准版 $155, 但是点击 BUY NOW 之后，你会发现售价已经变成 $50 了。<br><img src="https://bu.dusays.com/2022/04/16/a7ec3d725b115.png" alt="mma"><br><img src="https://bu.dusays.com/2022/04/16/7cd0d8bc89a3d.png" alt="mma2"><br>此处的 Mathematica 有中文版和英文版和日语版，日英文版有 Windows, Macintosh, Linux 3个版本，中文版仅有 Windows 和 Macintosh 版本。</p><h1>激活盗版 Mathematica</h1><p>再次呼吁，用盗版只是迫不得已，有能力还是请支持正版！</p><h2 id="软件下载">软件下载</h2><p>本博客只提供最新版（11.2.0）下载。</p><h3 id="官方下载地址（需要科学上网）">官方下载地址（需要科学上网）</h3><p>此处只有仅提供中文版<br>中文 Windows 版地址: <a href="http://dl.wolframcdn.com/0036F4/Mathematica/11.2.0.0/Mathematica_11.2.0_Chinese_WIN.zip?4ae6ee529e4e0d5967853f9864b23dfec2504d5a385cf83e11359956ad95cb469f36b126eb76be9628d7f9c232f442a8b647e3794cceabc0473bcae71c7451a0f9d3cfc9886343cab97a766a6062b954a849dd790839034e6defe3fcc31a116cde8ef402f6728196ec9d4cecaced8a.zip">Mathematica</a><br>md5: 282fe2e587c7e48414cc8cdd79e8647d<br>中文 Mac 版地址: <a href="http://dl.wolframcdn.com/0036F4/Mathematica/11.2.0.0/Mathematica_11.2.0_Chinese_MAC.dmg?4ae6ee529e4e0d5967853f9864b23dfec2504d5a385cf83e11359956ad95cb441d92b9d94ba4820c0596a0eb6f43ddb278f28fea3385dbfb6d71d8084246ba8c6225f15588f8b3744cadb1e9c290f7146e3fe993981d7e2c41d63781f4f6fb18d2763ab3759c603487db69d60c2af0.dmg">Mathematica</a><br>md5: b55381e5eb58a81bcf8f5e5ddf991b69<br><img src="https://bu.dusays.com/2022/04/16/7a39c47657d68.png" alt="mmacn"><br><img src="https://bu.dusays.com/2022/04/16/6713d174eca82.png" alt="mmamac"></p><h3 id="百度网盘">百度网盘</h3><p>英文 Mac, Linux, Win 版：<a href="https://pan.baidu.com/s/1eUfG6em">百度网盘</a><br>中文 Windows, Mac 版: <a href="https://pan.baidu.com/s/1o9DFSim">百度网盘</a><br>**注意，英文版也是可以调出中文提示的，但是它没有中文帮助，只有带了中文帮助的才叫中文版！）<br>**中文版来源是官网，不信可以对比MD5,我核对过，是一致的。</p><h2 id="软件注册">软件注册</h2><h3 id="下载安装软件和注册机">下载安装软件和注册机</h3><p>注册机可能会报毒，但是我用 Windows Defender 扫过，并没有报毒，可放心下载。<br><a href="https://pan.baidu.com/s/1o9g5T94">11.2注册机</a><br>安装 Mathematica 软件，安装完成会弹出激活对话窗口：<br><img src="https://bu.dusays.com/2022/04/16/6f08009ab9452.png" alt="mma3"><br>这里要选择下方的<strong>其他方式激活</strong>，然后选择<strong>手动激活</strong><br><img src="https://bu.dusays.com/2022/04/16/d73feb801470e.png" alt="mma4"><br>然后记下出现的** Math ID**<br><img src="https://bu.dusays.com/2022/04/16/d890c1d1008c1.png" alt="mma5"><br><strong>注意，是把你电脑上那串数复制下来，不是上图里的数!</strong><br>此时不要关闭弹出的激活界面，打开注册机（注册机的扩展名是.exe，别去点那个again.nfo！），将MathID复制进注册机第一个输入框中，然后回车，或者点击注册机下方 Save mathpass得到Activation Key和Password。如图：<br><img src="https://bu.dusays.com/2022/04/16/973b0cf2c36df.png" alt="key"><br>注意：图中所示的是老版注册机的界面，它的Activation Key的格式是4位数字-4位数字-5位字母或者里面有::1。使用新版注册机算出来的Activation Key是4-4-6的形式。这里强烈不推荐使用新版注册机注册版本9和版本10，因为已经证实在许多计算机上，新版注册机无法完全注册版本9和版本10。老注册机在注册版本9时可能要多点步骤，下详。<br>还有，以上截图是版本8、9注册机的截图，版本10及以后的专属注册机只有那个黑乎乎的命令行界面，但使用方法和这个注册机没什么不同，不要大惊小怪！</p><h2 id="填写-Activation-和-Password">填写 Activation 和 Password</h2><p>算出Activation Key和Password后，复制粘贴，填入Mathematica激活界面对应输入框即可。（注意：如果你使用了老版注册机或者版本10英文版的新注册机，那么，不要忘了把Password中的“ ::1 ”也给一起复制了！那也是密码的一部分·！）（如果你要手抄的话，注意这两个冒号都是英文冒号！）<br>注册完毕，享受盗版吧！最后再呼吁一句，有能力还是请尽量支持正版！</p>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数学建模</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
